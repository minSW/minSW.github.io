<!DOCTYPE html><html lang="ko"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> &#039;Spark The Definitive Guide&#039; 6ì¥ - ë°ì´í„° íƒ€ì… (ë¹„)ê³µì‹ ê°€ì´ë“œë¶ Â· Look out</title><meta name="description" content="&amp;#039;Spark The Definitive Guide&amp;#039; 6ì¥ - ë°ì´í„° íƒ€ì… (ë¹„)ê³µì‹ ê°€ì´ë“œë¶ - Lukka Min"><meta name="og:image" content="https://minsw.github.io/images/og_image.png"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/cover.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="search" type="application/opensearchdescription+xml" href="https://minsw.github.io/atom.xml" title="Look out"><script src="//code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script><meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/feed.xml" title="Look out" type="application/atom+xml">
</head><body><div class="wrap"><header><a class="logo-link" href="/"><img src="/cover.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self">BLOG</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self">ARCHIVE</a></li><li class="nav-list-item"><a class="nav-list-link" href="/tags/" target="_self">TAG</a></li><li class="nav-list-item"><a class="nav-list-link" href="https://github.com/minSW" target="_blank">GITHUB</a></li></ul></header><main class="container"></main><div class="post"><article class="post-block"><h1 class="post-title">&#039;Spark The Definitive Guide&#039; 6ì¥ - ë°ì´í„° íƒ€ì… (ë¹„)ê³µì‹ ê°€ì´ë“œë¶</h1><div class="post-info">2021ë…„ 2ì›” 2ì¼<span class="categories"><i class="fa fa-bookmark" aria-hidden="true"></i></span><a class="post-category" href="/categories/spark/">#spark</a></div><div class="post-content"><br/>

<center><p style="color:lightgray">ë¼ë–¼ ì‹œì ˆì—”,, ê°€ì´ë“œë¶ì´ í•˜ë‚˜ë©´ ë“ -ë“ í–ˆë‹¤,,, ì´ë§ì´ì•¼,,, ì´ì´ @}----</p>
<img width="300" alt="maple" src="https://user-images.githubusercontent.com/26691216/106801127-b149b700-66a4-11eb-9c8f-0802771ebe5f.jpg">
<i>'ì•„íŒŒì¹˜ ìŠ¤íŒŒí¬' ë¯¸ì¸ì¦ ë¹„ê³µì‹ ê°€ì´ë“œ ë¶<br/>
[ì „ì› ì¦ì •] 50.00 í˜ì´ì§€ í¬ì¸íŠ¸ (ìºì‹œ ì•„ì´í…œ êµ¬ë§¤ ê°€ëŠ¥)</i></center>


<br/>

<center><h2>_ _ _</h2></center>

<br/>

<hr>
<h1 id="CHAPTER-6-ë‹¤ì–‘í•œ-ë°ì´í„°-íƒ€ì…-ë‹¤ë£¨ê¸°"><a href="#CHAPTER-6-ë‹¤ì–‘í•œ-ë°ì´í„°-íƒ€ì…-ë‹¤ë£¨ê¸°" class="headerlink" title="CHAPTER 6 ë‹¤ì–‘í•œ ë°ì´í„° íƒ€ì… ë‹¤ë£¨ê¸°"></a>CHAPTER 6 ë‹¤ì–‘í•œ ë°ì´í„° íƒ€ì… ë‹¤ë£¨ê¸°</h1><p>CHAPTER 5 ëŠ” DataFrameì˜ ê¸°ë³¸ ê°œë…ê³¼ í•µì‹¬ ì¶”ìƒí™” ê°œë…ì„ ì†Œê°œ<br>CHAPTER 6 ëŠ” ìŠ¤íŒŒí¬ì˜ êµ¬ì¡°ì  ì—°ì‚°ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ë‚´ìš©ì¸ <strong>í‘œí˜„ì‹ ë§Œë“œëŠ” ë°©ë²•</strong> ì†Œê°œ + ë‹¤ì–‘í•œ ë°ì´í„° íƒ€ì… ë‹¤ë£¨ëŠ” ë°©ë²•</p>
<blockquote>
<p>ë‹¤ì–‘í•œ ë°ì´í„° íƒ€ì…</p>
<ul>
<li>Boolean íƒ€ì…</li>
<li>ìˆ˜ì¹˜ íƒ€ì…</li>
<li>ë¬¸ìì—´ íƒ€ì…</li>
<li>dateì™€ timestamp íƒ€ì…</li>
<li>null ê°’ ë‹¤ë£¨ê¸°</li>
<li>ë³µí•© ë°ì´í„° ì•„ì…</li>
<li>ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜</li>
</ul>
</blockquote>
<h3 id="6-1-APIëŠ”-ì–´ë””ì„œ-ì°¾ì„ê¹Œ"><a href="#6-1-APIëŠ”-ì–´ë””ì„œ-ì°¾ì„ê¹Œ" class="headerlink" title="6.1 APIëŠ” ì–´ë””ì„œ ì°¾ì„ê¹Œ"></a>6.1 APIëŠ” ì–´ë””ì„œ ì°¾ì„ê¹Œ</h3><ul>
<li>ì˜¤ëŠ˜ì€ ì–¸ì  ê°€ ë‚´ì¼ì´ ëœë‹¤<ul>
<li>ë²„ì „ ë°”ë€Œë©´ ì±…ì˜ ë‚´ìš©ë„ ë‹¤ ì˜ˆì „ ë‚´ìš©ì´ë‹¤~ ì´ë§ì´ì•¼</li>
<li>=&gt; ë”°ë¼ì„œ <u>ë°ì´í„° ë³€í™˜ìš© í•¨ìˆ˜ ì°¾ëŠ” ë°©ë²•</u> ì„ ì•Œì•„ì•¼í•¨</li>
</ul>
</li>
<li>ì–´ë–»ê²Œ ì°¾ë‚˜?<ul>
<li>DataFrame (Dataset) ë©”ì„œë“œ<ul>
<li>DatasFrameì€ Rowíƒ€ì…ì„ ê°€ì§„ Dataset =&gt; <a target="_blank" rel="noopener" href="http://bit.ly/2rKkALY">Dataset API</a></li>
<li>ë‹¤ì–‘í•œ ë©”ì„œë“œë¥¼ ì œê³µí•˜ëŠ” Dataset í•˜ìœ„ ëª¨ë“ˆ (ex. <a target="_blank" rel="noopener" href="http://bit.ly/2DPYhJC">DataFrameStateFunctions</a> - í†µê³„ì  í•¨ìˆ˜ ì œê³µ, <a target="_blank" rel="noopener" href="http://bit.ly/2DPAqd3">DataFrameNaFunctions</a> - null ë°ì´í„° ì œì–´)</li>
</ul>
</li>
<li>Column ë©”ì„œë“œ<ul>
<li><code>alias</code> <code>contains</code> ë“±ì˜ ì»¬ëŸ¼ ê´€ë ¨ ë©”ì„œë“œ ì œê³µ =&gt; <a target="_blank" rel="noopener" href="http://bit.ly/2FloFbr">Columns API</a></li>
<li><code>org.apache.spark.sql.functions</code>ëŠ” ë°ì´í„° íƒ€ì… ê´€ë ¨ ë‹¤ì–‘í•œ í•¨ìˆ˜ ì œê³µ (ex. <a target="_blank" rel="noopener" href="http://bit.ly/2DPAycx">SQL, DataFrame í•¨ìˆ˜ ë“±</a>)</li>
</ul>
</li>
</ul>
</li>
<li>ëª¨ë“  í•¨ìˆ˜ëŠ” ë°ì´í„° ë¡œìš°ì˜ íŠ¹ì • í¬ë§·ì´ë‚˜ êµ¬ì¡°ë¥¼ ë‹¤ë¥¸ í˜•íƒœë¡œ ë³€í™˜í•˜ê¸° ìœ„í•´ ì¡´ì¬<ul>
<li>í•¨ìˆ˜ë¡œ ë” ë§ì€ ë¡œìš°ë¥¼ ë§Œë“¤ê±°ë‚˜ ì¤„ì¼ ìˆ˜ O</li>
</ul>
</li>
</ul>
<details><summary class="point-color-can-hover">[6.1] ì˜ˆì œ í¼ì¹˜ê¸° - ë¶„ì„ìš© DataFrame ìƒì„± ì˜ˆì œ</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> df = (spark.read.format(<span class="string">&quot;csv&quot;</span>)</span><br><span class="line">  .option(<span class="string">&quot;header&quot;</span>, <span class="string">&quot;true&quot;</span>)</span><br><span class="line">  .option(<span class="string">&quot;inferSchema&quot;</span>, <span class="string">&quot;true&quot;</span>)</span><br><span class="line">  .load(<span class="string">&quot;/data/retail-data/by-day/2010-12-01.csv&quot;</span>))</span><br><span class="line">df.printSchema()</span><br><span class="line">df.createOrReplaceTempView(<span class="string">&quot;dfTable&quot;</span>)</span><br><span class="line"><span class="comment">// df: org.apache.spark.sql.DataFrame = [InvoiceNo: string, StockCode: string ... 6 more fields]</span></span><br><span class="line"><span class="comment">// root</span></span><br><span class="line"><span class="comment">//  |-- InvoiceNo: string (nullable = true)</span></span><br><span class="line"><span class="comment">//  |-- StockCode: string (nullable = true)</span></span><br><span class="line"><span class="comment">//  |-- Description: string (nullable = true)</span></span><br><span class="line"><span class="comment">//  |-- Quantity: integer (nullable = true)</span></span><br><span class="line"><span class="comment">//  |-- InvoiceDate: timestamp (nullable = true)</span></span><br><span class="line"><span class="comment">//  |-- UnitPrice: double (nullable = true)</span></span><br><span class="line"><span class="comment">//  |-- CustomerID: double (nullable = true)</span></span><br><span class="line"><span class="comment">//  |-- Country: string (nullable = true)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</details>


<h3 id="6-2-ìŠ¤íŒŒí¬-ë°ì´í„°-íƒ€ì…ìœ¼ë¡œ-ë³€í™˜í•˜ê¸°"><a href="#6-2-ìŠ¤íŒŒí¬-ë°ì´í„°-íƒ€ì…ìœ¼ë¡œ-ë³€í™˜í•˜ê¸°" class="headerlink" title="6.2 ìŠ¤íŒŒí¬ ë°ì´í„° íƒ€ì…ìœ¼ë¡œ ë³€í™˜í•˜ê¸°"></a>6.2 ìŠ¤íŒŒí¬ ë°ì´í„° íƒ€ì…ìœ¼ë¡œ ë³€í™˜í•˜ê¸°</h3><ul>
<li><code>lit()</code> : ë°ì´í„° íƒ€ì… ë³€í™˜<ul>
<li>ë‹¤ë¥¸ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ ê³ ìœ  ë°ì´í„° íƒ€ì… =&gt; <strong>ìŠ¤íŒŒí¬ ë°ì´í„° íƒ€ì…</strong> ë³€í™˜</li>
</ul>
</li>
</ul>
<details><summary class="point-color-can-hover">[6.2] ì˜ˆì œ í¼ì¹˜ê¸°</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.lit</span><br><span class="line"></span><br><span class="line">df.select(lit(<span class="number">5</span>), lit(<span class="string">&quot;five&quot;</span>), lit(<span class="number">5.0</span>))</span><br><span class="line"><span class="comment">// res9: org.apache.spark.sql.DataFrame = [5: int, five: string ... 1 more field]</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL (SQLì€ ìŠ¤íŒŒí¬ ë°ì´í„° íƒ€ì… ë³€í™˜ í•„ìš” X. ì§ì ‘ ê°’ ì…ë ¥)</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="number">5</span>, &quot;five&quot;, <span class="number">5.0</span></span><br></pre></td></tr></table></figure>
</details>

<h3 id="6-3-ë¶ˆë¦¬ì–¸-ë°ì´í„°-íƒ€ì…-ë‹¤ë£¨ê¸°"><a href="#6-3-ë¶ˆë¦¬ì–¸-ë°ì´í„°-íƒ€ì…-ë‹¤ë£¨ê¸°" class="headerlink" title="6.3 ë¶ˆë¦¬ì–¸ ë°ì´í„° íƒ€ì… ë‹¤ë£¨ê¸°"></a>6.3 ë¶ˆë¦¬ì–¸ ë°ì´í„° íƒ€ì… ë‹¤ë£¨ê¸°</h3><ul>
<li><p>ë¶ˆë¦¬ì–¸ì€ ëª¨ë“  í•„í„°ë§ ì‘ì—…ì˜ ê¸°ë°˜ (ë°ì´í„° ë¶„ì„ì— í•„ìˆ˜)</p>
</li>
<li><p>ë¶ˆë¦¬ì–¸ êµ¬ë¬¸ : <code>and</code>, <code>or</code>, <code>true</code>, <code>false</code></p>
<ul>
<li>ë¶ˆë¦¬ì–¸ êµ¬ë¬¸ìœ¼ë¡œ ë…¼ë¦¬ ë¬¸ë²•(true/false) ìƒì„±</li>
</ul>
</li>
<li><p><strong>ìŠ¤ì¹¼ë¼</strong> ì‚¬ìš© ì‹œ ë™ë“± ì—¬ë¶€</p>
<ul>
<li><code>===</code> (ì¼ì¹˜) / <code>=!=</code> (ë¶ˆì¼ì¹˜)</li>
<li><code>not()</code>, <code>equalTO()</code> ì‚¬ìš© ê°€ëŠ¥</li>
</ul>
</li>
<li><p>íŒŒì´ì¬, ìŠ¤ì¹¼ë¼ ëª¨ë‘ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”</p>
<ul>
<li><p>ê°€ì¥ ëª…í™•í•œ ë°©ë²•? =&gt; <u>ë¬¸ìì—´ í‘œí˜„ì‹ì— ì¡°ê±´ì ˆ ëª…ì‹œ</u> (ex. <code>where(&quot;InvoiceNo = 536353)</code>)</p>
<details><summary class="point-color-can-hover">[6.3-1] ì˜ˆì œ í¼ì¹˜ê¸° - ë¬¸ìì—´ í‘œí˜„ì‹ì— ì¡°ê±´ì ˆ ëª…ì‹œ </summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.col</span><br><span class="line"></span><br><span class="line"><span class="comment">// ê°™ì€ í‘œí˜„ì‹ (in Scala)</span></span><br><span class="line">(df.where(col(<span class="string">&quot;InvoiceNo&quot;</span>).equalTo(<span class="number">536365</span>))</span><br><span class="line">  .select(<span class="string">&quot;InvoiceNo&quot;</span>, <span class="string">&quot;Description&quot;</span>)</span><br><span class="line">  .show(<span class="number">5</span>, <span class="literal">false</span>))</span><br><span class="line">(df.where(col(<span class="string">&quot;InvoiceNo&quot;</span>) === <span class="number">536365</span>)</span><br><span class="line">  .select(<span class="string">&quot;InvoiceNo&quot;</span>, <span class="string">&quot;Description&quot;</span>)</span><br><span class="line">  .show(<span class="number">5</span>, <span class="literal">false</span>))</span><br><span class="line"><span class="comment">// +---------+-----------------------------------+</span></span><br><span class="line"><span class="comment">// |InvoiceNo|Description                        |</span></span><br><span class="line"><span class="comment">// +---------+-----------------------------------+</span></span><br><span class="line"><span class="comment">// |536365   |WHITE HANGING HEART T-LIGHT HOLDER |</span></span><br><span class="line"><span class="comment">// |536365   |WHITE METAL LANTERN                |</span></span><br><span class="line"><span class="comment">// |536365   |CREAM CUPID HEARTS COAT HANGER     |</span></span><br><span class="line"><span class="comment">// |536365   |KNITTED UNION FLAG HOT WATER BOTTLE|</span></span><br><span class="line"><span class="comment">// |536365   |RED WOOLLY HOTTIE WHITE HEART.     |</span></span><br><span class="line"><span class="comment">// +---------+-----------------------------------+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ë¬¸ìì—´ í‘œí˜„ì‹ì— ì¡°ê±´ì ˆ ëª…ì‹œ (ê°€ì¥ ëª…í™•í•œ ë°©ë²•) ì‚¬ìš©</span></span><br><span class="line">(df.where(<span class="string">&quot;InvoiceNo = 536365&quot;</span>)</span><br><span class="line">  .show(<span class="number">5</span>, <span class="literal">false</span>))</span><br><span class="line"></span><br><span class="line">(df.where(<span class="string">&quot;InvoiceNo &lt;&gt; 536365&quot;</span>)</span><br><span class="line">  .show(<span class="number">5</span>, <span class="literal">false</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// +---------+---------+-----------------------------------+--------+-------------------+---------+----------+--------------+</span></span><br><span class="line"><span class="comment">// |InvoiceNo|StockCode|Description                        |Quantity|InvoiceDate        |UnitPrice|CustomerID|Country       |</span></span><br><span class="line"><span class="comment">// +---------+---------+-----------------------------------+--------+-------------------+---------+----------+--------------+</span></span><br><span class="line"><span class="comment">// |536365   |85123A   |WHITE HANGING HEART T-LIGHT HOLDER |6       |2010-12-01 08:26:00|2.55     |17850.0   |United Kingdom|</span></span><br><span class="line"><span class="comment">// |536365   |71053    |WHITE METAL LANTERN                |6       |2010-12-01 08:26:00|3.39     |17850.0   |United Kingdom|</span></span><br><span class="line"><span class="comment">// |536365   |84406B   |CREAM CUPID HEARTS COAT HANGER     |8       |2010-12-01 08:26:00|2.75     |17850.0   |United Kingdom|</span></span><br><span class="line"><span class="comment">// |536365   |84029G   |KNITTED UNION FLAG HOT WATER BOTTLE|6       |2010-12-01 08:26:00|3.39     |17850.0   |United Kingdom|</span></span><br><span class="line"><span class="comment">// |536365   |84029E   |RED WOOLLY HOTTIE WHITE HEART.     |6       |2010-12-01 08:26:00|3.39     |17850.0   |United Kingdom|</span></span><br><span class="line"><span class="comment">// +---------+---------+-----------------------------------+--------+-------------------+---------+----------+--------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// +---------+---------+-----------------------------+--------+-------------------+---------+----------+--------------+</span></span><br><span class="line"><span class="comment">// |InvoiceNo|StockCode|Description                  |Quantity|InvoiceDate        |UnitPrice|CustomerID|Country       |</span></span><br><span class="line"><span class="comment">// +---------+---------+-----------------------------+--------+-------------------+---------+----------+--------------+</span></span><br><span class="line"><span class="comment">// |536366   |22633    |HAND WARMER UNION JACK       |6       |2010-12-01 08:28:00|1.85     |17850.0   |United Kingdom|</span></span><br><span class="line"><span class="comment">// |536366   |22632    |HAND WARMER RED POLKA DOT    |6       |2010-12-01 08:28:00|1.85     |17850.0   |United Kingdom|</span></span><br><span class="line"><span class="comment">// |536367   |84879    |ASSORTED COLOUR BIRD ORNAMENT|32      |2010-12-01 08:34:00|1.69     |13047.0   |United Kingdom|</span></span><br><span class="line"><span class="comment">// |536367   |22745    |POPPY&#x27;S PLAYHOUSE BEDROOM    |6       |2010-12-01 08:34:00|2.1      |13047.0   |United Kingdom|</span></span><br><span class="line"><span class="comment">// |536367   |22748    |POPPY&#x27;S PLAYHOUSE KITCHEN    |6       |2010-12-01 08:34:00|2.1      |13047.0   |United Kingdom|</span></span><br><span class="line"><span class="comment">// +---------+---------+-----------------------------+--------+-------------------+---------+----------+--------------+</span></span><br></pre></td></tr></table></figure>
</details>
</li>
</ul>
</li>
<li><p>ë¶ˆë¦¬ì–¸ í‘œí˜„ì‹ ì‚¬ìš©í•˜ëŠ” ê²½ìš°</p>
<ul>
<li><p>í•­ìƒ ëª¨ë“  í‘œí˜„ì‹ì„ <code>and</code> ë©”ì„œë“œë¡œ ë¬¶ì–´ ì°¨ë¡€ëŒ€ë¡œ í•„í„° ì ìš© í•´ì•¼ í•¨</p>
</li>
<li><p>why?</p>
<ul>
<li>ìŠ¤íŒŒí¬ ë‚´ë¶€ì ìœ¼ë¡œ í•„í„° ì‚¬ì´ì— <code>and</code> êµ¬ë¬¸ ì¶”ê°€ ì‹œ</li>
<li>=&gt; ëª¨ë“  í•„í„°ë¥¼ í•˜ë‚˜ì˜ ë¬¸ì¥ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ <strong>ë™ì‹œì— ëª¨ë“  í•„í„° ì²˜ë¦¬</strong> í•˜ê¸° ë•Œë¬¸</li>
</ul>
</li>
<li><p><code>and</code> êµ¬ë¬¸ ì‚¬ìš© ì‹œ</p>
<ul>
<li><code>and</code> êµ¬ë¬¸ìœ¼ë¡œ ì¡°ê±´ë¬¸ì„ ë§Œë“¤ ìˆ˜ëŠ” ìˆìœ¼ë‚˜,</li>
<li>ì°¨ë¡€ëŒ€ë¡œ ì¡°ê±´ ë‚˜ì—´í•˜ëŠ”ê²Œ ê°€ë…ì„±ì´ ì¢‹ìŒ</li>
</ul>
</li>
<li><p><code>or</code> êµ¬ë¬¸ ì‚¬ìš©ì‹œ</p>
<ul>
<li>ë°˜ë“œì‹œ ë™ì¼í•œ êµ¬ë¬¸ì— ì¡°ê±´ ì •ì˜í•´ì•¼ í•¨</li>
</ul>
<details><summary class="point-color-can-hover">[6.3-2] ì˜ˆì œ í¼ì¹˜ê¸° - ë¶ˆë¦¬ì–¸ í‘œí˜„ì‹ìœ¼ë¡œ í•„í„°ë§ ì ìš© </summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> priceFilter = col(<span class="string">&quot;UnitPrice&quot;</span>) &gt; <span class="number">600</span></span><br><span class="line"><span class="keyword">val</span> descripFilter = col(<span class="string">&quot;Description&quot;</span>).contains(<span class="string">&quot;POSTAGE&quot;</span>)</span><br><span class="line">(df.where(col(<span class="string">&quot;StockCode&quot;</span>).isin(<span class="string">&quot;DOT&quot;</span>)).where(priceFilter.or(descripFilter))</span><br><span class="line">  .show())</span><br><span class="line"><span class="comment">// priceFilter: org.apache.spark.sql.Column = (UnitPrice &gt; 600)</span></span><br><span class="line"><span class="comment">// descripFilter: org.apache.spark.sql.Column = contains(Description, POSTAGE)</span></span><br><span class="line"><span class="comment">// +---------+---------+--------------+--------+-------------------+---------+----------+--------------+</span></span><br><span class="line"><span class="comment">// |InvoiceNo|StockCode|   Description|Quantity|        InvoiceDate|UnitPrice|CustomerID|       Country|</span></span><br><span class="line"><span class="comment">// +---------+---------+--------------+--------+-------------------+---------+----------+--------------+</span></span><br><span class="line"><span class="comment">// |   536544|      DOT|DOTCOM POSTAGE|       1|2010-12-01 14:32:00|   569.77|      null|United Kingdom|</span></span><br><span class="line"><span class="comment">// |   536592|      DOT|DOTCOM POSTAGE|       1|2010-12-01 17:06:00|   607.49|      null|United Kingdom|</span></span><br><span class="line"><span class="comment">// +---------+---------+--------------+--------+-------------------+---------+----------+--------------+</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL (ë™ì¼ í‘œí˜„)</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> dfTable <span class="keyword">WHERE</span> StockCode <span class="keyword">in</span> (&quot;DOT&quot;) <span class="keyword">AND</span>(UnitPrice <span class="operator">&gt;</span> <span class="number">600</span> <span class="keyword">OR</span></span><br><span class="line">    instr(Description, &quot;POSTAGE&quot;) <span class="operator">&gt;=</span> <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
</details>
</li>
</ul>
</li>
<li><p>ë¶ˆë¦¬ì–¸ í‘œí˜„ì‹ì€â€¦</p>
<ul>
<li>í•„í„°ë§ ì¡°ê±´ì—ë§Œ ì‚¬ìš©? =&gt; ğŸ™…ğŸ»â€â™€ï¸. ë¶ˆë¦¬ì–¸ì»¬ëŸ¼ìœ¼ë¡œ DataFrame í•„í„°ë§ë„ ê°€ëŠ¥</li>
<li>ë°˜ë“œì‹œ í‘œí˜„ì‹ìœ¼ë¡œ ì •ì˜í•´ì•¼? =&gt; ğŸ™…ğŸ»â€â™€ï¸. ë³„ë„ ì‘ì—…ì—†ì´ ì»¬ëŸ¼ëª…ë§Œ ì‚¬ìš©í•´ì„œ ì •ì˜ë„ ê°€ëŠ¥</li>
<li>ì‚¬ì‹¤ SQLë¡œ í‘œí˜„í•˜ëŠ”ê²Œ ë” ìµìˆ™í• ì§€ë„.. (ì„±ëŠ¥ì €í•˜ X)</li>
</ul>
</li>
<li><p>NULL ê°’ ë°ì´í„° ì²˜ë¦¬?</p>
<ul>
<li>=&gt; <strong>null-safe</strong> ë™ì¹˜(equivalence) í…ŒìŠ¤íŠ¸</li>
<li>ex. <code>df.where(col(&quot;Description&quot;).eqNullSafe(&quot;hello&quot;)).show()</code></li>
</ul>
</li>
<li><p>SQLì˜ <code>IS [NOT] DISTINCT FROM</code> êµ¬ë¬¸</p>
<ul>
<li>ê³¼ ë™ì¼í•œ ê¸°ëŠ¥ì´ ë­˜ ë§í•˜ë‚˜.. =&gt; <code>isNotDistinctFrom()</code> <code>isDistinctFrom()</code>? (ì§€ê¸ˆë„ ì‚¬ìš©í•˜ëŠ”ì§€?)</li>
<li>since Spark 2.3 (<a target="_blank" rel="noopener" href="https://bit.ly/2x47Obk">ì´ìŠˆ ì°¸ê³ </a>)</li>
</ul>
<details><summary class="point-color-can-hover">[6.3-3] ì˜ˆì œ í¼ì¹˜ê¸° - ë¶ˆë¦¬ì–¸ì»¬ëŸ¼ìœ¼ë¡œ DataFrame í•„í„°ë§</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DataFrame í•„í„°ë§ ì˜ˆì œ</span></span><br><span class="line"><span class="keyword">val</span> <span class="type">DOTCodeFilter</span> = col(<span class="string">&quot;StockCode&quot;</span>) === <span class="string">&quot;DOT&quot;</span></span><br><span class="line"><span class="keyword">val</span> priceFilter = col(<span class="string">&quot;UnitPrice&quot;</span>) &gt; <span class="number">600</span></span><br><span class="line"><span class="keyword">val</span> descripFilter = col(<span class="string">&quot;Description&quot;</span>).contains(<span class="string">&quot;POSTAGE&quot;</span>)</span><br><span class="line">(df.withColumn(<span class="string">&quot;isExpensive&quot;</span>, <span class="type">DOTCodeFilter</span>.and(priceFilter.or(descripFilter)))</span><br><span class="line">  .where(<span class="string">&quot;isExpensive&quot;</span>)</span><br><span class="line">  .select(<span class="string">&quot;unitPrice&quot;</span>, <span class="string">&quot;isExpensive&quot;</span>).show(<span class="number">5</span>))</span><br><span class="line"><span class="comment">// DOTCodeFilter: org.apache.spark.sql.Column = (StockCode = DOT)</span></span><br><span class="line"><span class="comment">// priceFilter: org.apache.spark.sql.Column = (UnitPrice &gt; 600)</span></span><br><span class="line"><span class="comment">// descripFilter: org.apache.spark.sql.Column = contains(Description, POSTAGE)</span></span><br><span class="line"><span class="comment">// +---------+-----------+</span></span><br><span class="line"><span class="comment">// |unitPrice|isExpensive|</span></span><br><span class="line"><span class="comment">// +---------+-----------+</span></span><br><span class="line"><span class="comment">// |   569.77|       true|</span></span><br><span class="line"><span class="comment">// |   607.49|       true|</span></span><br><span class="line"><span class="comment">// +---------+-----------+</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL (ë™ì¼ í‘œí˜„)</span></span><br><span class="line"><span class="keyword">SELECT</span> UnitPrice, (StockCode <span class="operator">=</span> <span class="string">&#x27;DOT&#x27;</span> <span class="keyword">AND</span></span><br><span class="line">  (UnitPrice <span class="operator">&gt;</span> <span class="number">600</span> <span class="keyword">OR</span> instr(Description, &quot;POSTAGE&quot;) <span class="operator">&gt;=</span> <span class="number">1</span>)) <span class="keyword">as</span> isExpensive</span><br><span class="line"><span class="keyword">FROM</span> dfTable</span><br><span class="line"><span class="keyword">WHERE</span> (StockCode <span class="operator">=</span> <span class="string">&#x27;DOT&#x27;</span> <span class="keyword">AND</span></span><br><span class="line">       (UnitPrice <span class="operator">&gt;</span> <span class="number">600</span> <span class="keyword">OR</span> instr(Description, &quot;POSTAGE&quot;) <span class="operator">&gt;=</span> <span class="number">1</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// í•„í„°ëŠ” SQLë¡œ ì‚¬ìš©ì‹œ ë” í¸ë¦¬í•  ìˆ˜ë„. (ì•„ë˜ ë‘ ë¬¸ì¥ ë™ì¼í•˜ê²Œ ì²˜ë¦¬ë¨)</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.&#123;expr, not, col&#125;</span><br><span class="line"></span><br><span class="line">(df.withColumn(<span class="string">&quot;isExpensive&quot;</span>, not(col(<span class="string">&quot;UnitPrice&quot;</span>).leq(<span class="number">250</span>)))</span><br><span class="line">  .filter(<span class="string">&quot;isExpensive&quot;</span>)</span><br><span class="line">  .select(<span class="string">&quot;Description&quot;</span>, <span class="string">&quot;UnitPrice&quot;</span>).show(<span class="number">5</span>))</span><br><span class="line">(df.withColumn(<span class="string">&quot;isExpensive&quot;</span>, expr(<span class="string">&quot;NOT UnitPrice &lt;= 250&quot;</span>))</span><br><span class="line">  .filter(<span class="string">&quot;isExpensive&quot;</span>)</span><br><span class="line">  .select(<span class="string">&quot;Description&quot;</span>, <span class="string">&quot;UnitPrice&quot;</span>).show(<span class="number">5</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</details>


</li>
</ul>
<h3 id="6-4-ìˆ˜ì¹˜í˜•-ë°ì´í„°-íƒ€ì…-ë‹¤ë£¨ê¸°"><a href="#6-4-ìˆ˜ì¹˜í˜•-ë°ì´í„°-íƒ€ì…-ë‹¤ë£¨ê¸°" class="headerlink" title="6.4 ìˆ˜ì¹˜í˜• ë°ì´í„° íƒ€ì… ë‹¤ë£¨ê¸°"></a>6.4 ìˆ˜ì¹˜í˜• ë°ì´í„° íƒ€ì… ë‹¤ë£¨ê¸°</h3><ul>
<li><code>count()</code> <ul>
<li>ë¹…ë°ì´í„° ì²˜ë¦¬ ì‹œ, í•„í„°ë§ ë‹¤ìŒìœ¼ë¡œ ë§ì´ ìˆ˜í–‰í•˜ëŠ” ì‘ì—…</li>
<li>ìˆ˜ì¹˜í˜• ë°ì´í„° íƒ€ì…ì„ ì‚¬ìš©í•œ ì—°ì‚° ë°©ì‹ ì •ì˜</li>
</ul>
</li>
<li>ìì£¼ ì‚¬ìš©í•˜ëŠ” ìˆ˜ì¹˜í˜• í•¨ìˆ˜<ul>
<li><code>pow(ë°‘, ì§€ìˆ˜)</code> (ê±°ë“­ì œê³±)</li>
<li><code>round()</code> (ë°˜ì˜¬ë¦¼), <code>bround()</code> (ë‚´ë¦¼)</li>
<li><code>corr()</code> =&gt; í”¼ì–´ìŠ¨ ìƒê´€ê³„ìˆ˜ ê³„ì‚° (= ë‘ ì»¬ëŸ¼ì˜ ìƒê´€ê´€ê³„)</li>
<li><code>describe()</code> =&gt; ê´€ë ¨ ì»¬ëŸ¼ì— ëŒ€í•œ ì§‘ê³„(count), í‰ê· (mean), í‘œì¤€í¸ì°¨(stddev), ìµœì†Ÿê°’(min), ìµœëŒ“ê°’(max) ë“± ê³„ì‚°<ul>
<li>í•˜ë‚˜ ì´ìƒì˜ ì»¬ëŸ¼ì—ëŒ€í•œ ìš”ì•½ í†µê³„ ê³„ì‚°</li>
<li>ê·¸ëŸ¬ë‚˜ ì½˜ì†” í™•ì¸ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©í•´ì•¼í•¨ (í†µê³„ ìŠ¤í‚¤ë§ˆëŠ” ë³€ê²½ ë  ìˆ˜ ìˆìŒ)</li>
<li>ì •í™•í•œ ìˆ˜ì¹˜ í•„ìš” ì‹œ =&gt; í•´ë‹¹ í•¨ìˆ˜ ì„í¬íŠ¸í•´ì„œ ì ìš©í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ <strong>ì§ì ‘ ì§‘ê³„</strong></li>
</ul>
</li>
</ul>
</li>
<li><strong>StatFunction</strong> íŒ¨í‚¤ì§€ =&gt; ë‹¤ì–‘í•œ í†µê³„ í•¨ìˆ˜ ì œê³µ<ul>
<li>ë‹¤ì–‘í•œ í†µê³„ê°’ ê³„ì‚°ì— ì‚¬ìš©í•˜ëŠ” DataFrame ë©”ì„œë“œ =&gt; <code>df.stat</code> ìœ¼ë¡œ ì ‘ê·¼</li>
<li><code>approxQuantile()</code> : ë°ì´í„° ë°±ë¶„ìœ„ìˆ˜ ê³„ì‚° (ì •í™•í•˜ê²Œ or ê·¼ì‚¬ì¹˜ë¡œ?)</li>
<li><code>crosstab()</code> : êµì°¨í‘œ(cross-tabulation) í™•ì¸</li>
<li><code>freqItems()</code> : ìì£¼ ì‚¬ìš©í•˜ëŠ” í•­ëª© ìŒ í™•ì¸<ul>
<li>crosstab, freqItems ë“±ì€ ê²°ê³¼ê°€ ë„ˆë¬´ í¬ë©´ ë‹¤ ì¶œë ¥ X</li>
</ul>
</li>
<li><code>monotonically_increasing_id()</code> : ëª¨ë“  ë¡œìš°ì— ê³ ìœ  ID ê°’ ì¶”ê°€ (0 ~ )</li>
</ul>
</li>
<li>ìŠ¤íŒŒí¬ ìƒˆë¡œìš´ ë²„ì „ ë‚˜ì˜¬ ë•Œë§ˆë‹¤ ìƒˆë¡œìš´ í•¨ìˆ˜ ìƒê¹€<ul>
<li>=&gt; ìŠ¤íŒŒí¬ ê³µì‹ ë¬¸ì„œ ì°¸ì¡°<ul>
<li>ex. <code>rand()</code>, <code>randn()</code> (ì„ì˜ ë°ì´í„° ìƒì„± í•¨ìˆ˜)</li>
</ul>
</li>
<li>ìµœì‹  ë²„ì „ StatFunction íŒ¨í‚¤ì§€ëŠ” ì—¬ëŸ¬ ê³ ê¸‰ ê¸°ë²• ê´€ë ¨ í•¨ìˆ˜ ì œê³µí•˜ê¸°ë„<ul>
<li>bloom í•„í„°ë§, sketching algorithms ..</li>
<li>ìì„¸í•œ ë‚´ìš©ì€ <a target="_blank" rel="noopener" href="http://bit.ly/2ptAiY2">API docs</a></li>
<li>(ì‚¬ì‹¤ í˜„ì‹œì  ìµœì‹ ë²„ì „ì€ ì•„ë‹ˆê³  ì±…ê¸°ì¤€ ìµœì‹  2.2 ë²„ì „ì¸ ë“¯)</li>
</ul>
</li>
</ul>
</li>
</ul>
<details><summary class="point-color-can-hover">[6.4] ì˜ˆì œ í¼ì¹˜ê¸°</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.&#123;expr, pow&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ë‘ ì»¬ëŸ¼ ëª¨ë‘ ìˆ˜ì¹˜í˜• =&gt; ê³±ì…ˆ ì—°ì‚° ê°€ëŠ¥ (+ ë§ì…ˆ, ëº„ì…ˆ)</span></span><br><span class="line"><span class="keyword">val</span> fabricatedQuantity = pow(col(<span class="string">&quot;Quantity&quot;</span>) * col(<span class="string">&quot;UnitPrice&quot;</span>), <span class="number">2</span>) + <span class="number">5</span></span><br><span class="line">df.select(expr(<span class="string">&quot;CustomerId&quot;</span>), fabricatedQuantity.alias(<span class="string">&quot;realQuantity&quot;</span>)).show(<span class="number">2</span>)</span><br><span class="line"><span class="comment">// +----------+------------------+</span></span><br><span class="line"><span class="comment">// |CustomerId|      realQuantity|</span></span><br><span class="line"><span class="comment">// +----------+------------------+</span></span><br><span class="line"><span class="comment">// |   17850.0|239.08999999999997|</span></span><br><span class="line"><span class="comment">// |   17850.0|          418.7156|</span></span><br><span class="line"><span class="comment">// +----------+------------------+</span></span><br><span class="line"></span><br><span class="line">df.selectExpr(</span><br><span class="line">  <span class="string">&quot;CustomerId&quot;</span>,</span><br><span class="line">  <span class="string">&quot;(POWER((Quantity * UnitPrice), 2.0) + 5) as realQuantity&quot;</span>).show(<span class="number">2</span>)</span><br><span class="line"><span class="comment">// +----------+------------------+</span></span><br><span class="line"><span class="comment">// |CustomerId|      realQuantity|</span></span><br><span class="line"><span class="comment">// +----------+------------------+</span></span><br><span class="line"><span class="comment">// |   17850.0|239.08999999999997|</span></span><br><span class="line"><span class="comment">// |   17850.0|          418.7156|</span></span><br><span class="line"><span class="comment">// +----------+------------------+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ë°˜ì˜¬ë¦¼(round) ì˜ˆì œ</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.&#123;round, bround&#125;</span><br><span class="line">df.select(round(col(<span class="string">&quot;UnitPrice&quot;</span>), <span class="number">1</span>).alias(<span class="string">&quot;rounded&quot;</span>), col(<span class="string">&quot;UnitPrice&quot;</span>)).show(<span class="number">5</span>)</span><br><span class="line"><span class="comment">// +-------+---------+</span></span><br><span class="line"><span class="comment">// |rounded|UnitPrice|</span></span><br><span class="line"><span class="comment">// +-------+---------+</span></span><br><span class="line"><span class="comment">// |    2.6|     2.55|</span></span><br><span class="line"><span class="comment">// |    3.4|     3.39|</span></span><br><span class="line"><span class="comment">// |    2.8|     2.75|</span></span><br><span class="line"><span class="comment">// |    3.4|     3.39|</span></span><br><span class="line"><span class="comment">// |    3.4|     3.39|</span></span><br><span class="line"><span class="comment">// +-------+---------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ë‚´ë¦¼(bround) ì˜ˆì œ</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.lit</span><br><span class="line">df.select(round(lit(<span class="string">&quot;2.5&quot;</span>)), bround(lit(<span class="string">&quot;2.5&quot;</span>))).show(<span class="number">2</span>)</span><br><span class="line"><span class="comment">// +-------------+--------------+</span></span><br><span class="line"><span class="comment">// |round(2.5, 0)|bround(2.5, 0)|</span></span><br><span class="line"><span class="comment">// +-------------+--------------+</span></span><br><span class="line"><span class="comment">// |          3.0|           2.0|</span></span><br><span class="line"><span class="comment">// |          3.0|           2.0|</span></span><br><span class="line"><span class="comment">// +-------------+--------------+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// í”¼ì–´ìŠ¨ ìƒê´€ê³„ìˆ˜ ê³„ì‚° ì˜ˆì œ</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.&#123;corr&#125;</span><br><span class="line">df.stat.corr(<span class="string">&quot;Quantity&quot;</span>, <span class="string">&quot;UnitPrice&quot;</span>)</span><br><span class="line">df.select(corr(<span class="string">&quot;Quantity&quot;</span>, <span class="string">&quot;UnitPrice&quot;</span>)).show()</span><br><span class="line"><span class="comment">// res52: Double = -0.04112314436835551</span></span><br><span class="line"><span class="comment">// +-------------------------+</span></span><br><span class="line"><span class="comment">// |corr(Quantity, UnitPrice)|</span></span><br><span class="line"><span class="comment">// +-------------------------+</span></span><br><span class="line"><span class="comment">// |     -0.04112314436835551|</span></span><br><span class="line"><span class="comment">// +-------------------------+</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL (ë™ì¼ í‘œí˜„)</span></span><br><span class="line"><span class="keyword">SELECT</span> customerId, (<span class="built_in">POWER</span>((Quantity <span class="operator">*</span> UnitPrice), <span class="number">2.0</span>) <span class="operator">+</span> <span class="number">5</span>) <span class="keyword">as</span> realQuantity</span><br><span class="line"><span class="keyword">FROM</span> dfTable</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> round(<span class="number">2.5</span>), bround(<span class="number">2.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">corr</span>(Quantity, UnitPrice) <span class="keyword">FROM</span> dfTable</span><br></pre></td></tr></table></figure>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ì½˜ì†”ìš© ìš”ì•½ í†µê³„ (describe)</span></span><br><span class="line">df.describe().show()</span><br><span class="line"><span class="comment">// +-------+-----------------+------------------+--------------------+------------------+------------------+------------------+--------------+</span></span><br><span class="line"><span class="comment">// |summary|        InvoiceNo|         StockCode|         Description|          Quantity|         UnitPrice|        CustomerID|       Country|</span></span><br><span class="line"><span class="comment">// +-------+-----------------+------------------+--------------------+------------------+------------------+------------------+--------------+</span></span><br><span class="line"><span class="comment">// |  count|             3108|              3108|                3098|              3108|              3108|              1968|          3108|</span></span><br><span class="line"><span class="comment">// |   mean| 536516.684944841|27834.304044117645|                null| 8.627413127413128| 4.151946589446603|15661.388719512195|          null|</span></span><br><span class="line"><span class="comment">// | stddev|72.89447869788873|17407.897548583845|                null|26.371821677029203|15.638659854603892|1854.4496996893627|          null|</span></span><br><span class="line"><span class="comment">// |    min|           536365|             10002| 4 PURPLE FLOCK D...|               -24|               0.0|           12431.0|     Australia|</span></span><br><span class="line"><span class="comment">// |    max|          C536548|              POST|ZINC WILLIE WINKI...|               600|            607.49|           18229.0|United Kingdom|</span></span><br><span class="line"><span class="comment">// +-------+-----------------+------------------+--------------------+------------------+------------------+------------------+--------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// &#x27;ì§ì ‘ ì§‘ê³„&#x27;&#x27; í•„ìš” ì‹œ =&gt; í•¨ìˆ˜ ì„í¬íŠ¸</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.&#123;count, mean, stddev_pop, min, max&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// StatFunctions package (ë‹¤ì–‘í•œ í†µê³„ í•¨ìˆ˜) ì˜ˆì œ</span></span><br><span class="line"><span class="comment">// approxQuantile() : ë°ì´í„° ë°±ë¶„ìœ„ìˆ˜ ê³„ì‚°</span></span><br><span class="line"><span class="keyword">val</span> colName = <span class="string">&quot;UnitPrice&quot;</span></span><br><span class="line"><span class="keyword">val</span> quantileProbs = <span class="type">Array</span>(<span class="number">0.5</span>)</span><br><span class="line"><span class="keyword">val</span> relError = <span class="number">0.05</span></span><br><span class="line">df.stat.approxQuantile(<span class="string">&quot;UnitPrice&quot;</span>, quantileProbs, relError)</span><br><span class="line"><span class="comment">// res61: Array[Double] = Array(2.51)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1) crosstab() : êµì°¨í‘œ í™•ì¸</span></span><br><span class="line">df.stat.crosstab(<span class="string">&quot;StockCode&quot;</span>, <span class="string">&quot;Quantity&quot;</span>).show()</span><br><span class="line"><span class="comment">// +------------------+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+</span></span><br><span class="line"><span class="comment">// |StockCode_Quantity| -1|-10|-12| -2|-24| -3| -4| -5| -6| -7|  1| 10|100| 11| 12|120|128| 13| 14|144| 15| 16| 17| 18| 19|192|  2| 20|200| 21|216| 22| 23| 24| 25|252| 27| 28|288|  3| 30| 32| 33| 34| 36|384|  4| 40|432| 47| 48|480|  5| 50| 56|  6| 60|600| 64|  7| 70| 72|  8| 80|  9| 96|</span></span><br><span class="line"><span class="comment">// +------------------+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+</span></span><br><span class="line"><span class="comment">// |             22578|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|</span></span><br><span class="line"><span class="comment">// |             21327|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  2|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|</span></span><br><span class="line"><span class="comment">// |             22064|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|</span></span><br><span class="line"><span class="comment">// |             21080|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|</span></span><br><span class="line"><span class="comment">// |             22219|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  3|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|</span></span><br><span class="line"><span class="comment">// |             21908|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|</span></span><br><span class="line"><span class="comment">// |             22818|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|</span></span><br><span class="line"><span class="comment">// |           15056BL|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|</span></span><br><span class="line"><span class="comment">// |             72817|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|</span></span><br><span class="line"><span class="comment">// |             22545|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|</span></span><br><span class="line"><span class="comment">// |             22988|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|</span></span><br><span class="line"><span class="comment">// |             22274|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|</span></span><br><span class="line"><span class="comment">// |             20750|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  2|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|</span></span><br><span class="line"><span class="comment">// |            82616C|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|</span></span><br><span class="line"><span class="comment">// |             21703|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|</span></span><br><span class="line"><span class="comment">// |             22899|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  2|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|</span></span><br><span class="line"><span class="comment">// |             22379|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  2|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|</span></span><br><span class="line"><span class="comment">// |             22422|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  2|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|</span></span><br><span class="line"><span class="comment">// |             22769|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|</span></span><br><span class="line"><span class="comment">// |             22585|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|  1|  0|  0|  1|  0|  0|  0|  0|  0|  0|  0|  0|  0|  0|</span></span><br><span class="line"><span class="comment">// +------------------+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+---+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2) freqItems() : ìì£¼ ì‚¬ìš©í•˜ëŠ” í•­ëª© ìŒ í™•ì¸</span></span><br><span class="line">df.stat.freqItems(<span class="type">Seq</span>(<span class="string">&quot;StockCode&quot;</span>, <span class="string">&quot;Quantity&quot;</span>)).show()</span><br><span class="line"><span class="comment">// +--------------------+--------------------+</span></span><br><span class="line"><span class="comment">// | StockCode_freqItems|  Quantity_freqItems|</span></span><br><span class="line"><span class="comment">// +--------------------+--------------------+</span></span><br><span class="line"><span class="comment">// |[90214E, 20728, 2...|[200, 128, 23, 32...|</span></span><br><span class="line"><span class="comment">// +--------------------+--------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3) monotonically_increasing_id() : ë¡œìš°ì— ê³ ìœ  ID ê°’ ì¶”ê°€</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.monotonically_increasing_id</span><br><span class="line">df.select(monotonically_increasing_id()).show(<span class="number">2</span>)</span><br><span class="line"><span class="comment">// +-----------------------------+</span></span><br><span class="line"><span class="comment">// |monotonically_increasing_id()|</span></span><br><span class="line"><span class="comment">// +-----------------------------+</span></span><br><span class="line"><span class="comment">// |                            0|</span></span><br><span class="line"><span class="comment">// |                            1|</span></span><br><span class="line"><span class="comment">// +-----------------------------+</span></span><br></pre></td></tr></table></figure>
</details>

<h3 id="6-5-ë¬¸ìì—´-ë°ì´í„°-íƒ€ì…-ë‹¤ë£¨ê¸°"><a href="#6-5-ë¬¸ìì—´-ë°ì´í„°-íƒ€ì…-ë‹¤ë£¨ê¸°" class="headerlink" title="6.5 ë¬¸ìì—´ ë°ì´í„° íƒ€ì… ë‹¤ë£¨ê¸°"></a>6.5 ë¬¸ìì—´ ë°ì´í„° íƒ€ì… ë‹¤ë£¨ê¸°</h3><ul>
<li><p>ë¬¸ìì—´ ë‹¤ë£¨ê¸° = ê±°ì˜ ëª¨ë“  ë°ì´í„° ì²˜ë¦¬ ê³¼ì •ì—ì„œ ë°œìƒ</p>
<ul>
<li>ë¡œê·¸ íŒŒì¼ì— ì •ê·œ í‘œí˜„ì‹ì„ ì‚¬ìš©í•œ ë°ì´í„° ì¶”ì¶œ, ë°ì´í„° ì¹˜í™˜, ë¬¸ìì—´ ì¡´ì¬ ì—¬ë¶€, ëŒ€/ì†Œë¬¸ì ë³€í™˜ ì²˜ë¦¬ ë“±</li>
</ul>
</li>
<li><p>ëŒ€ì†Œë¬¸ì ë³€í™˜ ì‘ì—…</p>
<ul>
<li><code>initcap()</code> =&gt; ê³µë°±ìœ¼ë¡œ êµ¬ë¶„ëœ ëª¨ë“  ë‹¨ì–´ì˜ ì²« ê¸€ì ëŒ€ë¬¸ìë¡œ ë³€í™˜</li>
<li><code>lower()</code> (ì „ì²´ ì†Œë¬¸ìë¡œ ë³€í™˜) / <code>upper()</code> (ì „ì²´ ëŒ€ë¬¸ìë¡œ ë³€í™˜)</li>
</ul>
</li>
<li><p>ë¬¸ìì—´ ì£¼ë³€ ê³µë°± ì œê±°/ì¶”ê°€</p>
<ul>
<li><p><code>lpad()</code>, <code>ltrim()</code>, <code>rpad()</code>, <code>rtrim()</code>, <code>trim()</code></p>
<details><summary class="point-color-can-hover">[6.5-1] ì˜ˆì œ í¼ì¹˜ê¸° - ë¬¸ìì—´ ë³€í™˜</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.&#123;initcap&#125;</span><br><span class="line">df.select(initcap(col(<span class="string">&quot;Description&quot;</span>))).show(<span class="number">2</span>, <span class="literal">false</span>)</span><br><span class="line"><span class="comment">// +----------------------------------+</span></span><br><span class="line"><span class="comment">// |initcap(Description)              |</span></span><br><span class="line"><span class="comment">// +----------------------------------+</span></span><br><span class="line"><span class="comment">// |White Hanging Heart T-light Holder|</span></span><br><span class="line"><span class="comment">// |White Metal Lantern               |</span></span><br><span class="line"><span class="comment">// +----------------------------------+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.&#123;lower, upper&#125;</span><br><span class="line">df.select(col(<span class="string">&quot;Description&quot;</span>),</span><br><span class="line">  lower(col(<span class="string">&quot;Description&quot;</span>)),</span><br><span class="line">  upper(lower(col(<span class="string">&quot;Description&quot;</span>)))).show(<span class="number">2</span>)</span><br><span class="line"><span class="comment">// +--------------------+--------------------+-------------------------+</span></span><br><span class="line"><span class="comment">// |         Description|  lower(Description)|upper(lower(Description))|</span></span><br><span class="line"><span class="comment">// +--------------------+--------------------+-------------------------+</span></span><br><span class="line"><span class="comment">// |WHITE HANGING HEA...|white hanging hea...|     WHITE HANGING HEA...|</span></span><br><span class="line"><span class="comment">// | WHITE METAL LANTERN| white metal lantern|      WHITE METAL LANTERN|</span></span><br><span class="line"><span class="comment">// +--------------------+--------------------+-------------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.&#123;lit, ltrim, rtrim, rpad, lpad, trim&#125;</span><br><span class="line">df.select(</span><br><span class="line">    ltrim(lit(<span class="string">&quot;    HELLO    &quot;</span>)).as(<span class="string">&quot;ltrim&quot;</span>),</span><br><span class="line">    rtrim(lit(<span class="string">&quot;    HELLO    &quot;</span>)).as(<span class="string">&quot;rtrim&quot;</span>),</span><br><span class="line">    trim(lit(<span class="string">&quot;    HELLO    &quot;</span>)).as(<span class="string">&quot;trim&quot;</span>),</span><br><span class="line">    lpad(lit(<span class="string">&quot;HELLO&quot;</span>), <span class="number">3</span>, <span class="string">&quot; &quot;</span>).as(<span class="string">&quot;lp&quot;</span>),</span><br><span class="line">    rpad(lit(<span class="string">&quot;HELLO&quot;</span>), <span class="number">10</span>, <span class="string">&quot; &quot;</span>).as(<span class="string">&quot;rp&quot;</span>)).show(<span class="number">2</span>)</span><br><span class="line"><span class="comment">// +---------+---------+-----+---+----------+</span></span><br><span class="line"><span class="comment">// |    ltrim|    rtrim| trim| lp|        rp|</span></span><br><span class="line"><span class="comment">// +---------+---------+-----+---+----------+</span></span><br><span class="line"><span class="comment">// |HELLO    |    HELLO|HELLO|HEL|HELLO     |</span></span><br><span class="line"><span class="comment">// |HELLO    |    HELLO|HELLO|HEL|HELLO     |</span></span><br><span class="line"><span class="comment">// +---------+---------+-----+---+----------+</span></span><br></pre></td></tr></table></figure>
</details>
</li>
</ul>
</li>
<li><p>ì •ê·œí‘œí˜„ì‹</p>
<ul>
<li><p>ìŠ¤íŒŒí¬ëŠ” <strong>ìë°” ì •ê·œ í‘œí˜„ì‹ ë¬¸ë²•</strong> ì‚¬ìš©</p>
</li>
<li><p><code>regexp_extract()</code>, <code>regexp_replace()</code> =&gt; ê°’ ì¶”ì¶œ ë° ì¹˜í™˜</p>
</li>
<li><p><code>translate(column, from_string, to_string)</code> ì‚¬ìš©í•œ ì¹˜í™˜ ê°€ëŠ¥</p>
</li>
<li><p>ê°’ ì¡´ì¬ ì—¬ë¶€ í™•ì¸ ë°©ë²•?</p>
<ul>
<li>ìŠ¤ì¹¼ë¼ ì‚¬ìš© ì‹œ <code>contains()</code> ì‚¬ìš©</li>
<li>íŒŒì´ì¬, SQL ì‚¬ìš© ì‹œ <code>instr()</code> ì‚¬ìš©</li>
</ul>
</li>
<li><p>ë™ì ìœ¼ë¡œ ì¸ìˆ˜ì˜ ê°œìˆ˜ê°€ ë³€í•˜ëŠ” ìƒí™©ì—ì„œëŠ”</p>
<ul>
<li>ìŠ¤ì¹¼ë¼ ê³ ìœ  ê¸°ëŠ¥ <code>varargs()</code> ì‚¬ìš©</li>
<li>íŒŒì´ì¬ì€ <code>locate()</code> (ë¬¸ìì—´ ìœ„ì¹˜ë¥¼ ì •ìˆ˜ë¡œ ë°˜í™˜. ìœ„ì¹˜ëŠ” 1 ~) + ìœ„ì¹˜ ì •ë³´ ë¶ˆë¦¬ì–¸ìœ¼ë¡œ ë³€í™˜</li>
</ul>
<details><summary class="point-color-can-hover">[6.5-2] ì˜ˆì œ í¼ì¹˜ê¸° - ë¬¸ìì—´ ë³€í™˜</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.regexp_replace</span><br><span class="line"><span class="keyword">val</span> simpleColors = <span class="type">Seq</span>(<span class="string">&quot;black&quot;</span>, <span class="string">&quot;white&quot;</span>, <span class="string">&quot;red&quot;</span>, <span class="string">&quot;green&quot;</span>, <span class="string">&quot;blue&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> regexString = simpleColors.map(_.toUpperCase).mkString(<span class="string">&quot;|&quot;</span>)</span><br><span class="line"><span class="comment">// the | signifies `OR` in regular expression syntax</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// df.select(</span></span><br><span class="line"><span class="comment">//   regexp_replace(col(&quot;Description&quot;), regexString, &quot;COLOR&quot;).alias(&quot;color_clean&quot;),</span></span><br><span class="line"><span class="comment">//   col(&quot;Description&quot;)).show(2)</span></span><br><span class="line"><span class="comment">// regexString: String = BLACK|WHITE|RED|GREEN|BLUE</span></span><br><span class="line"><span class="comment">// +--------------------+--------------------+</span></span><br><span class="line"><span class="comment">// |         color_clean|         Description|</span></span><br><span class="line"><span class="comment">// +--------------------+--------------------+</span></span><br><span class="line"><span class="comment">// |COLOR HANGING HEA...|WHITE HANGING HEA...|</span></span><br><span class="line"><span class="comment">// | COLOR METAL LANTERN| WHITE METAL LANTERN|</span></span><br><span class="line"><span class="comment">// +--------------------+--------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.translate</span><br><span class="line">(df.select(translate(col(<span class="string">&quot;Description&quot;</span>), <span class="string">&quot;LEET&quot;</span>, <span class="string">&quot;1337&quot;</span>), col(<span class="string">&quot;Description&quot;</span>))</span><br><span class="line">  .show(<span class="number">2</span>))</span><br><span class="line"><span class="comment">// +----------------------------------+--------------------+</span></span><br><span class="line"><span class="comment">// |translate(Description, LEET, 1337)|         Description|</span></span><br><span class="line"><span class="comment">// +----------------------------------+--------------------+</span></span><br><span class="line"><span class="comment">// |              WHI73 HANGING H3A...|WHITE HANGING HEA...|</span></span><br><span class="line"><span class="comment">// |               WHI73 M37A1 1AN73RN| WHITE METAL LANTERN|</span></span><br><span class="line"><span class="comment">// +----------------------------------+--------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.regexp_extract</span><br><span class="line"><span class="keyword">val</span> regexString = simpleColors.map(_.toUpperCase).mkString(<span class="string">&quot;(&quot;</span>, <span class="string">&quot;|&quot;</span>, <span class="string">&quot;)&quot;</span>)</span><br><span class="line"><span class="comment">// the | signifies OR in regular expression syntax</span></span><br><span class="line">df.select(</span><br><span class="line">     regexp_extract(col(<span class="string">&quot;Description&quot;</span>), regexString, <span class="number">1</span>).alias(<span class="string">&quot;color_clean&quot;</span>),</span><br><span class="line">     col(<span class="string">&quot;Description&quot;</span>)).show(<span class="number">2</span>)</span><br><span class="line"><span class="comment">// +-----------+--------------------+</span></span><br><span class="line"><span class="comment">// |color_clean|         Description|</span></span><br><span class="line"><span class="comment">// +-----------+--------------------+</span></span><br><span class="line"><span class="comment">// |      WHITE|WHITE HANGING HEA...|</span></span><br><span class="line"><span class="comment">// |      WHITE| WHITE METAL LANTERN|</span></span><br><span class="line"><span class="comment">// +-----------+--------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> containsBlack = col(<span class="string">&quot;Description&quot;</span>).contains(<span class="string">&quot;BLACK&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> containsWhite = col(<span class="string">&quot;DESCRIPTION&quot;</span>).contains(<span class="string">&quot;WHITE&quot;</span>)</span><br><span class="line">(df.withColumn(<span class="string">&quot;hasSimpleColor&quot;</span>, containsBlack.or(containsWhite))</span><br><span class="line">  .where(<span class="string">&quot;hasSimpleColor&quot;</span>)</span><br><span class="line">  .select(<span class="string">&quot;Description&quot;</span>).show(<span class="number">3</span>, <span class="literal">false</span>))</span><br><span class="line"><span class="comment">// +----------------------------------+</span></span><br><span class="line"><span class="comment">// |Description                       |</span></span><br><span class="line"><span class="comment">// +----------------------------------+</span></span><br><span class="line"><span class="comment">// |WHITE HANGING HEART T-LIGHT HOLDER|</span></span><br><span class="line"><span class="comment">// |WHITE METAL LANTERN               |</span></span><br><span class="line"><span class="comment">// |RED WOOLLY HOTTIE WHITE HEART.    |</span></span><br><span class="line"><span class="comment">// +----------------------------------+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> simpleColors = <span class="type">Seq</span>(<span class="string">&quot;black&quot;</span>, <span class="string">&quot;white&quot;</span>, <span class="string">&quot;red&quot;</span>, <span class="string">&quot;green&quot;</span>, <span class="string">&quot;blue&quot;</span>)</span><br><span class="line"><span class="keyword">val</span> selectedColumns = simpleColors.map(color =&gt; &#123;</span><br><span class="line">   col(<span class="string">&quot;Description&quot;</span>).contains(color.toUpperCase).alias(<span class="string">s&quot;is_<span class="subst">$color</span>&quot;</span>)</span><br><span class="line">&#125;):+expr(<span class="string">&quot;*&quot;</span>) <span class="comment">// Column íƒ€ì…ì´ì—¬ì•¼ í•©ë‹ˆë‹¤</span></span><br><span class="line">(df.select(selectedColumns:_*).where(col(<span class="string">&quot;is_white&quot;</span>).or(col(<span class="string">&quot;is_red&quot;</span>)))</span><br><span class="line">  .select(<span class="string">&quot;Description&quot;</span>).show(<span class="number">3</span>, <span class="literal">false</span>))</span><br><span class="line"><span class="comment">// +----------------------------------+</span></span><br><span class="line"><span class="comment">// |Description                       |</span></span><br><span class="line"><span class="comment">// +----------------------------------+</span></span><br><span class="line"><span class="comment">// |WHITE HANGING HEART T-LIGHT HOLDER|</span></span><br><span class="line"><span class="comment">// |WHITE METAL LANTERN               |</span></span><br><span class="line"><span class="comment">// |RED WOOLLY HOTTIE WHITE HEART.    |</span></span><br><span class="line"><span class="comment">// +----------------------------------+</span></span><br></pre></td></tr></table></figure>
</details>


</li>
</ul>
</li>
</ul>
<h3 id="6-6-ë‚ ì§œì™€-íƒ€ì„ìŠ¤íƒ¬í”„-ë°ì´í„°-íƒ€ì…-ë‹¤ë£¨ê¸°"><a href="#6-6-ë‚ ì§œì™€-íƒ€ì„ìŠ¤íƒ¬í”„-ë°ì´í„°-íƒ€ì…-ë‹¤ë£¨ê¸°" class="headerlink" title="6.6 ë‚ ì§œì™€ íƒ€ì„ìŠ¤íƒ¬í”„ ë°ì´í„° íƒ€ì… ë‹¤ë£¨ê¸°"></a>6.6 ë‚ ì§œì™€ íƒ€ì„ìŠ¤íƒ¬í”„ ë°ì´í„° íƒ€ì… ë‹¤ë£¨ê¸°</h3><ul>
<li><p>ë‚ ì§œ/ì‹œê°„ ì‚¬ìš© ì‹œ ì‹œê°„ëŒ€ (timezone) ì™€ í¬ë§·ì˜ ìœ íš¨ì„± í™•ì¸ í•„ìš”</p>
<ul>
<li>=&gt; ìŠ¤íŒŒí¬ëŠ” ë‘ ê°€ì§€ ì •ë³´ë§Œ ì§‘ì¤‘ì ìœ¼ë¡œ ê´€ë¦¬</li>
<li><strong>ë‚ ì§œ</strong> (date) &amp; <strong>íƒ€ì„ìŠ¤íƒ¬í”„</strong> (timestamp)</li>
<li>inferSchema ì˜µì…˜ í™œì„±í™”ëœ ê²½ìš°, ë‘ ì •ë³´ë¥¼ í¬í•¨í•´ ë°ì´í„° íƒ€ì…ì„ ìµœëŒ€í•œ ì •í™•íˆ ì‹ë³„</li>
<li>ìŠ¤íŒŒí¬ëŠ” íŠ¹ì • ë‚ ì§œ í¬ë§· ëª…ì‹œ ì—†ì´ë„ ìì²´ì ìœ¼ë¡œ ì‹ë³„</li>
</ul>
</li>
<li><p>ë‚ ì§œ, ì‹œê°„ì„ ë¬¸ìì—´ë¡œ ì €ì¥ &lt;-&gt; ëŸ°íƒ€ì„ì— ë‚ ì§œ íƒ€ì…ìœ¼ë¡œ ë³€í™˜</p>
<ul>
<li>í…ìŠ¤íŠ¸, CSV íŒŒì¼ ë‹¤ë£° ì‹œ ë§ì´ ë°œìƒí•˜ëŠ” ë°©ì‹</li>
<li>ìŠ¤íŒŒí¬ 2.1 ì´í•˜) ì‹œê°„ëŒ€ ë¯¸ì§€ì • ì‹œ, ì‹œìŠ¤í…œ ì‹œê°„ëŒ€ ê¸°ì¤€ìœ¼ë¡œ íŒŒì‹±<ul>
<li>ì‹œê°„ëŒ€ ì„¤ì •? =&gt; <code>spark.conf.sessionLocalTimeZone</code> ì†ì„±ì„ ë¡œì»¬ ì‹œê°„ëŒ€ë¡œ ì§€ì • - <a target="_blank" rel="noopener" href="https://bit.ly/2NcW6p2">Java TimeZone í¬ë§·</a> ë”°ë¦„)</li>
</ul>
</li>
<li>ìŠ¤íŒŒí¬ 2.3 ì´ìƒ) <code>spark.conf.set(&quot;spark.sql.session.timeZone&quot;, &quot;UTC&quot;)</code> ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥</li>
</ul>
</li>
<li><p>TimestampType í´ë˜ìŠ¤ëŠ” ì´ˆ ë‹¨ìœ„ ì •ë°€ë„ê¹Œì§€ë§Œ ì§€ì›</p>
<ul>
<li>ë°€ë¦¬ì„¸ì»¨ë“œ(ms), ë§ˆì´í¬ë¡œì„¸ì»¨ë“œ(Î¼s) ì§€ì› X =&gt; í•„ìš” ì‹œ Long ë°ì´í„°íƒ€ì… ì‚¬ìš©í•´ì„œ ìš°íšŒ</li>
<li>íŠ¹ì´í•œ í¬ë§·ì˜ ë‚ ì§œ/ì‹œê°„ ë°ì´í„°ë¥¼ ë‹¤ë¤„ì•¼í•œë‹¤ë©´ =&gt; ê° ë‹¨ê³„ë³„ ë°ì´í„°íƒ€ì…ê³¼ í¬ë§· ì •í™•íˆ íŒŒì•… í›„ íŠ¸ëœìŠ¤í¬ë©”ì´ì…˜ ì ìš© í•´ì•¼í•¨</li>
</ul>
</li>
<li><p>ìŠ¤íŒŒí¬ëŠ” íŠ¹ì • ì‹œì ì— ë°ì´í„° í¬ë§·ì´ íŠ¹ì´í•˜ê²Œ ë³€í•  ìˆ˜ ìˆë‹¤</p>
<ul>
<li>ì‹«ë‹¤ë©´ íŒŒì‹±ì´ë‚˜ ë³€í™˜ ì‘ì—… í•„ìš”</li>
<li>ìŠ¤íŒŒí¬ëŠ” <strong>ìë°”ì˜ ë‚ ì§œì™€ íƒ€ì„ìŠ¤íƒ¬í”„</strong> ì‚¬ìš© (í‘œì¤€ ì²´ê³„)</li>
</ul>
</li>
<li><p>ìì£¼ ì‚¬ìš©í•˜ëŠ” í•¨ìˆ˜</p>
<ul>
<li><p>ì˜¤ëŠ˜ ê¸°ì¤€ìœ¼ë¡œ Nì¼ ì „í›„ ë‚ ì§œ êµ¬í•˜ê¸°</p>
<ul>
<li><code>date_sub(ì»¬ëŸ¼, ëº„ ë‚ ì§œ ìˆ˜)</code> (ì±…ì—ëŠ” sum, ì˜¤íƒ€?)</li>
<li><code>date_add(ì»¬ëŸ¼, ë”í•  ë‚ ì§œ ìˆ˜)</code> </li>
</ul>
</li>
<li><p>ë‘ ë‚ ì§œ ì‚¬ì´ ì°¨ì´ êµ¬í•˜ê¸°</p>
<ul>
<li><code>datediff(ì»¬ëŸ¼1, ì»¬ëŸ¼2)</code> : ë‘ ë‚ ì§œ ì‚¬ì´ ì¼ ìˆ˜ ë°˜í™˜</li>
<li><code>months_between(ì»¬ëŸ¼1, ì»¬ëŸ¼2)</code> : ë‘ ë‚ ì§œ ì‚¬ì´ ê°œì›” ìˆ˜ ë°˜í™˜</li>
</ul>
<details><summary class="point-color-can-hover">[6.6-1] ì˜ˆì œ í¼ì¹˜ê¸° - ë‚ ì§œ êµ¬í•˜ê¸° ë° ë¹„êµ</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// df.printSchema()</span></span><br><span class="line"><span class="comment">// root</span></span><br><span class="line"><span class="comment">//  |-- InvoiceNo: string (nullable = true)</span></span><br><span class="line"><span class="comment">//  |-- StockCode: string (nullable = true)</span></span><br><span class="line"><span class="comment">//  |-- Description: string (nullable = true)</span></span><br><span class="line"><span class="comment">//  |-- Quantity: integer (nullable = true)</span></span><br><span class="line"><span class="comment">//  |-- InvoiceDate: timestamp (nullable = true)</span></span><br><span class="line"><span class="comment">//  |-- UnitPrice: double (nullable = true)</span></span><br><span class="line"><span class="comment">//  |-- CustomerID: double (nullable = true)</span></span><br><span class="line"><span class="comment">//  |-- Country: string (nullable = true)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ì˜ˆì œ1) ì˜¤ëŠ˜ ë‚ ì§œ / í˜„ì¬ íƒ€ì„ìŠ¤íƒ¬í”„ ê°’ êµ¬í•˜ê¸°</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.&#123;current_date, current_timestamp&#125;</span><br><span class="line"><span class="keyword">val</span> dateDF = (spark.range(<span class="number">10</span>)</span><br><span class="line">  .withColumn(<span class="string">&quot;today&quot;</span>, current_date())</span><br><span class="line">  .withColumn(<span class="string">&quot;now&quot;</span>, current_timestamp()))</span><br><span class="line">dateDF.createOrReplaceTempView(<span class="string">&quot;dateTable&quot;</span>)</span><br><span class="line"></span><br><span class="line">dateDF.printSchema()</span><br><span class="line"><span class="comment">// root</span></span><br><span class="line"><span class="comment">//  |-- id: long (nullable = false)</span></span><br><span class="line"><span class="comment">//  |-- today: date (nullable = false)</span></span><br><span class="line"><span class="comment">//  |-- now: timestamp (nullable = false)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ì˜ˆì œ2) ì˜¤ëŠ˜ ê¸°ì¤€ìœ¼ë¡œ 5ì¼ ì „ ë‚ ì§œ êµ¬í•˜ê¸°</span></span><br><span class="line"><span class="comment">// -- SQL : SELECT date_sub(today, 5), date_add(today, 5) FROM dateTable</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.&#123;date_add, date_sub&#125;</span><br><span class="line">dateDF.select(date_sub(col(<span class="string">&quot;today&quot;</span>), <span class="number">5</span>), date_add(col(<span class="string">&quot;today&quot;</span>), <span class="number">5</span>)).show(<span class="number">1</span>)</span><br><span class="line"><span class="comment">// +------------------+------------------+</span></span><br><span class="line"><span class="comment">// |date_sub(today, 5)|date_add(today, 5)|</span></span><br><span class="line"><span class="comment">// +------------------+------------------+</span></span><br><span class="line"><span class="comment">// |        2021-02-01|        2021-02-11|</span></span><br><span class="line"><span class="comment">// +------------------+------------------+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// ì˜ˆì œ3) ë‘ ë‚ ì§œ ì‚¬ì´ ì°¨ì´ ì¼ìˆ˜(ê°œì›”ìˆ˜) êµ¬í•˜ê¸°</span></span><br><span class="line"><span class="comment">// -- SQL : SELECT to_date(&#x27;2016-01-01&#x27;), months_between(&#x27;2016-01-01&#x27;, &#x27;2017-01-01&#x27;),</span></span><br><span class="line"><span class="comment">// datediff(&#x27;2016-01-01&#x27;, &#x27;2017-01-01&#x27;)</span></span><br><span class="line"><span class="comment">// FROM dateTable</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.&#123;datediff, months_between, to_date&#125;</span><br><span class="line">(dateDF.withColumn(<span class="string">&quot;week_ago&quot;</span>, date_sub(col(<span class="string">&quot;today&quot;</span>), <span class="number">7</span>))</span><br><span class="line">  .select(datediff(col(<span class="string">&quot;week_ago&quot;</span>), col(<span class="string">&quot;today&quot;</span>))).show(<span class="number">1</span>))</span><br><span class="line">(dateDF.select(</span><br><span class="line">    to_date(lit(<span class="string">&quot;2016-01-01&quot;</span>)).alias(<span class="string">&quot;start&quot;</span>),</span><br><span class="line">    to_date(lit(<span class="string">&quot;2017-05-22&quot;</span>)).alias(<span class="string">&quot;end&quot;</span>))</span><br><span class="line">  .select(months_between(col(<span class="string">&quot;start&quot;</span>), col(<span class="string">&quot;end&quot;</span>))).show(<span class="number">1</span>))</span><br><span class="line"><span class="comment">// +-------------------------+</span></span><br><span class="line"><span class="comment">// |datediff(week_ago, today)|</span></span><br><span class="line"><span class="comment">// +-------------------------+</span></span><br><span class="line"><span class="comment">// |                       -7|</span></span><br><span class="line"><span class="comment">// +-------------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// +--------------------------+</span></span><br><span class="line"><span class="comment">// |months_between(start, end)|</span></span><br><span class="line"><span class="comment">// +--------------------------+</span></span><br><span class="line"><span class="comment">// |              -16.67741935|</span></span><br><span class="line"><span class="comment">// +--------------------------+</span></span><br></pre></td></tr></table></figure>
</details>
</li>
</ul>
</li>
<li><p>ë‚ ì§œ ë³€í™˜ ë° íŒŒì‹±</p>
<ul>
<li>ì˜¬ë°”ë¥¸ í¬ë§·ê³¼ íƒ€ì… ì‚¬ìš© ì‹œ ë§¤ìš° ì‰¬ì›€</li>
<li>ë‚ ì§œë‚˜ íƒ€ì„ìŠ¤íƒ¬í”„ íƒ€ì… ì‚¬ìš© or â€˜yyy-MM-ddâ€™ í¬ë§·ì— ë§ëŠ” ë¬¸ìì—´ ì§€ì •</li>
<li><code>to_date()</code> : ë¬¸ìì—´ =&gt; ë‚ ì§œë¡œ ë³€í™˜ (option. ë‚ ì§œ í¬ë§· ì§€ì • ê°€ëŠ¥)<ul>
<li>ë‚ ì§œ í¬ë§· : ìë°”ì˜ <a target="_blank" rel="noopener" href="https://bit.ly/2Mz21Qc">SimpleDateFormat í´ë˜ìŠ¤ ì§€ì› í¬ë§· </a>ì‚¬ìš©</li>
</ul>
</li>
<li><code>to_timestamp()</code> : ë‚ ì§œ í¬ë§· í•„ìˆ˜ (ë¯¸ì§€ì •ì‹œ â€˜yyyy-MM-dd HH:mm:ssâ€™ í¬ë§· default)</li>
</ul>
</li>
<li><p>ë‚ ì§œ íŒŒì‹± ì‹¤íŒ¨ ì‹œ?</p>
<ul>
<li><p>=&gt; <strong>null ë°˜í™˜</strong> (ì—ëŸ¬ X)</p>
</li>
<li><p>ì˜ˆìƒì¹˜ ëª»í•œ í¬ë§·ì˜ ë°ì´í„°ê°€ ë‚˜íƒ€ë‚  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë””ë²„ê¹… ì–´ë ¤ì›€</p>
</li>
<li><p>ë¬¸ì œ íšŒí”¼í•  ìˆ˜ ìˆëŠ” ë°©ì‹</p>
<ul>
<li>1. ìë°” <a target="_blank" rel="noopener" href="https://docs.oracle.com/javase/8/docs/api/java/text/SimpleDateFormat.html">SimpleDateFormat</a> í‘œì¤€ì— ë§ì¶° ë‚ ì§œ í¬ë§· ì§€ì •</li>
<li>2. <code>to_date()</code>, <code>to_timestamp()</code> ì‚¬ìš©</li>
</ul>
</li>
<li><p>ì•”ì‹œì  í˜•ë³€í™˜(implicit type casting)ì€ ìœ„í—˜ =&gt; ëª…ì‹œì ìœ¼ë¡œ ë°ì´í„° íƒ€ì… ë³€í™˜í•´ì„œ ì‚¬ìš©í•  ê²ƒ</p>
<details><summary class="point-color-can-hover">[6.6-2] ì˜ˆì œ í¼ì¹˜ê¸° - ë‚ ì§œ ë³€í™˜ ë° íŒŒì‹±</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// to_date(ë¬¸ìì—´) : ë¬¸ìì—´ -&gt; ë‚ ì§œ </span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.&#123;to_date, lit&#125;</span><br><span class="line">(spark.range(<span class="number">5</span>).withColumn(<span class="string">&quot;date&quot;</span>, lit(<span class="string">&quot;2017-01-01&quot;</span>))</span><br><span class="line">  .select(to_date(col(<span class="string">&quot;date&quot;</span>))).show(<span class="number">1</span>))</span><br><span class="line"><span class="comment">// +---------------+</span></span><br><span class="line"><span class="comment">// |to_date(`date`)|</span></span><br><span class="line"><span class="comment">// +---------------+</span></span><br><span class="line"><span class="comment">// |     2017-01-01|</span></span><br><span class="line"><span class="comment">// +---------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// SimpleDateFormate í´ë˜ìŠ¤ ì§€ì› í¬ë§· ì‚¬ìš©í•´ì•¼</span></span><br><span class="line">dateDF.select(to_date(lit(<span class="string">&quot;2016-20-12&quot;</span>)),to_date(lit(<span class="string">&quot;2017-12-11&quot;</span>))).show(<span class="number">1</span>)</span><br><span class="line">+---------------------+---------------------+</span><br><span class="line">|to_date(<span class="symbol">&#x27;2016</span><span class="number">-20</span><span class="number">-12</span>&#x27;)|to_date(<span class="symbol">&#x27;2017</span><span class="number">-12</span><span class="number">-11</span>&#x27;)|</span><br><span class="line">+---------------------+---------------------+</span><br><span class="line">|                 <span class="literal">null</span>|           <span class="number">2017</span><span class="number">-12</span><span class="number">-11</span>|</span><br><span class="line">+---------------------+---------------------+</span><br></pre></td></tr></table></figure>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// to_date(ë¬¸ìì—´, ë‚ ì§œ í¬ë§·) =&gt; ë‚ ì§œí¬ë§· Option</span></span><br><span class="line"><span class="comment">// to_timestamp(ë¬¸ìì—´, ë‚ ì§œ í¬ë§·) =&gt; ë‚ ì§œí¬ë§· í•„ìˆ˜</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.to_date</span><br><span class="line"><span class="keyword">val</span> dateFormat = <span class="string">&quot;yyyy-dd-MM&quot;</span></span><br><span class="line"><span class="keyword">val</span> cleanDateDF = spark.range(<span class="number">1</span>).select(</span><br><span class="line">    to_date(lit(<span class="string">&quot;2017-12-11&quot;</span>), dateFormat).alias(<span class="string">&quot;date&quot;</span>),</span><br><span class="line">    to_date(lit(<span class="string">&quot;2017-20-12&quot;</span>), dateFormat).alias(<span class="string">&quot;date2&quot;</span>))</span><br><span class="line">cleanDateDF.createOrReplaceTempView(<span class="string">&quot;dateTable2&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// cleanDateDF.show()</span></span><br><span class="line"><span class="comment">// +----------+----------+</span></span><br><span class="line"><span class="comment">// |      date|     date2|</span></span><br><span class="line"><span class="comment">// +----------+----------+</span></span><br><span class="line"><span class="comment">// |2017-11-12|2017-12-20|</span></span><br><span class="line"><span class="comment">// +----------+----------+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.to_timestamp</span><br><span class="line">cleanDateDF.select(to_timestamp(col(<span class="string">&quot;date&quot;</span>), dateFormat)).show()</span><br><span class="line"><span class="comment">// +----------------------------------+</span></span><br><span class="line"><span class="comment">// |to_timestamp(`date`, &#x27;yyyy-dd-MM&#x27;)|</span></span><br><span class="line"><span class="comment">// +----------------------------------+</span></span><br><span class="line"><span class="comment">// |               2017-11-12 00:00:00|</span></span><br><span class="line"><span class="comment">// +----------------------------------+</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL (ê°™ì€ í‘œí˜„, to_date(), to_timestamp())</span></span><br><span class="line"><span class="keyword">SELECT</span> to_date(<span class="type">date</span>, <span class="string">&#x27;yyyy-dd-MM&#x27;</span>), to_date(date2, <span class="string">&#x27;yyyy-dd-MM&#x27;</span>), to_date(<span class="type">date</span>)</span><br><span class="line"><span class="keyword">FROM</span> dateTable2</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> to_timestamp(<span class="type">date</span>, <span class="string">&#x27;yyyy-dd-MM&#x27;</span>), to_timestamp(date2, <span class="string">&#x27;yyyy-dd-MM&#x27;</span>)</span><br><span class="line"><span class="keyword">FROM</span> dateTable2</span><br></pre></td></tr></table></figure>
</details>
</li>
<li><p>ë‚ ì§œ &lt;-&gt; íƒ€ì„ìŠ¤íƒ¬í”„ ë³€í™˜</p>
<ul>
<li>SQL (easy)<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">cast</span>(to_date(&quot;2017-01-01&quot;, &quot;yyyy-dd-MM&quot;) <span class="keyword">as</span> <span class="type">timestamp</span>)</span><br></pre></td></tr></table></figure></li>
<li>ì˜¬ë°”ë¥¸ í¬ë§·ê³¼ íƒ€ì…ì˜ ë‚ ì§œì™€ íƒ€ì„ìŠ¤íƒ¬í”„ ì‚¬ìš© ì‹œì—ëŠ” ë§¤ìš° ì‰½ê²Œ ë¹„êµí•  ìˆ˜ ìˆë‹¤<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ë‚ ì§œ, íƒ€ì„ìŠ¤íƒ¬í”„ íƒ€ì… ì‚¬ìš© or &quot;yyyy-MM-dd&quot; í¬ë§· ë¬¸ìì—´ ì‚¬ìš©</span></span><br><span class="line">cleanDateDF.filter(col(<span class="string">&quot;date2&quot;</span>) &gt; lit(<span class="string">&quot;2017-12-12&quot;</span>)).show()</span><br><span class="line"></span><br><span class="line"><span class="comment">// ìŠ¤íŒŒí¬ê°€ ë¦¬í„°ëŸ´ë¡œ ì¸ì‹í•˜ëŠ” ë¬¸ìì—´ ì§€ì •í•´ì„œ ë¹„êµë„ ê°€ëŠ¥</span></span><br><span class="line">cleanDateDF.filter(col(<span class="string">&quot;date2&quot;</span>) &gt; <span class="string">&quot;&#x27;2017-12-12&#x27;&quot;</span>).show()</span><br><span class="line"></span><br><span class="line"><span class="comment">// +----------+----------+</span></span><br><span class="line"><span class="comment">// |      date|     date2|</span></span><br><span class="line"><span class="comment">// +----------+----------+</span></span><br><span class="line"><span class="comment">// |2017-11-12|2017-12-20|</span></span><br><span class="line"><span class="comment">// +----------+----------+</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="6-7-null-ê°’-ë‹¤ë£¨ê¸°"><a href="#6-7-null-ê°’-ë‹¤ë£¨ê¸°" class="headerlink" title="6.7 null ê°’ ë‹¤ë£¨ê¸°"></a>6.7 null ê°’ ë‹¤ë£¨ê¸°</h3><ul>
<li><p>DataFrame ì—ì„œ ë¹ˆ ê°’ì€ <strong>NULL</strong> ë¡œ í‘œí˜„í•˜ëŠ”ê²Œ ì¢‹ë‹¤</p>
<ul>
<li>ìŠ¤íŒŒí¬ì—ì„œëŠ” null ì„ ì‚¬ìš©í•´ì•¼ ìµœì í™” ìˆ˜í–‰ (ë¹ˆ ë¬¸ìì—´ X, ëŒ€ì²´ê°’ X)</li>
</ul>
</li>
<li><p>DataFrame ì—ì„œ null ì„ ë‹¤ë£¨ëŠ” ê¸°ë³¸ ë°©ì‹ =&gt; <code>.na</code></p>
<ul>
<li>DataFrameì˜ í•˜ìœ„ íŒ¨í‚¤ì§€</li>
<li>ì—°ì‚° ìˆ˜í–‰ ì¤‘ null ê°’ ì œì–´ ë°©ì‹ì„ ëª…ì‹œì ìœ¼ë¡œ ì§€ì •í•˜ëŠ” í•¨ìˆ˜ëŠ” =&gt; 5.4.15 ë¡œìš°ì •ë ¬í•˜ê¸° / 6.3 ë¶ˆë¦¬ì–¸ ë°ì´í„° íƒ€ì… ë‹¤ë£¨ê¸° ì°¸ì¡°</li>
</ul>
</li>
<li><p>null ê°’ì„ ë‹¤ë£¨ëŠ” ë‘ê°€ì§€ ë°©ì‹</p>
<ul>
<li>1. ëª…ì‹œì ìœ¼ë¡œ null ê°’ ì œê±°</li>
<li>2. ì „ì—­ or ì»¬ëŸ¼ ë‹¨ìœ„ë¡œ null ê°’ì„ íŠ¹ì • ê°’ìœ¼ë¡œ ì±„ìš°ê¸°<blockquote>
<p>null ê°’ì€ ëª…ì‹œì ìœ¼ë¡œ ì‚¬ìš© ê¶Œì¥.<br>ê·¸ëŸ¬ë‚˜ null ê°’ì„ í—ˆìš©í•˜ì§€ ì•ŠëŠ” ì»¬ëŸ¼ ì„ ì–¸í•´ë„ <strong>ê°•ì œì„± ì—†ìŒ</strong></p>
<ul>
<li>ì¦‰, notnull ì»¬ëŸ¼ì´ì—¬ë„ null ê°’ì´ ìˆì„ ìˆ˜ ìˆë‹¤</li>
<li>nullable ì†ì„±ì€ ìŠ¤íŒŒí¬ SQL ì˜µí‹°ë§ˆì´ì €ê°€ í•´ë‹¹ ì»¬ëŸ¼ì„ ì œì–´í•˜ëŠ” ë™ì‘ì„ ë‹¨ìˆœí•˜ê²Œ ë„ìš¸ ë¿</li>
</ul>
</blockquote>
</li>
</ul>
</li>
<li><p><code>coalesce()</code></p>
<ul>
<li><p>ì¸ìˆ˜ì˜ ì—¬ëŸ¬ ì»¬ëŸ¼ ì¤‘ null ì´ ì•„ë‹Œ ì²«ë²ˆì§¸ ê°’ ë°˜í™˜</p>
</li>
<li><p>ëª¨ë“  ì»¬ëŸ¼ì´ nullì´ ì•„ë‹Œ ê°’ì„ ê°€ì§€ë©´ ì²« ë²ˆì§¸ ì»¬ëŸ¼ ê°’ ë°˜í™˜</p>
<details><summary class="point-color-can-hover">[6.7-1] ì˜ˆì œ í¼ì¹˜ê¸° - coalesce()</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.coalesce</span><br><span class="line"></span><br><span class="line"><span class="comment">// Description ì»¬ëŸ¼ ê°’ null ì²´í¬</span></span><br><span class="line"><span class="comment">//  1. nullì´ë©´ CustomerId ê°’ ë°˜í™˜</span></span><br><span class="line"><span class="comment">//  2. nullì´ ì•„ë‹ˆë©´ Description ì»¬ëŸ¼ ê°’ ë°˜í™˜</span></span><br><span class="line">df.select(coalesce(col(<span class="string">&quot;Description&quot;</span>), col(<span class="string">&quot;CustomerId&quot;</span>))).show()</span><br></pre></td></tr></table></figure>
</details>
</li>
</ul>
</li>
<li><p>SQL í•¨ìˆ˜</p>
<ul>
<li><p><code>ifnull()</code> : ì²« ë²ˆì§¸ ê°’ì´ nullì´ë©´ ë‘ ë²ˆì§¸ ê°’ ë°˜í™˜, nullì´ ì•„ë‹ˆë©´ ì²« ë²ˆì§¸ ê°’ ë°˜í™˜</p>
</li>
<li><p><code>nullif()</code> : ë‘ ê°’ì´ ê°™ìœ¼ë©´ null ë°˜í™˜, ë‹¤ë¥´ë©´ ì²« ë²ˆì§¸ ê°’ ë°˜í™˜</p>
</li>
<li><p><code>nvl()</code> : ì²« ë²ˆì§¸ ê°’ì´ nullì´ë©´ ë‘ ë²ˆì§¸ ê°’ ë°˜í™˜, nullì´ ì•„ë‹ˆë©´ ì²« ë²ˆì§¸ ê°’ ë°˜í™˜</p>
</li>
<li><p><code>nvl2()</code> : ì²« ë²ˆì§¸ ê°’ì´ nullì´ ì•„ë‹ˆë©´ ë‘ ë²ˆì§¸ ê°’ ë°˜í™˜, nullì´ë©´ ì„¸ ë²ˆì§¸ ê°’ ë°˜í™˜</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ì´í•´í•˜ëŠ” ìš©ë„.. like this</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">ifnull</span><span class="params">(first: <span class="type">Any</span>, default: <span class="type">Any</span>)</span></span> = <span class="keyword">if</span> (first != <span class="literal">null</span>) first <span class="keyword">else</span> default</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">nullif</span><span class="params">(first: <span class="type">Any</span>, second: <span class="type">Any</span>)</span></span> = <span class="keyword">if</span> (first != second) first <span class="keyword">else</span> <span class="literal">null</span></span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">nvl</span><span class="params">(first: <span class="type">Any</span>, default: <span class="type">Any</span>)</span></span> = <span class="keyword">if</span> (first != <span class="literal">null</span>) first <span class="keyword">else</span> default</span><br><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">nvl2</span><span class="params">(first: <span class="type">Any</span>, notnull_return: <span class="type">Any</span>, null_return: <span class="type">Any</span>)</span></span> = <span class="keyword">if</span> (first != <span class="literal">null</span>) notnull_return <span class="keyword">else</span> null_return</span><br></pre></td></tr></table></figure>
<details><summary class="point-color-can-hover">[6.7-2] ì˜ˆì œ í¼ì¹˜ê¸° - SQL í•¨ìˆ˜</summary>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  ifnull(<span class="keyword">null</span>, <span class="string">&#x27;return_value&#x27;</span>),</span><br><span class="line">  <span class="built_in">nullif</span>(<span class="string">&#x27;value&#x27;</span>, <span class="string">&#x27;value&#x27;</span>),</span><br><span class="line">  nvl(<span class="keyword">null</span>, <span class="string">&#x27;return_value&#x27;</span>),</span><br><span class="line">  nvl2(<span class="string">&#x27;not_null&#x27;</span>, <span class="string">&#x27;return_value&#x27;</span>, &quot;else_value&quot;)</span><br><span class="line"><span class="keyword">FROM</span> dfTable LIMIT <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- +------------+----+------------+------------+</span></span><br><span class="line"><span class="comment">-- |           a|   b|           c|           d|</span></span><br><span class="line"><span class="comment">-- +------------+----+------------+------------+</span></span><br><span class="line"><span class="comment">-- |return_value|null|return_value|return_value|</span></span><br><span class="line"><span class="comment">-- +------------+----+------------+------------+</span></span><br></pre></td></tr></table></figure>
</details>


</li>
</ul>
</li>
</ul>
<ul>
<li><p><code>drop()</code></p>
<ul>
<li><p>null ê°’ì„ ê°€ì§„ ë¡œìš°ë¥¼ ëª¨ë“  ë¡œìš° ì œê±°</p>
</li>
<li><p>ì¸ìˆ˜</p>
<ul>
<li><code>any</code> (í•˜ë‚˜ë¼ë„ nullì´ë©´ ì œê±°) / <code>all</code> (ëª¨ë“  ì»¬ëŸ¼ì´ null ë˜ëŠ” NaNì´ë©´ ì œê±°)</li>
<li>ë°°ì—´ í˜•íƒœ ì»¬ëŸ¼ë„ ì¸ìˆ˜ë¡œ ì „ë‹¬ ê°€ëŠ¥</li>
</ul>
</li>
<li><p>SQL ì‚¬ìš© ì‹œ ì»¬ëŸ¼ë³„ë¡œ ìˆ˜í–‰í•´ì•¼í•¨</p>
<details><summary class="point-color-can-hover">[6.7-3] ì˜ˆì œ í¼ì¹˜ê¸° - drop()</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">df.na.drop()</span><br><span class="line">df.na.drop(<span class="string">&quot;any&quot;</span>) <span class="comment">// í•˜ë‚˜ë¼ë„ ì»¬ëŸ¼ì´ null (ë˜ëŠ” NaN) ì´ë©´ ë¡œìš° ì œê±°</span></span><br><span class="line">df.na.drop(<span class="string">&quot;all&quot;</span>) <span class="comment">// ëª¨ë“  ì»¬ëŸ¼ì´ null (ë˜ëŠ” NaN) ì´ë©´ ë¡œìš° ì œê±°</span></span><br><span class="line"></span><br><span class="line">df.na.drop(<span class="string">&quot;all&quot;</span>, <span class="type">Seq</span>(<span class="string">&quot;StockCode&quot;</span>, <span class="string">&quot;InvoiceNo&quot;</span>)) <span class="comment">// ì»¬ëŸ¼(ë°°ì—´í˜•íƒœ) ì „ë‹¬ ê°€ëŠ¥</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL ì‚¬ìš© ì‹œ ì»¬ëŸ¼ ë³„ ìˆ˜í–‰í•´ì•¼</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> dfTable <span class="keyword">WHERE</span> Description <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>
</details>
</li>
</ul>
</li>
<li><p><code>fill()</code></p>
<ul>
<li><p>í•˜ë‚˜ ì´ìƒì˜ ì»¬ëŸ¼ì„ íŠ¹ì • ê°’ìœ¼ë¡œ ì±„ì›€</p>
</li>
<li><p>ì¸ìˆ˜</p>
<ul>
<li>ì±„ì›Œë„£ì„ ê°’, ì»¬ëŸ½ ì§‘í•©ìœ¼ë¡œ êµ¬ì„±ëœ ë§µ</li>
<li>ì»¬ëŸ¼ëª… ë°°ì—´ë¡œ ì¸ìˆ˜ ì‚¬ìš© ë° ë‹¤ìˆ˜ ì»¬ëŸ¼ì—ë„ ì ìš© ê°€ëŠ¥ (ex. <code>df.na.fill(5:Integer)</code>, <code>df.na.fill(5:Double)</code>)</li>
</ul>
</li>
<li><p>ìŠ¤ì¹¼ë¼ Map íƒ€ì… ì‚¬ìš©ë„ ì¸ìˆ˜ë¡œ ê°€ëŠ¥ (key:value = ì»¬ëŸ¼ëª…:nullê°’ì„ ì±„ìš¸ ê°’)</p>
<details><summary class="point-color-can-hover">[6.7-4] ì˜ˆì œ í¼ì¹˜ê¸° - fill()</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">df.na.fill(<span class="string">&quot;All Null values become this string&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ë‹¤ìˆ˜ ì»¬ëŸ¼ì— ì ìš©</span></span><br><span class="line">df.na.fill(<span class="number">5</span>, <span class="type">Seq</span>(<span class="string">&quot;StockCode&quot;</span>, <span class="string">&quot;InvoiceNo&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Map íƒ€ì…ìœ¼ë¡œ ë‹¤ìˆ˜ ì»¬ëŸ¼ì— ì ìš©</span></span><br><span class="line"><span class="keyword">val</span> fillColValues = <span class="type">Map</span>(<span class="string">&quot;StockCode&quot;</span> -&gt; <span class="number">5</span>, <span class="string">&quot;Description&quot;</span> -&gt; <span class="string">&quot;No Value&quot;</span>)</span><br><span class="line">df.na.fill(fillColValues)</span><br></pre></td></tr></table></figure>
</details>
</li>
</ul>
</li>
<li><p><code>relace()</code></p>
<ul>
<li><p>ì¡°ê±´ì— ë”°ë¼ ë‹¤ë¥¸ ê°’ìœ¼ë¡œ ëŒ€ì²´</p>
</li>
<li><p>ë‹¨, ë³€ê²½í•˜ê³ ìí•˜ëŠ” ê°’ == ì›ë˜ ê°’ ë°ì´í„° íƒ€ì… ê°™ì•„ì•¼</p>
<details><summary class="point-color-can-hover">[6.7-5] ì˜ˆì œ í¼ì¹˜ê¸° - replace()</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df.na.replace(<span class="string">&quot;Description&quot;</span>, <span class="type">Map</span>(<span class="string">&quot;&quot;</span> -&gt; <span class="string">&quot;UNKNOWN&quot;</span>))</span><br></pre></td></tr></table></figure>
</details>

</li>
</ul>
</li>
</ul>
<h3 id="6-8-ì •ë ¬í•˜ê¸°"><a href="#6-8-ì •ë ¬í•˜ê¸°" class="headerlink" title="6.8 ì •ë ¬í•˜ê¸°"></a>6.8 ì •ë ¬í•˜ê¸°</h3><ul>
<li><code>asc_nulls_first()</code>, <code>desc_nulls_first()</code>, <code>asc_nulls_last()</code>, <code>desc_nulls_last()</code><ul>
<li>DataFrame ì •ë ¬ ì‹œ null ê°’ í‘œì‹œ ê¸°ì¤€ ì§€ì • ê°€ëŠ¥</li>
</ul>
</li>
<li>(=&gt; <a href="https://minsw.github.io/2021/01/26/Spark-The-Definitive-Guide-5%EC%9E%A5/#15-%EB%A1%9C%EC%9A%B0-%EC%A0%95%EB%A0%AC%ED%95%98%EA%B8%B0">5.4.15 - ë¡œìš°ì •ë ¬í•˜ê¸°</a> ë‹¤ì‹œ ì°¸ê³ ~)</li>
</ul>
<h3 id="6-9-ë³µí•©-ë°ì´í„°-íƒ€ì…-ë‹¤ë£¨ê¸°"><a href="#6-9-ë³µí•©-ë°ì´í„°-íƒ€ì…-ë‹¤ë£¨ê¸°" class="headerlink" title="6.9 ë³µí•© ë°ì´í„° íƒ€ì… ë‹¤ë£¨ê¸°"></a>6.9 ë³µí•© ë°ì´í„° íƒ€ì… ë‹¤ë£¨ê¸°</h3><ul>
<li><p>ë³µí•© ë°ì´í„° íƒ€ì… : êµ¬ì¡°ì²´ (struct), ë°°ì—´ (array), ë§µ(map)</p>
</li>
<li><p>êµ¬ì¡°ì²´ = DataFrame ë‚´ë¶€ì˜ DataFrame</p>
<ul>
<li>ì¿¼ë¦¬ë¬¸ì—ì„œ ë‹¤ìˆ˜ì˜ ì»¬ëŸ¼ì„ ê´„í˜¸ë¡œ ë¬¶ì–´ì„œ =&gt; êµ¬ì¡°ì²´ ë§Œë“¦</li>
<li>ë³µí•© ë°ì´í„° íƒ€ì…ì„ ê°€ì§„ DataFrame ì‚¬ìš©<ul>
<li>=&gt; ë‹¤ë¥¸ DataFrame ì¡°íšŒí•˜ëŠ”ê²ƒê³¼ ë™ì¼í•˜ê²Œ ì‚¬ìš© ê°€ëŠ¥</li>
<li>ì°¨ì´ì ì€ ë¬¸ë²•ì— ì  (.) ì‚¬ìš© or <code>getField()</code> ì‚¬ìš©</li>
<li><code>*</code> ë¬¸ìë¡œ ëª¨ë“  ê°’ ì¡°íšŒ ê°€ëŠ¥ (ëª¨ë“  ì»¬ëŸ¼ì„ ìµœìƒìœ„ ìˆ˜ì¤€ìœ¼ë¡œ ëŒì–´ì˜¬ë¦¬ê¸° ê°€ëŠ¥?)</li>
</ul>
</li>
</ul>
<details><summary class="point-color-can-hover">[6.8,1] ì˜ˆì œ í¼ì¹˜ê¸° - êµ¬ì¡°ì²´</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">df.selectExpr(<span class="string">&quot;(Description, InvoiceNo) as complex&quot;</span>, <span class="string">&quot;*&quot;</span>)</span><br><span class="line">df.selectExpr(<span class="string">&quot;struct(Description, InvoiceNo) as complex&quot;</span>, <span class="string">&quot;*&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.struct</span><br><span class="line"><span class="keyword">val</span> complexDF = df.select(struct(<span class="string">&quot;Description&quot;</span>, <span class="string">&quot;InvoiceNo&quot;</span>).alias(<span class="string">&quot;complex&quot;</span>))</span><br><span class="line">complexDF.createOrReplaceTempView(<span class="string">&quot;complexDF&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ì¡°íšŒ ì‹œ ì (.) ë˜ëŠ” getField() ì‚¬ìš©</span></span><br><span class="line">complexDF.select(<span class="string">&quot;complex.Description&quot;</span>)</span><br><span class="line">complexDF.select(col(<span class="string">&quot;complex&quot;</span>).getField(<span class="string">&quot;Description&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// * ë¡œ ëª¨ë“  ê°’ ì¡°íšŒ ê°€ëŠ¥</span></span><br><span class="line">complexDF.select(<span class="string">&quot;complex.*&quot;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> complex.<span class="operator">*</span> <span class="keyword">FROM</span> complexDF</span><br></pre></td></tr></table></figure>
</details>
</li>
<li><p>ë°°ì—´</p>
<ul>
<li>example) í•´ë‹¹í•˜ëŠ” ì»¬ëŸ¼ì˜ ëª¨ë“  ë‹¨ì–´ë¥¼ í•˜ë‚˜ì˜ ë¡œìš°ë¡œ ë³€í™˜</li>
<li><code>split(target, delimiter)</code> : êµ¬ë¶„ì ê¸°ì¤€ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ë°°ì—´ë¡œ ë³€í™˜<ul>
<li>ë³µí•© ë°ì´í„° íƒ€ì…ì„ ë˜ ë‹¤ë¥¸ ì»¬ëŸ¼ì²˜ëŸ¼ ë‹¤ë£° ìˆ˜ ìˆëŠ” ê¸°ëŠ¥</li>
</ul>
</li>
<li>ë°°ì—´ì˜ ê¸¸ì´ : ë°°ì—´ size ì¡°íšŒí•´ì„œ ê¸¸ì´ ì•Œ ìˆ˜ ìˆìŒ</li>
<li><code>array_contains()</code> : ë°°ì—´ì— íŠ¹ì • ê°’ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸ ê°€ëŠ¥<ul>
<li>í•˜ì§€ë§Œ ì‹œë‚˜ë¦¬ì˜¤ ì™„ì„±ì€ ë¶ˆê°€ëŠ¥</li>
</ul>
</li>
<li><code>explode(ë°°ì—´íƒ€ì… ì¹¼ëŸ¼)</code> : ì¸ìˆ˜ì˜ ì»¬ëŸ¼ ë°°ì—´ ê°‘ì… í¬í•¨ëœ ëª¨ë“  ê°’ì„ ë¡œìš°ë¡œ ë³€í™˜ (ë‚˜ë¨¸ì§€ ì»¬ëŸ¼ ê°’ì€ ì¤‘ë³µë˜ì–´ í‘œì‹œ)</li>
</ul>
<details><summary class="point-color-can-hover">[6.8.2] ì˜ˆì œ í¼ì¹˜ê¸° - ë°°ì—´</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// split() : ë°°ì—´ë¡œ ë³€í™˜</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.split</span><br><span class="line">df.select(split(col(<span class="string">&quot;Description&quot;</span>), <span class="string">&quot; &quot;</span>)).show(<span class="number">2</span>)</span><br><span class="line"><span class="comment">// +---------------------+</span></span><br><span class="line"><span class="comment">// |split(Description,  )|</span></span><br><span class="line"><span class="comment">// +---------------------+</span></span><br><span class="line"><span class="comment">// | [WHITE, HANGING, ...|</span></span><br><span class="line"><span class="comment">// | [WHITE, METAL, LA...|</span></span><br><span class="line"><span class="comment">// +---------------------+</span></span><br><span class="line"></span><br><span class="line">(df.select(split(col(<span class="string">&quot;Description&quot;</span>), <span class="string">&quot; &quot;</span>).alias(<span class="string">&quot;array_col&quot;</span>))</span><br><span class="line">  .selectExpr(<span class="string">&quot;array_col[0]&quot;</span>).show(<span class="number">2</span>))</span><br><span class="line"><span class="comment">// +------------+</span></span><br><span class="line"><span class="comment">// |array_col[0]|</span></span><br><span class="line"><span class="comment">// +------------+</span></span><br><span class="line"><span class="comment">// |       WHITE|</span></span><br><span class="line"><span class="comment">// |       WHITE|</span></span><br><span class="line"><span class="comment">// +------------+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// size() : ë°°ì—´ì˜ ê¸¸ì´</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.size</span><br><span class="line">df.select(size(split(col(<span class="string">&quot;Description&quot;</span>), <span class="string">&quot; &quot;</span>))).show(<span class="number">2</span>) <span class="comment">// shows 5 and 3</span></span><br><span class="line"><span class="comment">// +---------------------------+</span></span><br><span class="line"><span class="comment">// |size(split(Description,  ))|</span></span><br><span class="line"><span class="comment">// +---------------------------+</span></span><br><span class="line"><span class="comment">// |                          5|</span></span><br><span class="line"><span class="comment">// |                          3|</span></span><br><span class="line"><span class="comment">// +---------------------------+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// array_contains() : ë°°ì—´ì— íŠ¹ì •ê°’ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.array_contains</span><br><span class="line">df.select(array_contains(split(col(<span class="string">&quot;Description&quot;</span>), <span class="string">&quot; &quot;</span>), <span class="string">&quot;WHITE&quot;</span>)).show(<span class="number">2</span>)</span><br><span class="line"><span class="comment">// +--------------------------------------------+</span></span><br><span class="line"><span class="comment">// |array_contains(split(Description,  ), WHITE)|</span></span><br><span class="line"><span class="comment">// +--------------------------------------------+</span></span><br><span class="line"><span class="comment">// |                                        true|</span></span><br><span class="line"><span class="comment">// |                                        true|</span></span><br><span class="line"><span class="comment">// +--------------------------------------------+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// explode() : ì…ë ¥ëœ ì»¬ëŸ¼ì˜ ë°°ì—´ê°’(split(Description) ê²°ê³¼ë¬¼) ì— í¬í•¨ëœ ëª¨ë“  ê°’ì„ ë¡œìš°ë¡œ ë³€í™˜ (ë‚˜ë¨¸ì§€ê°’(InvoiceNo)ì€ ì¤‘ë³µ)</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.&#123;split, explode&#125;</span><br><span class="line">(df.withColumn(<span class="string">&quot;splitted&quot;</span>, split(col(<span class="string">&quot;Description&quot;</span>), <span class="string">&quot; &quot;</span>))</span><br><span class="line">  .withColumn(<span class="string">&quot;exploded&quot;</span>, explode(col(<span class="string">&quot;splitted&quot;</span>)))</span><br><span class="line">  .select(<span class="string">&quot;Description&quot;</span>, <span class="string">&quot;InvoiceNo&quot;</span>, <span class="string">&quot;exploded&quot;</span>).show(<span class="number">2</span>))</span><br><span class="line"><span class="comment">// +--------------------+---------+--------+</span></span><br><span class="line"><span class="comment">// |         Description|InvoiceNo|exploded|</span></span><br><span class="line"><span class="comment">// +--------------------+---------+--------+</span></span><br><span class="line"><span class="comment">// |WHITE HANGING HEA...|   536365|   WHITE|</span></span><br><span class="line"><span class="comment">// |WHITE HANGING HEA...|   536365| HANGING|</span></span><br><span class="line"><span class="comment">// +--------------------+---------+--------+</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- split()</span></span><br><span class="line"><span class="keyword">SELECT</span> split(Description, <span class="string">&#x27; &#x27;</span>) <span class="keyword">FROM</span> dfTable</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> split(Description, <span class="string">&#x27; &#x27;</span>)[<span class="number">0</span>] <span class="keyword">FROM</span> dfTable</span><br><span class="line"></span><br><span class="line"><span class="comment">-- array_contains()</span></span><br><span class="line"><span class="keyword">SELECT</span> array_contains(split(Description, <span class="string">&#x27; &#x27;</span>), <span class="string">&#x27;WHITE&#x27;</span>) <span class="keyword">FROM</span> dfTable</span><br><span class="line"></span><br><span class="line"><span class="comment">-- explode()</span></span><br><span class="line"><span class="keyword">SELECT</span> Description, InvoiceNo, exploded</span><br><span class="line"><span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="operator">*</span>, split(Description, &quot; &quot;) <span class="keyword">as</span> splitted <span class="keyword">FROM</span> dfTable)</span><br><span class="line"><span class="keyword">LATERAL</span> <span class="keyword">VIEW</span> explode(splitted) <span class="keyword">as</span> exploded</span><br></pre></td></tr></table></figure>
</details>
</li>
<li><p>ë§µ</p>
<ul>
<li><code>map()</code> + í‚¤-ê°’ ìŒ</li>
<li>ì í•©í•œ í‚¤ë¡œ ë°ì´í„° ì¡°íšŒ ê°€ëŠ¥, ì—†ì„ ì‹œ null ë°˜í™˜</li>
<li>map íƒ€ì… ë¶„í•´ -&gt; ì»¬ëŸ¼ ë³€í™˜ ê°€ëŠ¥</li>
</ul>
<details><summary class="point-color-can-hover">[6.8.3] ì˜ˆì œ í¼ì¹˜ê¸° - ë§µ</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.map</span><br><span class="line">df.select(map(col(<span class="string">&quot;Description&quot;</span>), col(<span class="string">&quot;InvoiceNo&quot;</span>)).alias(<span class="string">&quot;complex_map&quot;</span>)).show(<span class="number">2</span>)</span><br><span class="line"><span class="comment">// +--------------------+</span></span><br><span class="line"><span class="comment">// |         complex_map|</span></span><br><span class="line"><span class="comment">// +--------------------+</span></span><br><span class="line"><span class="comment">// |[WHITE HANGING HE...|</span></span><br><span class="line"><span class="comment">// |[WHITE METAL LANT...|</span></span><br><span class="line"><span class="comment">// +--------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// í‚¤ë¡œ ë°ì´í„° ì¡°íšŒ (ì—†ì„ ì‹œ null ë°˜í™˜)</span></span><br><span class="line">(df.select(map(col(<span class="string">&quot;Description&quot;</span>), col(<span class="string">&quot;InvoiceNo&quot;</span>)).alias(<span class="string">&quot;complex_map&quot;</span>))</span><br><span class="line">  .selectExpr(<span class="string">&quot;complex_map[&#x27;WHITE METAL LANTERN&#x27;]&quot;</span>).show(<span class="number">2</span>))</span><br><span class="line"><span class="comment">// +--------------------------------+</span></span><br><span class="line"><span class="comment">// |complex_map[WHITE METAL LANTERN]|</span></span><br><span class="line"><span class="comment">// +--------------------------------+</span></span><br><span class="line"><span class="comment">// |                            null|</span></span><br><span class="line"><span class="comment">// |                          536365|</span></span><br><span class="line"><span class="comment">// +--------------------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// map íƒ€ì… ë¶„í•´ -&gt; ì»¬ëŸ¼ìœ¼ë¡œ ë³€í™˜ ê°€ëŠ¥</span></span><br><span class="line">(df.select(map(col(<span class="string">&quot;Description&quot;</span>), col(<span class="string">&quot;InvoiceNo&quot;</span>)).alias(<span class="string">&quot;complex_map&quot;</span>))</span><br><span class="line">  .selectExpr(<span class="string">&quot;explode(complex_map)&quot;</span>).show(<span class="number">2</span>))</span><br><span class="line"><span class="comment">// +--------------------+------+</span></span><br><span class="line"><span class="comment">// |                 key| value|</span></span><br><span class="line"><span class="comment">// +--------------------+------+</span></span><br><span class="line"><span class="comment">// |WHITE HANGING HEA...|536365|</span></span><br><span class="line"><span class="comment">// | WHITE METAL LANTERN|536365|</span></span><br><span class="line"><span class="comment">// +--------------------+------+</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL</span></span><br><span class="line"><span class="keyword">SELECT</span> map(Description, InvoiceNo) <span class="keyword">as</span> complex_map <span class="keyword">FROM</span> dfTable</span><br><span class="line"><span class="keyword">WHERE</span> Description <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br></pre></td></tr></table></figure>
</details>

</li>
</ul>
<h3 id="6-10-JSON-ë‹¤ë£¨ê¸°"><a href="#6-10-JSON-ë‹¤ë£¨ê¸°" class="headerlink" title="6.10 JSON ë‹¤ë£¨ê¸°"></a>6.10 JSON ë‹¤ë£¨ê¸°</h3><ul>
<li>ìŠ¤íŒŒí¬ì—ì„œ JSON ë°ì´í„° ë‹¤ë£¨ê¸° ìœ„í•œ ê³ ìœ  ê¸°ëŠ¥ ì œê³µ<ul>
<li>ë¬¸ìì—´ í˜•íƒœ JSON ì¡°ì‘, JSON íŒŒì‹±, JSON ê°ì²´ë¡œ ë³€í™˜ ë“±</li>
</ul>
</li>
<li><code>get_json_object()</code><ul>
<li>JSON ê°ì²´ (ë”•ì…”ë„ˆë¦¬, ë°°ì—´) ì¸ë¼ì¸ ì¿¼ë¦¬ë¡œ ì¡°íšŒ ê°€ëŠ¥</li>
<li>ì¤‘ì²© ì—†ëŠ” ë‹¨ì¼ JSONì¼ ì‹œ, <code>json_tuble</code> ì‚¬ìš© ê°€ëŠ¥</li>
</ul>
</li>
<li><code>to_json()</code> : StructType -&gt; JSON ë¬¸ìì—´. ë°ì´í„° ì†ŒìŠ¤ì™€ ë™ì¼í•œ í˜•íƒœì˜ ë”•ì…”ë„ˆë¦¬(ë§µ) ì¸ìë¡œ ì‚¬ìš© ê°€ëŠ¥</li>
<li><code>from_json()</code> : JSON ë¬¸ìì—´ -&gt; ê°ì²´. ë‹¨ ìŠ¤í‚¤ë§ˆ ì§€ì • í•„ìˆ˜ (option. ë§µ ë°ì´í„° íƒ€ì… ì˜µì…˜)</li>
</ul>
<details><summary class="point-color-can-hover">[6.10] ì˜ˆì œ í¼ì¹˜ê¸°</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JSON ì»¬ëŸ¼ ìƒì„±</span></span><br><span class="line"><span class="keyword">val</span> jsonDF = spark.range(<span class="number">1</span>).selectExpr(<span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">  &#x27;&#123;&quot;</span>myJSONK<span class="string">ey&quot; : &#123;&quot;</span>myJSONV<span class="string">alue&quot; : [1, 2, 3]&#125;&#125;&#x27; as jsonString&quot;</span><span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// get_json_object() ë¡œ JSON ê°ì²´ ì¡°íšŒ</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.&#123;get_json_object, json_tuple&#125;</span><br><span class="line">jsonDF.select(</span><br><span class="line">    get_json_object(col(<span class="string">&quot;jsonString&quot;</span>), <span class="string">&quot;$.myJSONKey.myJSONValue[1]&quot;</span>) as <span class="string">&quot;column&quot;</span>,</span><br><span class="line">    json_tuple(col(<span class="string">&quot;jsonString&quot;</span>), <span class="string">&quot;myJSONKey&quot;</span>)).show(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// =&gt; SQL ì‚¬ìš©í•œ ì²˜ë¦¬ (ë™ì¼ í‘œí˜„)</span></span><br><span class="line">jsonDF.selectExpr(</span><br><span class="line">  <span class="string">&quot;get_json_object(jsonString, &#x27;$.myJSONKey.myJSONValue[1]&#x27;) as column&quot;</span>, </span><br><span class="line">  <span class="string">&quot;json_tuple(jsonString, &#x27;myJSONKey&#x27;)&quot;</span>).show(<span class="number">2</span>)</span><br><span class="line"><span class="comment">// +------+--------------------+</span></span><br><span class="line"><span class="comment">// |column|                  c0|</span></span><br><span class="line"><span class="comment">// +------+--------------------+</span></span><br><span class="line"><span class="comment">// |     2|&#123;&quot;myJSONValue&quot;:[1...|</span></span><br><span class="line"><span class="comment">// +------+--------------------+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// to_json() : StructType -&gt; JSON ë¬¸ìì—´</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.to_json</span><br><span class="line">(df.selectExpr(<span class="string">&quot;(InvoiceNo, Description) as myStruct&quot;</span>)</span><br><span class="line">  .select(to_json(col(<span class="string">&quot;myStruct&quot;</span>))))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// from_json() : JSON ë¬¸ìì—´ -&gt; ê°ì²´</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.from_json</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.types._</span><br><span class="line"><span class="keyword">val</span> parseSchema = <span class="keyword">new</span> <span class="type">StructType</span>(<span class="type">Array</span>(</span><br><span class="line">  <span class="keyword">new</span> <span class="type">StructField</span>(<span class="string">&quot;InvoiceNo&quot;</span>,<span class="type">StringType</span>,<span class="literal">true</span>),</span><br><span class="line">  <span class="keyword">new</span> <span class="type">StructField</span>(<span class="string">&quot;Description&quot;</span>,<span class="type">StringType</span>,<span class="literal">true</span>)))</span><br><span class="line">(df.selectExpr(<span class="string">&quot;(InvoiceNo, Description) as myStruct&quot;</span>)</span><br><span class="line">  .select(to_json(col(<span class="string">&quot;myStruct&quot;</span>)).alias(<span class="string">&quot;newJSON&quot;</span>))</span><br><span class="line">  .select(from_json(col(<span class="string">&quot;newJSON&quot;</span>), parseSchema), col(<span class="string">&quot;newJSON&quot;</span>)).show(<span class="number">2</span>))</span><br><span class="line"><span class="comment">// +----------------------+--------------------+</span></span><br><span class="line"><span class="comment">// |jsontostructs(newJSON)|             newJSON|</span></span><br><span class="line"><span class="comment">// +----------------------+--------------------+</span></span><br><span class="line"><span class="comment">// |  [536365, WHITE HA...|&#123;&quot;InvoiceNo&quot;:&quot;536...|</span></span><br><span class="line"><span class="comment">// |  [536365, WHITE ME...|&#123;&quot;InvoiceNo&quot;:&quot;536...|</span></span><br><span class="line"><span class="comment">// +----------------------+--------------------+</span></span><br></pre></td></tr></table></figure>
</details>

<h3 id="6-11-ì‚¬ìš©ì-ì •ì˜-í•¨ìˆ˜"><a href="#6-11-ì‚¬ìš©ì-ì •ì˜-í•¨ìˆ˜" class="headerlink" title="6.11 ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜"></a>6.11 ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜</h3><ul>
<li><p><strong>ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜</strong> (user defined function, <strong>UDF</strong>)</p>
<ul>
<li>ìŠ¤íŒŒí¬ì˜ ê°€ì¥ ê°•ë ¥í•œ ê¸°ëŠ¥ ì¤‘ í•˜ë‚˜</li>
<li>íŒŒì´ì¬, ìŠ¤ì¹¼ë¼, ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“± ì‚¬ìš© =&gt; ì‚¬ìš©ìê°€ ì›í•˜ëŠ” í˜•íƒœë¡œ íŠ¸ëœìŠ¤í¬ë©”ì´ì…˜ ìƒì„±</li>
</ul>
</li>
<li><p>íŠ¹ì§•</p>
<ul>
<li>í•˜ë‚˜ ì´ìƒì˜ ì»¬ëŸ¼ì„ ì…ë ¥/ë°˜í™˜ ê°€ëŠ¥</li>
<li>ìŠ¤íŒŒí¬ UDFëŠ” ë‹¤ì–‘í•œ ì–¸ì–´ë¡œ ê°œë°œ ê°€ëŠ¥</li>
<li>ë ˆì½”ë“œ ë³„ë¡œ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” í•¨ìˆ˜ì´ë¯€ë¡œ, ë…íŠ¹í•˜ê±°ë‚˜ ë„ë©”ì¸ íŠ¹í™” (DSL) ì–¸ì–´ ì‚¬ìš© X</li>
<li>=&gt; ê¸°ë³¸ì ìœ¼ë¡œ íŠ¹ì • SparkSessionì´ë‚˜ Contextì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ <u>ì„ì‹œ í•¨ìˆ˜ í˜•íƒœë¡œ ë“±ë¡</u></li>
</ul>
</li>
<li><p>ë‹¤ì–‘í•œ ì–¸ì–´ë¡œ UDF ê°œë°œ ê°€ëŠ¥</p>
<ul>
<li>ê·¸ëŸ¬ë‚˜ ì–¸ì–´ë³„ë¡œ ì„±ëŠ¥ì— ì˜í–¥ ì¡´ì¬<ul>
<li>ì˜ˆì œ ì°¸ê³ </li>
<li>í•¨ìˆ˜ë¥¼ ë§Œë“¤ê³  ëª¨ë“  ì›Œì»¤ ë…¸ë“œì—ì„œ í•´ë‹¹ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ìŠ¤íŒŒí¬ì— ë“±ë¡<ul>
<li>ìŠ¤íŒŒí¬ëŠ” ë“œë¼ì´ë²„ì—ì„œ í•¨ìˆ˜ ì§ë ¬í™” -&gt; ë„¤íŠ¸ì›Œí¬ í†µí•´ì„œ ëª¨ë“  ìµìŠ¤íí„° í”„ë¡œì„¸ìŠ¤ë¡œ ì „ë‹¬</li>
<li>(ì–¸ì–´ì— ê´€ê³„ì—†ì´ ë°œìƒí•˜ëŠ” ê³¼ì •)</li>
</ul>
</li>
<li>í•¨ìˆ˜ë¥¼ ê°œë°œí•œ ì–¸ì–´ì— ë”°ë¼ ê¸°ë³¸ì ìœ¼ë¡œ ë™ì‘í•˜ëŠ” ë°©ì‹ì´ ë‹¬ë¼ì§<ul>
<li>ì• ì´ˆì— ìŠ¤ì¹¼ë¼, ìë°” ì‚¬ìš© ì‹œ JVM í™˜ê²½ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥<ul>
<li>ìŠ¤íŒŒí¬ ë‚´ì¥í•¨ìˆ˜ ì¥ì  ì‚¬ìš© X =&gt; ì„±ëŠ¥ â†“</li>
<li>ë§ì€ ê°ì²´ ìƒì„±ì‹œì—ë„ ì„±ëŠ¥ ë¬¸ì œ</li>
</ul>
</li>
<li>íŒŒì´ì¬ ì‚¬ìš© ì‹œ ëª¨ë“  ë°ì´í„°ë¥¼ ì§ë ¬í™”í•˜ê³ , íŒŒì´ì¬ í”„ë¡œì„¸ìŠ¤ì— ìˆëŠ” ë°ì´í„°ì˜ ë¡œìš°ë§ˆë‹¤ í•¨ìˆ˜ ì‹¤í–‰ ë° JVMê³¼ ìŠ¤íŒŒí¬ì— ì²˜ë¦¬ ê²°ê³¼ë¥¼ ë°˜í™˜<ul>
<li>ì¼ë‹¨ ì§ë ¬í™” ê³¼ì •ì—ì„œ í° ë¶€í•˜ ë°œìƒ</li>
<li>ë°ì´í„°ê°€ íŒŒì´ì¬ìœ¼ë¡œ ì „ë‹¬ë˜ë©´ ìŠ¤íŒŒí¬ì—ì„œ ì›Œì»¤ ë©”ëª¨ë¦¬ ê´€ë¦¬ì˜ ì–´ë ¤ì›€</li>
</ul>
</li>
</ul>
</li>
<li>=&gt; ë”°ë¼ì„œ ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜ëŠ” <strong>ìë°”ë‚˜ ìŠ¤ì¹¼ë¼ë¡œ ì‘ì„±</strong> ì„ ê¶Œì¥</li>
</ul>
</li>
</ul>
</li>
<li><p>ê¸°ë³¸ì€ ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜(UTF)ëŠ” DataFrameì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥ (ë¬¸ìì—´ í‘œí˜„ì‹ X)</p>
<ul>
<li><strong>ìŠ¤íŒŒí¬ SQL í•¨ìˆ˜ ë“±ë¡í•˜ë©´?</strong></li>
<li>=&gt; ëª¨ë“  í”„ë¡œê·¸ë˜ë° ì–¸ì–´ì™€ SQL ì—ì„œ ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜ ì‚¬ìš© ê°€ëŠ¥<ul>
<li>íŒŒì´ì¬ì—ì„œë„ ìš°íšŒì ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥í•˜ì§€ë§Œ DataFrame í•¨ìˆ˜ ëŒ€ì‹  SQL í‘œí˜„ì‹ìœ¼ë¡œ ì‚¬ìš©í•´ì•¼í•¨</li>
<li>ìŠ¤íŒŒí¬ëŠ” ìì²´ ë°ì´í„° íƒ€ì…(íŒŒì´ì¬X)ì„ ì‚¬ìš©í•˜ë¯€ë¡œ <strong>ë³€í™˜ íƒ€ì… ì§€ì • ê¶Œ!ì¥!</strong></li>
<li>ë°˜í™˜ë  íƒ€ì…ê³¼ ë‹¤ë¥¸ ë°ì´í„° íƒ€ì… ì§€ì •ì‹œ =&gt; null ë°˜í™˜</li>
</ul>
</li>
</ul>
</li>
<li><p>ì‚¬ìš©ì ì •ì˜ í•¨ìˆ˜ì—ì„œ ì„ íƒì  ê°’ ë°˜í™˜</p>
<ul>
<li>íŒŒì´ì¬ = <code>None</code> / ìŠ¤ì¹¼ë¼ = <code>Option</code> ë°˜í™˜</li>
</ul>
<details><summary class="point-color-can-hover">[6.11] ì˜ˆì œ í¼ì¹˜ê¸°</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> udfExampleDF = spark.range(<span class="number">5</span>).toDF(<span class="string">&quot;num&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">power3</span></span>(number:<span class="type">Double</span>):<span class="type">Double</span> = number * number * number</span><br><span class="line">power3(<span class="number">2.0</span>) <span class="comment">// 8.0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// UDF ì‹¤í–‰ + í•¨ìˆ˜ ë“±ë¡ ë° ì‚¬ìš© (=&gt; DataFrameì—ì„œ ì‚¬ìš© ê°€ëŠ¥)</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.udf</span><br><span class="line"><span class="keyword">val</span> power3udf = udf(power3(_:<span class="type">Double</span>):<span class="type">Double</span>)</span><br><span class="line"></span><br><span class="line">udfExampleDF.select(power3udf(col(<span class="string">&quot;num&quot;</span>))).show()</span><br><span class="line"><span class="comment">// +--------+</span></span><br><span class="line"><span class="comment">// |UDF(num)|</span></span><br><span class="line"><span class="comment">// +--------+</span></span><br><span class="line"><span class="comment">// |     0.0|</span></span><br><span class="line"><span class="comment">// |     1.0|</span></span><br><span class="line"><span class="comment">// |     8.0|</span></span><br><span class="line"><span class="comment">// |    27.0|</span></span><br><span class="line"><span class="comment">// |    64.0|</span></span><br><span class="line"><span class="comment">// +--------+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// UDFë¥¼ ìŠ¤íŒŒí¬ SQLë¡œ ë“±ë¡í•˜ë©´ =&gt; ëª¨ë“  í”„ë¡œê·¸ë˜ë° ì–¸ì–´, SQL ì—ì„œ ì‚¬ìš© ê°€ëŠ¥ (+ë¬¸ìì—´ í‘œí˜„ì‹)</span></span><br><span class="line">spark.udf.register(<span class="string">&quot;power3&quot;</span>, power3(_:<span class="type">Double</span>):<span class="type">Double</span>)</span><br><span class="line">udfExampleDF.selectExpr(<span class="string">&quot;power3(num)&quot;</span>).show(<span class="number">2</span>)</span><br><span class="line">+-------------------------------+</span><br><span class="line">|<span class="type">UDF</span>:power3(cast(num as double))|</span><br><span class="line">+-------------------------------+</span><br><span class="line">|                            <span class="number">0.0</span>|</span><br><span class="line">|                            <span class="number">1.0</span>|</span><br><span class="line">+-------------------------------+</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">%spark.pyspark</span><br><span class="line">udfExampleDF.selectExpr(<span class="string">&quot;power3(num)&quot;</span>).show(<span class="number">2</span>)</span><br><span class="line"><span class="comment"># =&gt; Scalaë¡œ ë“±ë¡ëœ UDF ì‚¬ìš©</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ë°˜í™˜ ë°ì´í„°íƒ€ì…ì´ Integerì¸ë° DoubeType() ìœ¼ë¡œ ë³€í™˜ ì‹œ =&gt; null ë°˜í™˜</span></span><br><span class="line"><span class="keyword">from</span> pyspark.sql.types <span class="keyword">import</span> IntegerType, DoubleType</span><br><span class="line">spark.udf.register(<span class="string">&quot;power3py&quot;</span>, power3, DoubleType())</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL ì—ì„œë„ ë“±ë¡ëœ UDF ì‚¬ìš© ê°€ëŠ¥</span></span><br><span class="line"><span class="keyword">SELECT</span> power3(<span class="number">12</span>), power3py(<span class="number">12</span>) <span class="comment">-- ë°˜í™˜ ë°ì´í„° íƒ€ì… ë¬¸ì œë¡œ ë™ì‘í•˜ì§€ ì•ŠìŒ</span></span><br></pre></td></tr></table></figure>
</details>


</li>
</ul>
<h3 id="6-12-Hive-UDF"><a href="#6-12-Hive-UDF" class="headerlink" title="6.12 Hive UDF"></a>6.12 Hive UDF</h3><ul>
<li><p>í•˜ì´ë¸Œ ë¬¸ë²•ì„ ì‚¬ìš©í•´ì„œ ë§Œë“  í•¨ìˆ˜ =&gt; <strong>UDF</strong>, <strong>UDAF</strong> ì‚¬ìš© ê°€ëŠ¥</p>
<ul>
<li>UDF (User Defined Function)</li>
<li>UDAF (User Defined Aggregate Function)</li>
</ul>
</li>
<li><p>ë‹¨, í•˜ì´ë¸Œ ì§€ì› ê¸°ëŠ¥ í™œì„±í™” í•„ìš”</p>
<ul>
<li>=&gt; <code>SparkSession.builder().enableHiveSupport()</code> ëª…ì‹œ</li>
<li>í•˜ì´ë¸Œ ì§€ì› í™œì„±í™” ë˜ë©´ SQLë¡œ UDF ë“±ë¡ ê°€ëŠ¥</li>
<li>ì‚¬ì „ì— ì»´íŒŒì¼ëœ ìŠ¤ì¹¼ë¼, ìë°” íŒ¨í‚¤ì§€ë§Œ ì§€ì› (ë¼ì´ë¸ŒëŸ¬ë¦¬ ì˜ì¡´ì„± ëª…ì‹œ í•„ìš”)</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- TEMPORARY í‚¤ì›Œë“œ ì œê±° ì‹œ =&gt; í•˜ì´ë¸Œ ë©”íƒ€ìŠ¤í† ì–´ì— ì˜êµ¬(permanent) í•¨ìˆ˜ë¡œ ë“±ë¡</span></span><br><span class="line"><span class="keyword">CREATE</span> TEMPORARY <span class="keyword">FUNCTION</span> myFunc <span class="keyword">AS</span> <span class="string">&#x27;com.organization.hive.udf.FunctionName&#x27;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="6-13-ì •ë¦¬"><a href="#6-13-ì •ë¦¬" class="headerlink" title="6.13 ì •ë¦¬"></a>6.13 ì •ë¦¬</h3><ul>
<li>ìŠ¤íŒŒí¬ SQLì„ ì‚¬ìš©ëª©ì ì— ë§ê²Œ í™•ì¥í•˜ëŠ” ë°©ì‹<ul>
<li>ê°„ë‹¨í•œ í•¨ìˆ˜ë§Œìœ¼ë¡œë„ í™•ì¥ ê°€ëŠ¥ (DSL X)</li>
</ul>
</li>
<li>ìŠ¤íŒŒí¬ SQLì€ ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ êµ¬í˜„ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê°•ë ¥í•œ ê¸°ëŠ¥</li>
</ul>
<h3 id="ğŸ“’-ë‹¨ì–´ì¥"><a href="#ğŸ“’-ë‹¨ì–´ì¥" class="headerlink" title="ğŸ“’ ë‹¨ì–´ì¥"></a>ğŸ“’ ë‹¨ì–´ì¥</h3></div><p class="post-tags"><i class="fa fa-tags" aria-hidden="true"></i><a href="/tags/book/">#book</a><a href="/tags/study/">#study</a><a href="/tags/spark/">#spark</a><a href="/tags/apache/">#apache</a></p></article></div><footer><div class="paginator"><a class="prev" href="/2021/02/03/Spark-The-Definitive-Guide-7%EC%9E%A5/">PREV</a><a class="next" href="/2021/01/26/Spark-The-Definitive-Guide-5%EC%9E%A5/">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'minsw-github-io';
var disqus_identifier = '2021/02/02/Spark-The-Definitive-Guide-6ì¥/';
var disqus_title = '&amp;#039;Spark The Definitive Guide&amp;#039; 6ì¥ - ë°ì´í„° íƒ€ì… (ë¹„)ê³µì‹ ê°€ì´ë“œë¶';
var disqus_url = 'https://minsw.github.io/2021/02/02/Spark-The-Definitive-Guide-6ì¥/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async></script><div class="copyright"><p>Â© 2018 - 2021 <a href="https://minsw.github.io">Lukka Min</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-143001954-1",'auto');ga('send','pageview');</script><link rel="stylesheet" href="//cdn.datatables.net/1.10.7/css/jquery.dataTables.min.css" media="screen" type="text/css"><script src="//cdn.datatables.net/1.10.7/js/jquery.dataTables.min.js"></script><script>$(function(){$('.datatable').dataTable( {"order": [[ 0, "desc" ]],"iDisplayLength": -1,"lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]]} );});</script></body></html>