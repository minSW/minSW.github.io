<!DOCTYPE html><html lang="ko"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> &#039;Spark The Definitive Guide&#039; 7ì¥ - ì§‘ê³„í•´ë¼ ì• ì†¡ì´ Â· Look out</title><meta name="description" content="&amp;#039;Spark The Definitive Guide&amp;#039; 7ì¥ - ì§‘ê³„í•´ë¼ ì• ì†¡ì´ - Lukka Min"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/cover.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"><link rel="search" type="application/opensearchdescription+xml" href="https://minsw.github.io/atom.xml" title="Look out"><script src="//code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script><meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/feed.xml" title="Look out" type="application/atom+xml">
</head><body><div class="wrap"><header><a class="logo-link" href="/"><img src="/cover.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self">BLOG</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self">ARCHIVE</a></li><li class="nav-list-item"><a class="nav-list-link" href="/tags/" target="_self">TAG</a></li><li class="nav-list-item"><a class="nav-list-link" href="https://github.com/minSW" target="_blank">GITHUB</a></li></ul></header><main class="container"></main><div class="post"><article class="post-block"><h1 class="post-title">&#039;Spark The Definitive Guide&#039; 7ì¥ - ì§‘ê³„í•´ë¼ ì• ì†¡ì´</h1><div class="post-info">2021ë…„ 2ì›” 3ì¼<span class="categories"><i class="fa fa-bookmark" aria-hidden="true"></i></span><a class="post-category" href="/categories/spark/">#spark</a></div><div class="post-content"><br/>

<p style="color:lightgray">ë²Œì¨ë¶€í„° ìŠ¬ìŠ¬ í¬ìŠ¤íŠ¸ í¬ë©§ í—·ê°ˆë¦¬ê¸° ì‹œì‘í•˜ì£ ? ë§í–ˆì£ ?<br/>
ë‚˜ì¤‘ì— í•œë²ˆì— ë§ì¶°ì•¼ì§€ ìƒê°í•´ë†“ê³  ì ˆëŒ€ ìˆ˜ì •ì•ˆí•˜ì£ ? ã…..</p>

<br/>

<img width="300" alt="counting" src="https://user-images.githubusercontent.com/26691216/106792995-3b405280-669a-11eb-9f64-fc4d576200cd.gif">

<center><h2>_ _ _</h2></center>

<br/>

<hr>
<h1 id="CHAPTER-7-ì§‘ê³„-ì—°ì‚°"><a href="#CHAPTER-7-ì§‘ê³„-ì—°ì‚°" class="headerlink" title="CHAPTER 7 ì§‘ê³„ ì—°ì‚°"></a>CHAPTER 7 ì§‘ê³„ ì—°ì‚°</h1><p><em>ì§‘ê³„(aggregation)ì€ ë¬´ì–¸ê°ˆ í•¨ê»˜ ëª¨ìœ¼ëŠ” í–‰ìœ„ì´ë©° ë¹…ë°ì´í„° ë¶„ì„ì˜ ì´ˆì„ì´ë‹¤.</em></p>
<p>ìŠ¤íŒŒí¬ëŠ” ëª¨ë“  ë°ì´í„° íƒ€ì… ë‹¤ë£¨ëŠ” ê²ƒ + ë‹¤ìŒê³¼ ê°™ì€ <strong>ê·¸ë£¹í™” ë°ì´í„° íƒ€ì…</strong> ìƒì„± ê°€ëŠ¥í•˜ê³ ,<br>ì§€ì •ëœ ì§‘ê³„ í•¨ìˆ˜ì— ë”°ë¼ ê·¸ë£¹í™”ëœ ê²°ê³¼ëŠ” RelationalGroupedDataset ì„ ë°˜í™˜.</p>
<blockquote>
<ul>
<li>select êµ¬ë¬¸ì—ì„œ ì§‘ê³„ ìˆ˜í–‰, DataFrame ì „ì²´ ë°ì´í„° ìš”ì•½ (ê°€ì¥ ê°„ë‹¨í•œ ê·¸ë£¹í™”)</li>
<li>â€˜group byâ€™ : í•˜ë‚˜ ì´ìƒì˜ í‚¤ ì§€ì •. ë‹¤ë¥¸ ì§‘ê³„ í•¨ìˆ˜ ì‚¬ìš©í•´ì„œ ê°’ì„ ê°€ì§„ ì»¬ëŸ¼ ë³€í™˜ ê°€ëŠ¥</li>
<li>â€˜ìœˆë„ìš°(window)â€™ : í•˜ë‚˜ ì´ìƒì˜ í‚¤ ì§€ì •. ë‹¤ë¥¸ ì§‘ê³„ í•¨ìˆ˜ë¡œ ì»¬ëŸ¼ ë³€í™˜ ê°€ëŠ¥. + ë‹¨, í•¨ìˆ˜ ì…ë ¥ìœ¼ë¡œ ì‚¬ìš©í•  ë¡œìš°ëŠ” í˜„ì¬ ë¡œìš°ì™€ <strong>ì—°ê´€ì„±</strong> ìˆì–´ì•¼ í•¨</li>
<li>â€˜ê·¸ë£¹í™” ì…‹(grouping set)â€™ : ì„œë¡œ ë‹¤ë¥¸ ë ˆë²¨ ê°’ ì§‘ê³„ (SQL, DataFrameì˜ ë¡¤ì—…, íë¸Œ)</li>
<li>â€˜ë¡¤ì—…(rollup)â€™ : í•˜ë‚˜ ì´ìƒì˜ í‚¤ ì§€ì •. ë‹¤ë¥¸ ì§‘ê³„ í•¨ìˆ˜ë¡œ ì»¬ëŸ¼ ë³€í™˜ ê°€ëŠ¥. + <strong>ê³„ì¸µì ìœ¼ë¡œ ìš”ì•½ëœ ê°’</strong> ì¶”ì¶œ</li>
<li>â€˜íë¸Œ(cube)â€™ : í•˜ë‚˜ ì´ìƒì˜ í‚¤ ì§€ì •. ë‹¤ë¥¸ ì§‘ê³„ í•¨ìˆ˜ë¡œ ì»¬ëŸ¼ ë³€í™˜ ê°€ëŠ¥. + <strong>ëª¨ë“  ì»¬ëŸ¼ ì¡°í•©ì— ëŒ€í•œ ìš”ì•½ ê°’</strong> ê³„ì‚°</li>
</ul>
<p><i style="color:lightgray">(=&gt; ì‚¬ì‹¤ìƒ 7ì¥ ìš”ì•½)</i> </p>
</blockquote>
<p>ğŸ“Œ ì¤‘ìš”í•œ ê±´, <strong>ì–´ë–¤ ê²°ê³¼ë¥¼ ë§Œë“¤ì§€</strong> ì •í™•íˆ íŒŒì•…í•´ì•¼ í•œë‹¤ëŠ” ê²ƒ.<br>(ì •í™•í•œ ë‹µ ê³„ì‚° = ë†’ì€ ë¹„ìš© ìš”êµ¬ â†’ ë¹…ë°ì´í„°ì˜ ê²½ìš° ê·¼ì‚¬ì¹˜ê°€ íš¨ìœ¨ì ì¼ ìˆ˜ ìˆìŒ)</p>
<!-- 
count ì˜ˆì œ.. (ë°ì´í„°ì…‹ í¬ê¸° ì¶œë ¥ ë° ìºì‹±ìš©ë„)
ì´ì§ˆì ìœ¼ë¡œ ëŠê»´ì§ˆ ìˆ˜ ìˆìŒ. ì™œë‚˜ë©´...
- í•¨ìˆ˜ê°€ ì•„ë‹Œ ë©”ì„œë“œ í˜•íƒœ
- íŠ¸ëœìŠ¤í¬ë©”ì´ì…˜ê°™ì€ ì§€ì—° ì—°ì‚°ì´ì•„ë‹Œ ì¦‰ì‹œ ì—°ì‚°(ì•¡ì…˜)
-->

<h3 id="7-1-ì§‘ê³„-í•¨ìˆ˜"><a href="#7-1-ì§‘ê³„-í•¨ìˆ˜" class="headerlink" title="7.1 ì§‘ê³„ í•¨ìˆ˜"></a>7.1 ì§‘ê³„ í•¨ìˆ˜</h3><ul>
<li>ëª¨ë“  ì§‘ê³„ëŠ” íŠ¹ë³„í•œ ê²½ìš°ë¥¼ ì œì™¸í•˜ê³ ëŠ” <strong>í•¨ìˆ˜</strong> ì‚¬ìš©<ul>
<li>=&gt; <strong>ì§‘ê³„ í•¨ìˆ˜</strong> (<a target="_blank" rel="noopener" href="https://bit.ly/2tRMYus">org.apache.spark.sql.functions</a> íŒ¨í‚¤ì§€)</li>
<li>ì˜ˆì™¸) DataFrameì˜ .stat ì†ì„± ì´ìš© (6ì¥ ì°¸ê³ )</li>
<li>ìŠ¤ì¹¼ë¼, íŒŒì´ì¬ì—ì„œ ì„í¬íŠ¸ í•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜ì™€ SQLì—ì„œ ì‚¬ìš©ê°€ëŠ¥í•œ í•¨ìˆ˜ëŠ” ì•½ê°„ ë‹¤ë¦„ (ë§¤ ë¦´ë¦¬ì¦ˆë§ˆë‹¤ ì¡°ê¸ˆì”© ë³€í•¨)</li>
</ul>
</li>
</ul>
<h4 id="ì§‘ê³„-í•¨ìˆ˜"><a href="#ì§‘ê³„-í•¨ìˆ˜" class="headerlink" title="ì§‘ê³„ í•¨ìˆ˜"></a>ì§‘ê³„ í•¨ìˆ˜</h4><blockquote>
<p>ì§‘ê³„ í•¨ìˆ˜ : í‚¤ë‚˜ ê·¸ë£¹ì„ ì§€ì •í•˜ê³  + í•˜ë‚˜ ì´ìƒì˜ ì»¬ëŸ¼ì„ ë³€í™˜í•˜ëŠ” ë°©ë²•ì„ ì§€ì • (ì—¬ëŸ¬ ì…ë ¥ê°’ì´ ì£¼ì–´ì§€ë©´ ê·¸ë£¹ ë³„ë¡œ ê²°ê³¼ ìƒì„±)</p>
<ul>
<li>ìˆ˜ì¹˜í˜• ë°ì´í„° ìš”ì•½ (ex. ê·¸ë£¹ì˜ í‰ê· ê°’ êµ¬í•˜ê¸°)</li>
<li>í•©ì‚°, ê³±ì…ˆ, ì¹´ìš´íŒ… ë“±ì˜ ì‘ì—…</li>
<li>ë³µí•© ë°ì´í„° íƒ€ì…(ë°°ì—´, ë¦¬ìŠ¤íŠ¸, ë§µ)ì„ ì‚¬ìš©í•œ ì§‘ê³„ ìˆ˜í–‰ ê°€ëŠ¥ </li>
</ul>
</blockquote>
<ul>
<li><p><code>count(ì»¬ëŸ¼ëª…)</code> : ì „ì²´ ë¡œìš° ìˆ˜ ì¹´ìš´íŠ¸</p>
<ul>
<li><p>ì•¡ì…˜ì´ ì•„ë‹Œ <strong>íŠ¸ëœìŠ¤í¬ë©”ì´ì…˜</strong>ìœ¼ë¡œ ë™ì‘</p>
</li>
<li><p>ë‘ê°€ì§€ ë°©ì‹ìœ¼ë¡œ ì‚¬ìš© ê°€ëŠ¥</p>
<ul>
<li><code>count(íŠ¹ì • ì»¬ëŸ¼)</code> : null ê°’ í¬í•¨ X</li>
<li><code>count(*)</code> or <code>count(1)</code> : null ê°’ ê°€ì§„ ë¡œìš° í¬í•¨í•´ì„œ ì¹´ìš´íŠ¸</li>
</ul>
</li>
<li><details><summary class="only-hover">[7.1.1] ì˜ˆì œ í¼ì¹˜ê¸°</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.count</span><br><span class="line">df.select(count(<span class="string">&quot;StockCode&quot;</span>)).show() <span class="comment">// 541909</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> dfTable</span><br></pre></td></tr></table></figure>
</details>
</li>
</ul>
</li>
<li><p><code>countDistinct(ì»¬ëŸ¼ëª…)</code> : ê³ ìœ  (distinct) ë ˆì½”ë“œ ìˆ˜ ì¹´ìš´íŠ¸</p>
<ul>
<li><details><summary class="only-hover">[7.1.2] ì˜ˆì œ í¼ì¹˜ê¸°</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.countDistinct</span><br><span class="line">df.select(countDistinct(<span class="string">&quot;StockCode&quot;</span>)).show() <span class="comment">// 4070</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> <span class="operator">*</span>) <span class="keyword">FROM</span> DFTABLE</span><br></pre></td></tr></table></figure>
</details>
</li>
</ul>
</li>
<li><p><code>approx_count_distinct(ì»¬ëŸ¼ëª…, ìµœëŒ€ì¶”ì •ì˜¤ë¥˜ìœ¨)</code> : ê·¼ì‚¬ì¹˜ ê³ ìœ  ë ˆì½”ë“œ ìˆ˜ ì¹´ìš´íŠ¸</p>
<ul>
<li><p>ëŒ€ê·œëª¨ ë°ì´í„°ì…‹ ë‹¤ë£° ì‹œ ì •í™•í•œ ê°œìˆ˜ ë¬´ì˜ë¯¸í•¨ =&gt; ê·¼ì‚¬ì¹˜ë¡œ íš¨ìœ¨</p>
</li>
<li><p><code>ìµœëŒ€ ì¶”ì • ì˜¤ë¥˜ìœ¨ (maximum estimation error)</code> íŒŒë¼ë¯¸í„° ì„¤ì •</p>
</li>
<li><details><summary class="only-hover">[7.1.3] ì˜ˆì œ í¼ì¹˜ê¸°</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.approx_count_distinct</span><br><span class="line">df.select(approx_count_distinct(<span class="string">&quot;StockCode&quot;</span>, <span class="number">0.1</span>)).show() <span class="comment">// 3364</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> approx_count_distinct(StockCode, <span class="number">0.1</span>) <span class="keyword">FROM</span> DFTABLE</span><br></pre></td></tr></table></figure>

</details>


</li>
</ul>
</li>
</ul>
<ul>
<li><p><code>first(ì»¬ëŸ¼ëª…)</code>, <code>last(ì»¬ëŸ¼ëª…)</code> : ì²« ë²ˆì§¸ ê°’, ë§ˆì§€ë§‰ ê°’ ì¶”ì¶œ</p>
<ul>
<li><p>DataFrame ê°’ì´ ì•„ë‹Œ ë¡œìš° ê¸°ë°˜ ë™ì‘</p>
</li>
<li><details><summary class="only-hover">[7.1.4] ì˜ˆì œ í¼ì¹˜ê¸°</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">df.select(first(<span class="string">&quot;StockCode&quot;</span>), last(<span class="string">&quot;StockCode&quot;</span>)).show()</span><br><span class="line"><span class="comment">// +-----------------------+----------------------+</span></span><br><span class="line"><span class="comment">// |first(StockCode, false)|last(StockCode, false)|</span></span><br><span class="line"><span class="comment">// +-----------------------+----------------------+</span></span><br><span class="line"><span class="comment">// |                 85123A|                 22138|</span></span><br><span class="line"><span class="comment">// +-----------------------+----------------------+</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">first</span>(StockCode), <span class="keyword">last</span>(StockCode) <span class="keyword">FROM</span> dfTable</span><br></pre></td></tr></table></figure>
</details>
</li>
</ul>
</li>
<li><p><code>min(ì»¬ëŸ¼ëª…)</code>, <code>max(ì»¬ëŸ¼ëª…)</code> : ìµœì†Ÿê°’, ìµœëŒ“ê°’ ì¶”ì¶œ</p>
<ul>
<li><details><summary class="only-hover">[7.1.5] ì˜ˆì œ í¼ì¹˜ê¸°</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.&#123;min, max&#125;</span><br><span class="line">df.select(min(<span class="string">&quot;Quantity&quot;</span>), max(<span class="string">&quot;Quantity&quot;</span>)).show()</span><br><span class="line"><span class="comment">// +-------------+-------------+</span></span><br><span class="line"><span class="comment">// |min(Quantity)|max(Quantity)|</span></span><br><span class="line"><span class="comment">// +-------------+-------------+</span></span><br><span class="line"><span class="comment">// |       -80995|        80995|</span></span><br><span class="line"><span class="comment">// +-------------+-------------+</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">min</span>(Quantity), <span class="built_in">max</span>(Quantity) <span class="keyword">FROM</span> dfTable</span><br></pre></td></tr></table></figure>
</details>
</li>
</ul>
</li>
<li><p><code>sum(ì»¬ëŸ¼ëª…)</code> : íŠ¹ì • ì»¬ëŸ¼ì˜ ëª¨ë“  ê°’ í•©ì‚°</p>
<ul>
<li><details><summary class="only-hover">[7.1.6] ì˜ˆì œ í¼ì¹˜ê¸°</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.sum</span><br><span class="line">df.select(sum(<span class="string">&quot;Quantity&quot;</span>)).show() <span class="comment">// 5176450</span></span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line"><span class="comment">// |sum(Quantity)|</span></span><br><span class="line"><span class="comment">// +-------------+</span></span><br><span class="line"><span class="comment">// |      5176450|</span></span><br><span class="line"><span class="comment">// +-------------+</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">sum</span>(Quantity) <span class="keyword">FROM</span> dfTable</span><br></pre></td></tr></table></figure>
</details>


</li>
</ul>
</li>
</ul>
<ul>
<li><p><code>sumDistinct(ì»¬ëŸ¼ëª…)</code> : íŠ¹ì • ì»¬ëŸ¼ì˜ ê³ ìœ  (distinct) ê°’ í•©ì‚°</p>
<ul>
<li><details><summary class="only-hover">[7.1.7] ì˜ˆì œ í¼ì¹˜ê¸°</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.sumDistinct</span><br><span class="line">df.select(sumDistinct(<span class="string">&quot;Quantity&quot;</span>)).show() <span class="comment">// 29310</span></span><br><span class="line"><span class="comment">// +----------------------+</span></span><br><span class="line"><span class="comment">// |sum(DISTINCT Quantity)|</span></span><br><span class="line"><span class="comment">// +----------------------+</span></span><br><span class="line"><span class="comment">// |                 29310|</span></span><br><span class="line"><span class="comment">// +----------------------+</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">SUM</span>(Quantity) <span class="keyword">FROM</span> dfTable <span class="comment">-- 29310</span></span><br></pre></td></tr></table></figure>
</details>


</li>
</ul>
</li>
</ul>
<ul>
<li><p><code>avg(ì»¬ëŸ¼ëª…)</code> : í‰ê·  ê°’</p>
<ul>
<li><p>== <code>sum()/count()</code> == <code>expr(&quot;mean(ì»¬ëŸ¼ëª…)&quot;)</code></p>
</li>
<li><p>+ <code>distinct()</code> =&gt; ê³ ìœ³ê°’ í‰ê·  êµ¬í•˜ê¸°ë„ ê°€ëŠ¥</p>
</li>
<li><details><summary class="only-hover">[7.1.8] ì˜ˆì œ í¼ì¹˜ê¸°</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.&#123;sum, count, avg, expr&#125;</span><br><span class="line">(df.select(</span><br><span class="line">    count(<span class="string">&quot;Quantity&quot;</span>).alias(<span class="string">&quot;total_transactions&quot;</span>),</span><br><span class="line">    sum(<span class="string">&quot;Quantity&quot;</span>).alias(<span class="string">&quot;total_purchases&quot;</span>),</span><br><span class="line">    avg(<span class="string">&quot;Quantity&quot;</span>).alias(<span class="string">&quot;avg_purchases&quot;</span>),</span><br><span class="line">    expr(<span class="string">&quot;mean(Quantity)&quot;</span>).alias(<span class="string">&quot;mean_purchases&quot;</span>))</span><br><span class="line">  .selectExpr(</span><br><span class="line">    <span class="string">&quot;total_purchases/total_transactions&quot;</span>,</span><br><span class="line">    <span class="string">&quot;avg_purchases&quot;</span>,</span><br><span class="line">    <span class="string">&quot;mean_purchases&quot;</span>).show())</span><br><span class="line"><span class="comment">// +--------------------------------------+----------------+----------------+</span></span><br><span class="line"><span class="comment">// |(total_purchases / total_transactions)|   avg_purchases|  mean_purchases|</span></span><br><span class="line"><span class="comment">// +--------------------------------------+----------------+----------------+</span></span><br><span class="line"><span class="comment">// |                      9.55224954743324|9.55224954743324|9.55224954743324|</span></span><br><span class="line"><span class="comment">// +--------------------------------------+----------------+----------------+</span></span><br></pre></td></tr></table></figure>
</details>
</li>
</ul>
</li>
<li><p>ë¶„ì‚°ê³¼ í‘œì¤€í¸ì°¨</p>
<ul>
<li><p>í‰ê· (<code>m</code>) ì£¼ë³€ì— ë°ì´í„°ê°€ ë¶„í¬ëœ ì •ë„ë¥¼ ì¸¡ì •</p>
<ul>
<li>ë¶„ì‚° : í‰ê· ê³¼ì˜ ì°¨ì´ë¥¼ ì œê³±í•œ ê²°ê³¼ì˜ í‰ê·  (<code>v = avg((x-m)^2)</code>)</li>
<li>í‘œì¤€í¸ì°¨ : ë¶„ì‚°ì˜ ì œê³±ê·¼ (<code>Ïƒ = v^(1/2)</code>)</li>
</ul>
</li>
<li><p>ìŠ¤íŒŒí¬ëŠ” í‘œë³¸í‘œì¤€í¸ì°¨(sample standard deviation), ëª¨í‘œì¤€í¸ì°¨(population standard deviation) ë°©ì‹ ì§€ì›</p>
<ul>
<li>=&gt; ì•„ì˜ˆ ë‹¤ë¥´ë¯€ë¡œ <strong>ì˜ êµ¬ë¶„í•´ì„œ ì‚¬ìš©í•´ì•¼í•¨</strong></li>
</ul>
</li>
<li><p>í‘œë³¸í‘œì¤€ë¶„ì‚°, í‘œë³¸í‘œì¤€í¸ì°¨ ë°©ì‹ ì‚¬ìš© ì‹œ =&gt; <code>variance()</code>, <code>stddev()</code></p>
</li>
<li><p>ëª¨í‘œì¤€ë¶„ì‚°, ëª¨í‘œì¤€í¸ì°¨ ë°©ì‹ ì‚¬ìš© ì‹œ =&gt; <code>var_pop()</code>, <code>stddev_pop()</code></p>
</li>
<li><details><summary class="only-hover">[7.1.9] ì˜ˆì œ í¼ì¹˜ê¸°</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">df.select(var_pop(<span class="string">&quot;Quantity&quot;</span>), var_samp(<span class="string">&quot;Quantity&quot;</span>),</span><br><span class="line">  stddev_pop(<span class="string">&quot;Quantity&quot;</span>), stddev_samp(<span class="string">&quot;Quantity&quot;</span>)).show()</span><br><span class="line"><span class="comment">// +-----------------+------------------+--------------------+---------------------+</span></span><br><span class="line"><span class="comment">// |var_pop(Quantity)|var_samp(Quantity)|stddev_pop(Quantity)|stddev_samp(Quantity)|</span></span><br><span class="line"><span class="comment">// +-----------------+------------------+--------------------+---------------------+</span></span><br><span class="line"><span class="comment">// |47559.30364660923| 47559.39140929892|  218.08095663447835|   218.08115785023455|</span></span><br><span class="line"><span class="comment">// +-----------------+------------------+--------------------+---------------------+</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">var_pop</span>(Quantity), <span class="built_in">var_samp</span>(Quantity),</span><br><span class="line"><span class="built_in">stddev_pop</span>(Quantity), <span class="built_in">stddev_samp</span>(Quantity)</span><br><span class="line"><span class="keyword">FROM</span> dfTable</span><br></pre></td></tr></table></figure>
</details>
</li>
</ul>
</li>
<li><p>ë¹„ëŒ€ì¹­ë„ì™€ ì²¨ë„</p>
<ul>
<li><p>ë°ì´í„°ì˜ ë³€ê³¡ì (extreme point) ë¥¼ ì¸¡ì •í•˜ëŠ” ë°©ë²•</p>
<ul>
<li><code>skewness(ì»¬ëŸ¼ëª…)</code> : ë¹„ëŒ€ì¹­ë„ (ë°ì´í„° í‰ê· ì˜ ë¹„ëŒ€ì¹­ ì •ë„) ì¸¡ì •</li>
<li><code>kurtosis(ì»¬ëŸ¼ëª…)</code> : ì²¨ë„ (ë°ì´í„° ë ë¶€ë¶„ì˜ ë¾°ì¡±í•œ ì •ë„) ì¸¡ì •</li>
</ul>
</li>
<li><p>í™•ë¥ ë³€ìˆ˜(random variable)ì˜ í™•ë¥ ë¶„í¬(probability distribution)ë¡œ ë°ì´í„° ëª¨ë¸ë§ ì‹œì— ì¤‘ìš”</p>
</li>
<li><p>ìˆ˜í•™ì ì¸ ë‚´ìš©ì€ ë”°ë¡œ ì•Œì•„ì„œâ€¦ í í ..</p>
</li>
<li><details><summary class="only-hover">[7.1.10] ì˜ˆì œ í¼ì¹˜ê¸°</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.&#123;skewness, kurtosis&#125;</span><br><span class="line">df.select(skewness(<span class="string">&quot;Quantity&quot;</span>), kurtosis(<span class="string">&quot;Quantity&quot;</span>)).show()</span><br><span class="line"><span class="comment">// +--------------------+------------------+</span></span><br><span class="line"><span class="comment">// |  skewness(Quantity)|kurtosis(Quantity)|</span></span><br><span class="line"><span class="comment">// +--------------------+------------------+</span></span><br><span class="line"><span class="comment">// |-0.26407557610528376|119768.05495530753|</span></span><br><span class="line"><span class="comment">// +--------------------+------------------+</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> skewness(Quantity), kurtosis(Quantity) <span class="keyword">FROM</span> dfTable</span><br></pre></td></tr></table></figure>
</details>
</li>
</ul>
</li>
<li><p>ê³µë¶„ì‚°ê³¼ ìƒê´€ê´€ê³„</p>
<ul>
<li><p>ë‘ ì»¬ëŸ¼ê°’ ì‚¬ì´ì˜ ì˜í–¥ë„ ë¹„êµ</p>
</li>
<li><p><code>cov(ì»¬ëŸ¼1, ì»¬ëŸ¼2)</code> : ê³µë¶„ì‚°(covariance) ê³„ì‚°</p>
<ul>
<li>ë°ì´í„° ì…ë ¥ê°’ì— ë”°ë¼ ë‹¤ë¥¸ ë²”ìœ„ë¥¼ ê°€ì§</li>
<li>var í•¨ìˆ˜ì²˜ëŸ¼ í‘œë³¸ê³µë¶„ì‚°(sample covariance)ì´ë‚˜ ëª¨ê³µë¶„ì‚°(population covariance) ë°©ì‹ìœ¼ë¡œë„ ê³„ì‚° ê°€ëŠ¥ =&gt; <code>covar_samp()</code>, <code>covar_pop()</code></li>
</ul>
</li>
<li><p><code>corr(ì»¬ëŸ¼1, ì»¬ëŸ¼2)</code> : ìƒê´€ê´€ê³„(correlation) ê³„ì‚°</p>
<ul>
<li>í”¼ì–´ìŠ¨ ìƒê´€ê³„ìˆ˜ (Pearson correlation coefficient) ì¸¡ì • (-1 &lt;= <code>r</code> &lt;= 1)</li>
<li>ëª¨ì§‘ë‹¨ì´ë‚˜ í‘œë³¸ì— ëŒ€í•œ ê³„ì‚° ê°œë… X</li>
</ul>
</li>
<li><details><summary class="only-hover">[7.1.11] ì˜ˆì œ í¼ì¹˜ê¸°</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.&#123;corr, covar_pop, covar_samp&#125;</span><br><span class="line">df.select(corr(<span class="string">&quot;InvoiceNo&quot;</span>, <span class="string">&quot;Quantity&quot;</span>), covar_samp(<span class="string">&quot;InvoiceNo&quot;</span>, <span class="string">&quot;Quantity&quot;</span>),</span><br><span class="line">    covar_pop(<span class="string">&quot;InvoiceNo&quot;</span>, <span class="string">&quot;Quantity&quot;</span>)).show()</span><br><span class="line"><span class="comment">// +-------------------------+-------------------------------+------------------------------+</span></span><br><span class="line"><span class="comment">// |corr(InvoiceNo, Quantity)|covar_samp(InvoiceNo, Quantity)|covar_pop(InvoiceNo, Quantity)|</span></span><br><span class="line"><span class="comment">// +-------------------------+-------------------------------+------------------------------+</span></span><br><span class="line"><span class="comment">// |     4.912186085640497E-4|             1052.7280543915997|            1052.7260778754955|</span></span><br><span class="line"><span class="comment">// +-------------------------+-------------------------------+------------------------------+</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">corr</span>(InvoiceNo, Quantity), <span class="built_in">covar_samp</span>(InvoiceNo, Quantity),</span><br><span class="line"><span class="built_in">covar_pop</span>(InvoiceNo, Quantity)</span><br><span class="line"><span class="keyword">FROM</span> dfTable</span><br></pre></td></tr></table></figure>
</details>
</li>
</ul>
</li>
<li><p>ë³µí•© ë°ì´í„° íƒ€ì…ì˜ ì§‘ê³„</p>
<ul>
<li><p>ìŠ¤íŒŒí¬ëŠ” ìˆ˜ì‹ì„ í†µí•œ ì§‘ê³„ ì™¸ì—ë„ <strong>ë³µí•© ë°ì´í„° íƒ€ì…</strong>ì„ ì‚¬ìš©í•œ ì§‘ê³„ ê°€ëŠ¥ (ex. íŠ¹ì • ì»¬ëŸ¼ ê°’ =&gt; List, Set .. ë“±ìœ¼ë¡œ ìˆ˜ì§‘)</p>
</li>
<li><p>ìˆ˜ì§‘ëœ ë°ì´í„°ëŠ” ë‹¤ì–‘í•œ í”„ë¡œê·¸ë˜ë° ë°©ì‹ìœ¼ë¡œ ë‹¤ë£¨ê±°ë‚˜ í™œìš© ê°€ëŠ¥</p>
</li>
<li><details><summary class="only-hover">[7.1.12] ì˜ˆì œ í¼ì¹˜ê¸°</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.&#123;collect_set, collect_list&#125;</span><br><span class="line">df.agg(collect_set(<span class="string">&quot;Country&quot;</span>), collect_list(<span class="string">&quot;Country&quot;</span>)).show()</span><br><span class="line"><span class="comment">// +--------------------+---------------------+</span></span><br><span class="line"><span class="comment">// |collect_set(Country)|collect_list(Country)|</span></span><br><span class="line"><span class="comment">// +--------------------+---------------------+</span></span><br><span class="line"><span class="comment">// |[Portugal, Italy,...| [United Kingdom, ...|</span></span><br><span class="line"><span class="comment">// +--------------------+---------------------+</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> collect_set(Country), collect_set(Country) <span class="keyword">FROM</span> dfTable</span><br></pre></td></tr></table></figure>
</details>

</li>
</ul>
</li>
</ul>
<h3 id="7-2-ê·¸ë£¹í™”"><a href="#7-2-ê·¸ë£¹í™”" class="headerlink" title="7.2 ê·¸ë£¹í™”"></a>7.2 ê·¸ë£¹í™”</h3><ul>
<li><u>ë°ì´í„° <strong>ê·¸ë£¹</strong> ê¸°ë°˜ì˜ ì§‘ê³„</u> ì— ëŒ€í•œ ë‚´ìš©<ul>
<li>([7.1] ì€ DataFrame ìˆ˜ì¤€ì˜ ì§‘ê³„ ë‚´ìš©)</li>
<li>ì¹´í…Œê³ ë¦¬í˜• ë°ì´í„°(categorical data) ì‚¬ìš©</li>
<li>=&gt; ë‹¨ì¼ ì»¬ëŸ¼ì˜ ë°ì´í„°ë¥¼ ê·¸ë£¹í™”, í•´ë‹¹ ê·¸ë£¹ì˜ ë‹¤ë¥¸ ì—¬ëŸ¬ ì»¬ëŸ¼ì„ ì‚¬ìš©í•´ì„œ ê³„ì‚°</li>
</ul>
</li>
<li>ê·¸ë£¹í™” ì‘ì—…ì˜ 2 ë‹¨ê³„<ul>
<li>1) í•˜ë‚˜ ì´ìƒì˜ ì»¬ëŸ¼ ê·¸ë£¹í™” (ì—¬ëŸ¬ê°œ ì§€ì •ë„ ê°€ëŠ¥)</li>
<li>2) ì§‘ê³„ ì—°ì‚° ìˆ˜í–‰</li>
</ul>
</li>
<li>í‘œí˜„ì‹ì„ ì´ìš©í•œ ê·¸ë£¹í™”<ul>
<li>ì¹´ìš´íŒ…ì€ ë©”ì„œë“œ, í•¨ìˆ˜ ë‘˜ ë‹¤ ì‚¬ìš© ê°€ëŠ¥ ğŸ¤”<ul>
<li>ë©”ì„œë“œ ë³´ë‹¤ <code>count()</code> í•¨ìˆ˜ ì‚¬ìš© ì¶”ì²œ</li>
<li>select êµ¬ë¬¸ì˜ í‘œí˜„ì‹ ì§€ì •ë³´ë‹¤ <code>agg()</code> ë©”ì„œë“œ ì‚¬ìš© ì¶”ì²œ</li>
</ul>
</li>
<li><code>agg()</code> : ì—¬ëŸ¬ ì§‘ê³„ ì²˜ë¦¬ í•œë²ˆì— ì§€ì • &amp; ì§‘ê³„ì— í‘œí˜„ì‹ ì‚¬ìš© ê°€ëŠ¥<ul>
<li>íŠ¸ëœìŠ¤í¬ë©”ì´ì…˜ ì™„ë£Œ ì»¬ëŸ¼ì— <code>alias</code> ì‚¬ìš© ê°€ëŠ¥</li>
</ul>
</li>
</ul>
</li>
<li>ë§µì„ ì´ìš©í•œ ê·¸ë£¹í™”<ul>
<li>ë§µ(map) íƒ€ì… ì‚¬ìš© : Key = ì»¬ëŸ¼ / Value = ìˆ˜í–‰í•  ì§‘ê³„ í•¨ìˆ˜ì˜ ë¬¸ìì—´</li>
<li>ìˆ˜í–‰í•  ì§‘ê³„í•¨ìˆ˜ë¥¼ í•œ ì¤„ë¡œ ì‘ì„± ì‹œ =&gt; ì—¬ëŸ¬ ì»¬ëŸ¼ëª… ì¬ì‚¬ìš© ê°€ëŠ¥<ul>
<li><code>agg(Key -&gt; Value, Key -&gt; Value, ...)</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="7-3-ìœˆë„ìš°-í•¨ìˆ˜"><a href="#7-3-ìœˆë„ìš°-í•¨ìˆ˜" class="headerlink" title="7.3 ìœˆë„ìš° í•¨ìˆ˜"></a>7.3 ìœˆë„ìš° í•¨ìˆ˜</h3><ul>
<li><strong>ìœˆë„ìš° í•¨ìˆ˜</strong> ë„ ì§‘ê³„ì— ì‚¬ìš© ê°€ëŠ¥</li>
<li>ìœˆë„ìš° í•¨ìˆ˜<ul>
<li>ë°ì´í„°ì˜ íŠ¹ì • â€˜ìœˆë„ìš°(window)â€™ ëŒ€ìƒìœ¼ë¡œ ê³ ìœ ì˜ ì§‘ê³„ ì—°ì‚° ìˆ˜í–‰</li>
<li>ë°ì´í„°ì˜ â€˜ìœˆë„ìš°â€™ =&gt; í˜„ì¬ ë°ì´í„°ì— ëŒ€í•œ ì°¸ì¡°(reference)ë¥¼ ì‚¬ìš©í•´ ì •ì˜</li>
<li>ìœˆë„ìš° ëª…ì„¸(window specification) =&gt; í•¨ìˆ˜ì— ì „ë‹¬ë  ë¡œìš° ê²°ì •</li>
</ul>
</li>
<li>ìŠ¤íŒŒí¬ê°€ ì§€ì›í•˜ëŠ” ìœˆë„ìš° í•¨ìˆ˜<ul>
<li>ë­í¬ í•¨ìˆ˜ (ranking function)</li>
<li>ë¶„ì„ í•¨ìˆ˜ (analytic function)</li>
<li>ì§‘ê³„ í•¨ìˆ˜ (aggragate function)</li>
</ul>
</li>
<li>ìœˆë„ìš° í•¨ìˆ˜ vs group-by í•¨ìˆ˜<ul>
<li>ìœˆë„ìš° í•¨ìˆ˜ : <strong>í”„ë ˆì„</strong>ì— ì…ë ¥ë˜ëŠ” ëª¨ë“  ë¡œìš°ì— ëŒ€í•´ ê²°ê³¼ê°’ ê³„ì‚°</li>
<li>group-by í•¨ìˆ˜ : ëª¨ë“  ë¡œìš° ë ˆì½”ë“œê°€ ë‹¨ì¼ ê·¸ë£¹ìœ¼ë¡œë§Œ ì´ë™</li>
</ul>
</li>
<li>í”„ë ˆì„(frame) : ë¡œìš° ê·¸ë£¹ ê¸°ë°˜ì˜ í…Œì´ë¸”<ul>
<li>ê° ë¡œìš°ëŠ” í•˜ë‚˜ ì´ìƒì˜ í”„ë ˆì„ì— í• ë‹¹ ê°€ëŠ¥<img width="300" alt="row - window frame" src="https://user-images.githubusercontent.com/26691216/106770674-8b5eeb00-6681-11eb-929f-09e7c373f9a2.png"></li>
<li>í”„ë ˆì„ ì •ì˜ ë°©ë²•ì€ ì˜ˆì œ ì°¸ê³ </li>
</ul>
</li>
<li>ex. í•˜ë£¨ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ê°’ì˜ ë¡¤ë§ í‰ê· (rolling average) êµ¬í•˜ê¸°<ul>
<li>ê°œë³„ ë¡œìš°ê°€ 7ê°œì˜ ë‹¤ë¥¸ í”„ë ˆì„ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ì•¼ í•¨</li>
</ul>
</li>
</ul>
<details><summary class="point-color-can-hover">[7.3] ì˜ˆì œ í¼ì¹˜ê¸°</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1) ì£¼ë¬¸ ì¼ì(InvoiceDate) =&gt; &#x27;date&#x27; ì»¬ëŸ¼ìœ¼ë¡œ ë³€í™˜ (ë‚ ì§œ ì •ë³´ë§Œ í¬í•¨)</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.&#123;col, to_date&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> dfWithDate = df.withColumn(<span class="string">&quot;date&quot;</span>, to_date(col(<span class="string">&quot;InvoiceDate&quot;</span>),</span><br><span class="line">  <span class="string">&quot;MM/d/yyyy H:mm&quot;</span>))</span><br><span class="line">dfWithDate.createOrReplaceTempView(<span class="string">&quot;dfWithDate&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2) ìœˆë„ìš° ëª…ì„¸ ë§Œë“¤ê¸°</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.expressions.<span class="type">Window</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.col</span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> windowSpec = (<span class="type">Window</span></span><br><span class="line">  .partitionBy(<span class="string">&quot;CustomerId&quot;</span>, <span class="string">&quot;date&quot;</span>)  <span class="comment">// ê·¸ë£¹ì„ ì–´ë–»ê²Œ ë‚˜ëˆŒì§€ ê²°ì •</span></span><br><span class="line">  .orderBy(col(<span class="string">&quot;Quantity&quot;</span>).desc)    <span class="comment">// íŒŒí‹°ì…˜ ì •ë ¬ ë°©ì‹</span></span><br><span class="line">  .rowsBetween(<span class="type">Window</span>.unboundedPreceding, <span class="type">Window</span>.currentRow)) <span class="comment">// í”„ë ˆì„ ëª…ì„¸ (=&gt; ì²« ë¡œìš° ~ í˜„ì¬ ë¡œìš°ê¹Œì§€ í™•ì¸)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3) ì§‘ê³„ í•¨ìˆ˜ë¡œ ë¶„ì„</span></span><br><span class="line"><span class="comment">// =&gt; ì»¬ëŸ¼ or í‘œí˜„ì‹ ë°˜í™˜ ì‹œ DataFrame.select() ì—ì„œ ì‚¬ìš© ê°€ëŠ¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ì˜ˆì‹œ 1. maxPurchaseQuantity = ì‹œê°„ëŒ€ë³„ ìµœëŒ€ êµ¬ë§¤ ê°œìˆ˜</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.max</span><br><span class="line"><span class="keyword">val</span> maxPurchaseQuantity = max(col(<span class="string">&quot;Quantity&quot;</span>)).over(windowSpec)</span><br><span class="line"><span class="comment">// maxPurchaseQuantity: org.apache.spark.sql.Column = max(Quantity) OVER (PARTITION BY CustomerId, date ORDER BY Quantity DESC NULLS LAST ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ì˜ˆì‹œ 2. purchase(Dense)Rank = êµ¬ë§¤ëŸ‰ ìˆœìœ„ </span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.&#123;dense_rank, rank&#125;</span><br><span class="line"><span class="keyword">val</span> purchaseDenseRank = dense_rank().over(windowSpec) <span class="comment">// ìˆœìœ„ê°€ ë¹„ì§€ì•Šë„ë¡ dense_rank() ì‚¬ìš©</span></span><br><span class="line"><span class="keyword">val</span> purchaseRank = rank().over(windowSpec)</span><br><span class="line"></span><br><span class="line"><span class="comment">// DataFrame.select()ë¡œ ìœˆë„ìš° ê°’ í™•ì¸</span></span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.col</span><br><span class="line"></span><br><span class="line">(dfWithDate.where(<span class="string">&quot;CustomerId IS NOT NULL&quot;</span>).orderBy(<span class="string">&quot;CustomerId&quot;</span>)</span><br><span class="line">  .select(</span><br><span class="line">    col(<span class="string">&quot;CustomerId&quot;</span>),</span><br><span class="line">    col(<span class="string">&quot;date&quot;</span>),</span><br><span class="line">    col(<span class="string">&quot;Quantity&quot;</span>),</span><br><span class="line">    purchaseRank.alias(<span class="string">&quot;quantityRank&quot;</span>),</span><br><span class="line">    purchaseDenseRank.alias(<span class="string">&quot;quantityDenseRank&quot;</span>),</span><br><span class="line">    maxPurchaseQuantity.alias(<span class="string">&quot;maxPurchaseQuantity&quot;</span>)).show())</span><br><span class="line"><span class="comment">// +----------+----------+--------+------------+-----------------+-------------------+</span></span><br><span class="line"><span class="comment">// |CustomerId|      date|Quantity|quantityRank|quantityDenseRank|maxPurchaseQuantity|</span></span><br><span class="line"><span class="comment">// +----------+----------+--------+------------+-----------------+-------------------+</span></span><br><span class="line"><span class="comment">// |     12346|2011-01-18|   74215|           1|                1|              74215|</span></span><br><span class="line"><span class="comment">// |     12346|2011-01-18|  -74215|           2|                2|              74215|</span></span><br><span class="line"><span class="comment">// |     12347|2010-12-07|      36|           1|                1|                 36|</span></span><br><span class="line"><span class="comment">// |     12347|2010-12-07|      30|           2|                2|                 36|</span></span><br><span class="line"><span class="comment">// |     12347|2010-12-07|      24|           3|                3|                 36|</span></span><br><span class="line"><span class="comment">// |     12347|2010-12-07|      12|           4|                4|                 36|</span></span><br><span class="line"><span class="comment">// |     12347|2010-12-07|      12|           4|                4|                 36|</span></span><br><span class="line"><span class="comment">// |     12347|2010-12-07|      12|           4|                4|                 36|</span></span><br><span class="line"><span class="comment">// |     12347|2010-12-07|      12|           4|                4|                 36|</span></span><br><span class="line"><span class="comment">// |     12347|2010-12-07|      12|           4|                4|                 36|</span></span><br><span class="line"><span class="comment">// |     12347|2010-12-07|      12|           4|                4|                 36|</span></span><br><span class="line"><span class="comment">// |     12347|2010-12-07|      12|           4|                4|                 36|</span></span><br><span class="line"><span class="comment">// |     12347|2010-12-07|      12|           4|                4|                 36|</span></span><br><span class="line"><span class="comment">// |     12347|2010-12-07|      12|           4|                4|                 36|</span></span><br><span class="line"><span class="comment">// |     12347|2010-12-07|      12|           4|                4|                 36|</span></span><br><span class="line"><span class="comment">// |     12347|2010-12-07|      12|           4|                4|                 36|</span></span><br><span class="line"><span class="comment">// |     12347|2010-12-07|      12|           4|                4|                 36|</span></span><br><span class="line"><span class="comment">// |     12347|2010-12-07|      12|           4|                4|                 36|</span></span><br><span class="line"><span class="comment">// |     12347|2010-12-07|       6|          17|                5|                 36|</span></span><br><span class="line"><span class="comment">// |     12347|2010-12-07|       6|          17|                5|                 36|</span></span><br><span class="line"><span class="comment">// +----------+----------+--------+------------+-----------------+-------------------+</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL</span></span><br><span class="line"><span class="keyword">SELECT</span> CustomerId, <span class="type">date</span>, Quantity,</span><br><span class="line">  <span class="built_in">rank</span>(Quantity) <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> CustomerId, <span class="type">date</span></span><br><span class="line">                       <span class="keyword">ORDER</span> <span class="keyword">BY</span> Quantity <span class="keyword">DESC</span> <span class="keyword">NULLS</span> <span class="keyword">LAST</span></span><br><span class="line">                       <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span></span><br><span class="line">                         UNBOUNDED PRECEDING <span class="keyword">AND</span></span><br><span class="line">                         <span class="keyword">CURRENT</span> <span class="type">ROW</span>) <span class="keyword">as</span> rank,</span><br><span class="line"></span><br><span class="line">  <span class="built_in">dense_rank</span>(Quantity) <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> CustomerId, <span class="type">date</span></span><br><span class="line">                             <span class="keyword">ORDER</span> <span class="keyword">BY</span> Quantity <span class="keyword">DESC</span> <span class="keyword">NULLS</span> <span class="keyword">LAST</span></span><br><span class="line">                             <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span></span><br><span class="line">                               UNBOUNDED PRECEDING <span class="keyword">AND</span></span><br><span class="line">                               <span class="keyword">CURRENT</span> <span class="type">ROW</span>) <span class="keyword">as</span> dRank,</span><br><span class="line"></span><br><span class="line">  <span class="built_in">max</span>(Quantity) <span class="keyword">OVER</span> (<span class="keyword">PARTITION</span> <span class="keyword">BY</span> CustomerId, <span class="type">date</span></span><br><span class="line">                      <span class="keyword">ORDER</span> <span class="keyword">BY</span> Quantity <span class="keyword">DESC</span> <span class="keyword">NULLS</span> <span class="keyword">LAST</span></span><br><span class="line">                      <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span></span><br><span class="line">                        UNBOUNDED PRECEDING <span class="keyword">AND</span></span><br><span class="line">                        <span class="keyword">CURRENT</span> <span class="type">ROW</span>) <span class="keyword">as</span> maxPurchase</span><br><span class="line"><span class="keyword">FROM</span> dfWithDate <span class="keyword">WHERE</span> CustomerId <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> CustomerId</span><br></pre></td></tr></table></figure>
</details>

<blockquote>
<p>Window ë©”ì„œë“œ</p>
<ul>
<li><code>partitionBy()</code> : ê·¸ë£¹ì„ ì–´ë–»ê²Œ ë‚˜ëˆŒì§€ ê²°ì • (ì§€ê¸ˆê¹Œì§€ íŒŒí‹°ì…”ë‹ ìŠ¤í‚¤ë§ˆ ê°œë…ì´ë‘ ê´€ë ¨ X)</li>
<li><code>orderBy()</code> : íŒŒí‹°ì…˜ ì •ë ¬ ë°©ì‹ ì •ì˜</li>
<li><code>rowsBetween(from, to)</code> : ì…ë ¥ëœ ë¡œìš°ì˜ ì°¸ì¡° ê¸°ë°˜ìœ¼ë¡œ í”„ë ˆì„ì— ë¡œìš°ê°€ í¬í•¨ë  ìˆ˜ ìˆëŠ”ì§€ ê²°ì •</li>
</ul>
<p>row_number vs <strong>rank</strong> vs <strong>dense_rank</strong></p>
<ul>
<li><code>row_number()</code> : ìˆœì„œëŒ€ë¡œ ë„˜ë²„ë§ (1,2,3,4 â€¦)</li>
<li><code>rank()</code> : ìˆœì„œëŒ€ë¡œ ë„˜ë²„ë§ + ê°™ì€ ê°’ì¼ ê²½ìš° ê°™ì€ ìˆ«ì (1,1,3,4 â€¦)</li>
<li><code>dense_rank()</code> : rank ì™€ ë™ì¼í•˜ë˜, ë¹ˆê°’ ì—†ì´ ì¦ê°€í•˜ê²Œë” ë„˜ë²„ë§ (1,1,2,3, â€¦)</li>
</ul>
</blockquote>
<h3 id="7-4-ê·¸ë£¹í™”-ì…‹"><a href="#7-4-ê·¸ë£¹í™”-ì…‹" class="headerlink" title="7.4 ê·¸ë£¹í™” ì…‹"></a>7.4 ê·¸ë£¹í™” ì…‹</h3><ul>
<li>ì»¬ëŸ¼ì˜ ê°’ì„ ì´ìš©í•´ ì—¬ëŸ¬ ì»¬ëŸ½ ì§‘ê³„ =&gt; <code>group-by</code> í‘œí˜„ì‹<ul>
<li>ê·¸ëŸ¬ë©´ <strong>ì—¬ëŸ¬ ê·¸ë£¹</strong>ì— ê±¸ì³ ì§‘ê³„ëŠ”? =&gt; <strong>ê·¸ë£¹í™”ì…‹</strong>  ì‚¬ìš©</li>
</ul>
</li>
<li>ê·¸ë£¹í™” ì…‹ : ì—¬ëŸ¬ ì§‘ê³„ë¥¼ ê²°í•©í•˜ëŠ” ì €ìˆ˜ì¤€ ê¸°ëŠ¥<ul>
<li><code>GROUPING SETS</code> êµ¬ë¬¸ì€ SQLì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥</li>
<li>DataFrameì—ì„œ ë™ì¼ ì—°ì‚°í•˜ë ¤ë©´? =&gt; <strong>ë¡¤ì—…</strong>, <strong>íë¸Œ</strong> ë©”ì„œë“œ ì‚¬ìš©</li>
</ul>
</li>
<li>ì£¼ì˜ ì‚¬í•­<ul>
<li>ê·¸ë£¹í™” ì…‹, ë¡¤ì—…, íë¸Œ ì‚¬ìš© ì‹œ <strong>null ì œê±° í•„ìˆ˜</strong></li>
<li>nullì— ë”°ë¼ ì§‘ê³„ ìˆ˜ì¤€ì´ ë‹¬ë¼ì§ (=&gt; null ë¯¸ì œê±°ì‹œ ë¶€ì •í™•í•œ ê²°ê³¼)</li>
</ul>
</li>
</ul>
<details><summary class="point-color-can-hover">[7.4.0] 'ê·¸ë£¹í™” ì…‹' ì˜ˆì œ í¼ì¹˜ê¸°</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ê·¸ë£¹í™” ì…‹ ì‚¬ìš© ì‹œ null ì œê±° í•„ìˆ˜</span></span><br><span class="line"><span class="keyword">val</span> dfNoNull = dfWithDate.drop()</span><br><span class="line">dfNoNull.createOrReplaceTempView(<span class="string">&quot;dfNoNull&quot;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL ì˜ˆì œ 1) ì¬ê³  ì½”ë“œ(StockCode)ì™€ ê³ ê°(CustomerId) ë³„ ì´ ìˆ˜ëŸ‰ êµ¬í•˜ê¸°</span></span><br><span class="line"><span class="keyword">SELECT</span> CustomerId, stockCode, <span class="built_in">sum</span>(Quantity) <span class="keyword">FROM</span> dfNoNull</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> customerId, stockCode</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> CustomerId <span class="keyword">DESC</span>, stockCode <span class="keyword">DESC</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- (ê·¸ë£¹í™” ì…‹ ì‚¬ìš©í•œ ë™ì¼ í‘œí˜„)</span></span><br><span class="line"><span class="keyword">SELECT</span> CustomerId, stockCode, <span class="built_in">sum</span>(Quantity) <span class="keyword">FROM</span> dfNoNull</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> customerId, stockCode <span class="keyword">GROUPING</span> <span class="keyword">SETS</span>((customerId, stockCode))</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> CustomerId <span class="keyword">DESC</span>, stockCode <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- SQL ì˜ˆì œ 2) ì˜ˆì œ 1 + ì¬ê³  ì½”ë“œë‚˜ ê³ ê° ìƒê´€ì—†ì´ ì´ ìˆ˜ëŸ‰ í•©ì‚° ê²°ê³¼ ì¶”ê°€ =&gt; group-byë¡œ ì²˜ë¦¬ ë¶ˆê°€</span></span><br><span class="line"><span class="comment">-- ê·¸ë£¹í™” ì…‹ìœ¼ë¡œ ì§‘ê³„ ë°©ì‹ ì§€ì •</span></span><br><span class="line"><span class="keyword">SELECT</span> CustomerId, stockCode, <span class="built_in">sum</span>(Quantity) <span class="keyword">FROM</span> dfNoNull</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> customerId, stockCode <span class="keyword">GROUPING</span> <span class="keyword">SETS</span>((customerId, stockCode),())</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> CustomerId <span class="keyword">DESC</span>, stockCode <span class="keyword">DESC</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># output</span></span><br><span class="line">+----------+---------+-------------+</span><br><span class="line">|CustomerId|stockCode|sum(Quantity)|</span><br><span class="line">+----------+---------+-------------+</span><br><span class="line">|     18287|    85173|           48|</span><br><span class="line">|     18287|   85040A|           48|</span><br><span class="line">|     18287|   85039B|          120|</span><br><span class="line">...</span><br><span class="line">|     18287|    23269|           36|</span><br><span class="line">+----------+---------+-------------+</span><br></pre></td></tr></table></figure>
</details>

<ul>
<li>ë¡¤ì—…(rollup)<ul>
<li><code>group-by</code> ìŠ¤íƒ€ì¼ì˜ ë‹¤ì–‘í•œ ì—°ì‚°ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ë‹¤ì°¨ì› ì§‘ê³„ ê¸°ëŠ¥</li>
<li><code>rollup(ê·¸ë£¹í™” í‚¤)</code> =&gt; ë‹¤ì–‘í•œ ì»¬ëŸ¼ì„ ê·¸ë£¹í™” í‚¤ë¡œ ì„¤ì • ê°€ëŠ¥</li>
<li>ë¡¤ì—…ëœ ì»¬ëŸ¼ê°’ì´ ëª¨ë‘ null ì¸ ë¡œìš° = í•´ë‹¹ ì»¬ëŸ¼ì— ì†í•œ ë ˆì½”ë“œì˜ ì „ì²´ í•©ê³„</li>
</ul>
</li>
</ul>
<details><summary class="point-color-can-hover">[7.4.1] 'ë¡¤ì—…' ì˜ˆì œ í¼ì¹˜ê¸°</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ì‹œê°„(ì‹ ê·œ Date ì»¬ëŸ¼), ê³µê°„(Country) ì„ ì¶•ìœ¼ë¡œ í•˜ëŠ” ë¡¤ì—…</span></span><br><span class="line"><span class="comment">// =&gt; &#x27;ëª¨ë“  ë‚ ì§œ ì´í•©&#x27;, &#x27;ë‚ ì§œë³„ ì´í•©&#x27;, &#x27;ë‚ ì§œë³„ êµ­ê°€ë³„ ì´í•©&#x27; í¬í•¨í•˜ëŠ” DataFrame ìƒì„±</span></span><br><span class="line"><span class="keyword">val</span> rolledUpDF = (dfNoNull.rollup(<span class="string">&quot;Date&quot;</span>, <span class="string">&quot;Country&quot;</span>).agg(sum(<span class="string">&quot;Quantity&quot;</span>))</span><br><span class="line">  .selectExpr(<span class="string">&quot;Date&quot;</span>, <span class="string">&quot;Country&quot;</span>, <span class="string">&quot;`sum(Quantity)` as total_quantity&quot;</span>)</span><br><span class="line">  .orderBy(<span class="string">&quot;Date&quot;</span>))</span><br><span class="line">rolledUpDF.show()</span><br><span class="line"><span class="comment">// +----------+--------------+--------------+</span></span><br><span class="line"><span class="comment">// |      Date|       Country|total_quantity|</span></span><br><span class="line"><span class="comment">// +----------+--------------+--------------+</span></span><br><span class="line"><span class="comment">// |      null|          null|       5176450| =&gt; ì „ì²´ í•©ê³„</span></span><br><span class="line"><span class="comment">// |2010-12-01|   Netherlands|            97|</span></span><br><span class="line"><span class="comment">// |2010-12-01|       Germany|           117|</span></span><br><span class="line"><span class="comment">// |2010-12-01|     Australia|           107|</span></span><br><span class="line"><span class="comment">// |2010-12-01|        France|           449|</span></span><br><span class="line"><span class="comment">// |2010-12-01|          EIRE|           243|</span></span><br><span class="line"><span class="comment">// |2010-12-01|United Kingdom|         23949|</span></span><br><span class="line"><span class="comment">// |2010-12-01|          null|         26814|</span></span><br><span class="line"><span class="comment">// |2010-12-01|        Norway|          1852|</span></span><br><span class="line"><span class="comment">// |2010-12-02|          EIRE|             4|</span></span><br><span class="line"><span class="comment">// |2010-12-02|          null|         21023|</span></span><br><span class="line"><span class="comment">// |2010-12-02|       Germany|           146|</span></span><br><span class="line"><span class="comment">// |2010-12-02|United Kingdom|         20873|</span></span><br><span class="line"><span class="comment">// |2010-12-03|        France|           239|</span></span><br><span class="line"><span class="comment">// |2010-12-03|      Portugal|            65|</span></span><br><span class="line"><span class="comment">// |2010-12-03|       Germany|           170|</span></span><br><span class="line"><span class="comment">// |2010-12-03|       Belgium|           528|</span></span><br><span class="line"><span class="comment">// |2010-12-03|         Spain|           400|</span></span><br><span class="line"><span class="comment">// |2010-12-03|         Italy|           164|</span></span><br><span class="line"><span class="comment">// |2010-12-03|   Switzerland|           110|</span></span><br><span class="line"><span class="comment">// +----------+--------------+--------------+</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Country, Date ë‘˜ ë‹¤ null ì¸ ë¡œìš° =&gt; ì „ì²´ í•©ê³„ ë‚˜íƒ€ëƒ„</span></span><br><span class="line">rolledUpDF.where(<span class="string">&quot;Country IS NULL&quot;</span>).show()</span><br><span class="line">rolledUpDF.where(<span class="string">&quot;Date IS NULL&quot;</span>).show()</span><br><span class="line"><span class="comment">// +----+-------+--------------+</span></span><br><span class="line"><span class="comment">// |Date|Country|total_quantity|</span></span><br><span class="line"><span class="comment">// +----+-------+--------------+</span></span><br><span class="line"><span class="comment">// |null|   null|       5176450|</span></span><br><span class="line"><span class="comment">// +----+-------+--------------+</span></span><br></pre></td></tr></table></figure>
</details>

<ul>
<li>íë¸Œ(cube)<ul>
<li>ë¡¤ì—…ì˜ ê³ ì°¨ì›ì  ì‚¬ìš© (í˜¸ì¶œ ë°©ì‹ë„ ìœ ì‚¬)</li>
<li>ìš”ì†Œë“¤ì„ ê³„ì¸µì ìœ¼ë¡œ ë‹¤ë£¨ëŠ” ëŒ€ì‹  ëª¨ë“  ì°¨ì›ì— ëŒ€í•´ ë™ì¼í•œ ì‘ì—… ìˆ˜í–‰</li>
<li>ex. ì „ì²´ ê¸°ê°„ì— ëŒ€í•œ ë‚ ì§œì™€ êµ­ê°€ë³„ ê²°ê³¼ êµ¬í•˜ê¸°</li>
<li><code>cube(ê·¸ë£¹í™” í‚¤)</code> =&gt; ìš”ì•½ ì •ë³´ í…Œì´ë¸” ë§Œë“¤ê¸° ê°€ëŠ¥</li>
</ul>
</li>
</ul>
<details><summary class="point-color-can-hover">[7.4.2] 'íë¸Œ' ì˜ˆì œ í¼ì¹˜ê¸°</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ì‹œê°„(ì‹ ê·œ Date ì»¬ëŸ¼), ê³µê°„(Country) ì„ ì¶•ìœ¼ë¡œ í•˜ëŠ” íë¸Œ</span></span><br><span class="line"><span class="comment">// =&gt; &#x27;ì „ì²´ ê¸°ê°„ì— ëŒ€í•œ ë‚ ì§œì™€ êµ­ê°€ë³„ ê²°ê³¼&#x27; í¬í•¨í•˜ëŠ” DataFrame ìƒì„±</span></span><br><span class="line"><span class="comment">//     (ì™¸ì—ë„ ì „ì²´ ë‚ ì§œì™€ ëª¨ë“  êµ­ê°€ì— ëŒ€í•œ í•©ê³„, ëª¨ë“  êµ­ê°€ì˜ ë‚ ì§œë³„ í•©ê³„, ë‚ ì§œë³„ êµ­ê°€ë³„ í•©ê³„, ì „ì²´ ë‚ ì§œì˜ êµ­ê°€ë³„ í•©ê³„, ... ê°€ëŠ¥)</span></span><br><span class="line">(dfNoNull.cube(<span class="string">&quot;Date&quot;</span>, <span class="string">&quot;Country&quot;</span>).agg(sum(col(<span class="string">&quot;Quantity&quot;</span>)))</span><br><span class="line">  .select(<span class="string">&quot;Date&quot;</span>, <span class="string">&quot;Country&quot;</span>, <span class="string">&quot;sum(Quantity)&quot;</span>).orderBy(<span class="string">&quot;Date&quot;</span>).show())</span><br><span class="line"><span class="comment">// +----+--------------------+-------------+</span></span><br><span class="line"><span class="comment">// |Date|             Country|sum(Quantity)|</span></span><br><span class="line"><span class="comment">// +----+--------------------+-------------+</span></span><br><span class="line"><span class="comment">// |null|               Japan|        25218|</span></span><br><span class="line"><span class="comment">// |null|            Portugal|        16180|</span></span><br><span class="line"><span class="comment">// |null|             Germany|       117448|</span></span><br><span class="line"><span class="comment">// |null|                 RSA|          352|</span></span><br><span class="line"><span class="comment">// |null|           Australia|        83653|</span></span><br><span class="line"><span class="comment">// |null|           Hong Kong|         4769|</span></span><br><span class="line"><span class="comment">// |null|              Cyprus|         6317|</span></span><br><span class="line"><span class="comment">// |null|             Finland|        10666|</span></span><br><span class="line"><span class="comment">// |null|United Arab Emirates|          982|</span></span><br><span class="line"><span class="comment">// |null|                null|      5176450|</span></span><br><span class="line"><span class="comment">// |null|         Unspecified|         3300|</span></span><br><span class="line"><span class="comment">// |null|               Spain|        26824|</span></span><br><span class="line"><span class="comment">// |null|           Singapore|         5234|</span></span><br><span class="line"><span class="comment">// |null|     Channel Islands|         9479|</span></span><br><span class="line"><span class="comment">// |null|             Lebanon|          386|</span></span><br><span class="line"><span class="comment">// |null|                 USA|         1034|</span></span><br><span class="line"><span class="comment">// |null|             Denmark|         8188|</span></span><br><span class="line"><span class="comment">// |null|              Norway|        19247|</span></span><br><span class="line"><span class="comment">// |null|      Czech Republic|          592|</span></span><br><span class="line"><span class="comment">// |null|  European Community|          497|</span></span><br><span class="line"><span class="comment">// +----+--------------------+-------------+</span></span><br></pre></td></tr></table></figure>
</details>

<ul>
<li>ê·¸ë£¹í™” ë©”íƒ€ë°ì´í„°<ul>
<li>íë¸Œ, ë¡¤ì—… ì‚¬ìš© ì‹œ ì§‘ê³„ ìˆ˜ì¤€ì— ë”°ë¼ ì‰½ê²Œ í•„í„°ë§í•˜ê³ ì í•˜ë©´ =&gt; <strong>ì§‘ê³„ ìˆ˜ì¤€ ì¡°íšŒ</strong> í•„ìš”</li>
<li><code>grouping_id()</code> : ê²°ê³¼ ë°ì´í„°ì…‹ì˜ ì§‘ê³„ ìˆ˜ì¤€ì„ ëª…ì‹œí•˜ëŠ” ì»¬ëŸ¼ ì œê³µ</li>
</ul>
</li>
</ul>
<details><summary class="point-color-can-hover">[7.4.3] grouping_id() ì˜ˆì œ í¼ì¹˜ê¸°</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions.&#123;grouping_id, sum, expr&#125;</span><br><span class="line"></span><br><span class="line">(dfNoNull.cube(<span class="string">&quot;customerId&quot;</span>, <span class="string">&quot;stockCode&quot;</span>).agg(grouping_id(), sum(<span class="string">&quot;Quantity&quot;</span>))</span><br><span class="line">.orderBy(col(<span class="string">&quot;grouping_id()&quot;</span>).desc)</span><br><span class="line">.show())</span><br><span class="line"><span class="comment">// =&gt; 4ê°œì˜ ê°œë³„ ê·¸ë£¹í™” ID ê°’ (0,1,2,3) ë°˜í™˜ë¨</span></span><br><span class="line"><span class="comment">// +----------+---------+-------------+-------------+</span></span><br><span class="line"><span class="comment">// |customerId|stockCode|grouping_id()|sum(Quantity)|</span></span><br><span class="line"><span class="comment">// +----------+---------+-------------+-------------+</span></span><br><span class="line"><span class="comment">// |      null|     null|            3|      5176450| =&gt; 3 : ê°€ì¥ ë†’ì€ ê³„ì¸µì˜ ì§‘ê³„ ê²°ê³¼. ì „ì²´ ì´ ìˆ˜ëŸ‰ (customerId, stockCode ê´€ê³„ X)</span></span><br><span class="line"><span class="comment">// |      null|    84226|            2|           17| =&gt; 2 : ê°œë³„ stockCode ë³„ ì´ ìˆ˜ëŸ‰ (customerId ê´€ê³„ X)</span></span><br><span class="line"><span class="comment">// |      null|    22856|            2|          518|</span></span><br><span class="line"><span class="comment">// |      null|    22352|            2|         3077|</span></span><br><span class="line"><span class="comment">//            ...</span></span><br><span class="line"><span class="comment">// |     14907|     null|            1|         1686| =&gt; 1 : customerId ê¸°ë°˜ ì´ ìˆ˜ëŸ‰ ì œê³µ (êµ¬ë§¤ ë¬¼í’ˆ ê´€ê³„ X)</span></span><br><span class="line"><span class="comment">// |     14543|     null|            1|          600|</span></span><br><span class="line"><span class="comment">//            ...</span></span><br><span class="line"><span class="comment">// |     13047|    22749|            0|           12| =&gt; 0 : customerId - stockCode ë³„ ì¡°í•©ì— ë”°ë¼ ì´ ìˆ˜ëŸ‰</span></span><br><span class="line"><span class="comment">// |     15311|    22083|            0|          169|</span></span><br><span class="line"><span class="comment">// +----------+---------+-------------+-------------+</span></span><br></pre></td></tr></table></figure>
</details>

<ul>
<li>í”¼ë²—(pivot)<ul>
<li><code>pivot()</code> : ë¡œìš° â†’ ì»¬ëŸ¼ìœ¼ë¡œ ë³€í™˜ ê°€ëŠ¥</li>
<li>=&gt; ì»¬ëŸ¼ì˜ ëª¨ë“  ê°’ì„ ë‹¨ì¼ ê·¸ë£¹í™”í•˜ì—¬ ê³„ì‚° ê°€ëŠ¥<ul>
<li>ê·¸ëŸ¬ë‚˜ ë°ì´í„° íƒìƒ‰ë°©ì‹ì— ë”°ë¼ í”¼ë²— ìˆ˜í–‰ ê²°ê³¼ê°’ì´ ê°ì†Œí•  ìˆ˜ ìˆìŒ</li>
</ul>
</li>
<li>íŠ¹ì • ì»¬ëŸ¼ cardinalityê°€ ë‚®ìœ¼ë©´ í”¼ë²—ìœ¼ë¡œ ë‹¤ìˆ˜ ì»¬ëŸ¼ìœ¼ë¡œ ë³€í™˜ ì¶”ì²œ   =&gt; ìŠ¤í‚¤ë§ˆ, ì¿¼ë¦¬ ëŒ€ìƒ í™•ì¸ ê°€ëŠ¥</li>
</ul>
</li>
</ul>
<details><summary class="point-color-can-hover">[7.4.4] 'í”¼ë²—' ì˜ˆì œ í¼ì¹˜ê¸°</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> pivoted = dfWithDate.groupBy(<span class="string">&quot;date&quot;</span>).pivot(<span class="string">&quot;Country&quot;</span>).sum() <span class="comment">// ì§‘ê³„ ìˆ˜í–‰ =&gt; ìˆ˜ì¹˜í˜• ì»¬ëŸ¼ìœ¼ë¡œ ë‚˜ì˜´</span></span><br><span class="line"><span class="comment">// pivoted.printSchema()</span></span><br><span class="line"><span class="comment">// root</span></span><br><span class="line"><span class="comment">//  |-- date: date (nullable = true)</span></span><br><span class="line"><span class="comment">//  |-- Australia_sum(Quantity): long (nullable = true)</span></span><br><span class="line"><span class="comment">//  |-- Australia_sum(UnitPrice): double (nullable = true)</span></span><br><span class="line"><span class="comment">//  |-- Australia_sum(CustomerID): long (nullable = true)</span></span><br><span class="line"><span class="comment">//  |-- Austria_sum(Quantity): long (nullable = true)</span></span><br><span class="line"><span class="comment">//  |-- Austria_sum(UnitPrice): double (nullable = true)</span></span><br><span class="line"><span class="comment">//  |-- Austria_sum(CustomerID): long (nullable = true)</span></span><br><span class="line"><span class="comment">//  |-- Bahrain_sum(Quantity): long (nullable = true)</span></span><br><span class="line"><span class="comment">//  |-- Bahrain_sum(UnitPrice): double (nullable = true)</span></span><br><span class="line"><span class="comment">//  |-- Bahrain_sum(CustomerID): long (nullable = true)</span></span><br><span class="line"><span class="comment">//  ...</span></span><br><span class="line"></span><br><span class="line">pivoted.where(<span class="string">&quot;date &gt; &#x27;2011-12-05&#x27;&quot;</span>).select(<span class="string">&quot;date&quot;</span> ,<span class="string">&quot;`USA_sum(Quantity)`&quot;</span>).show()</span><br><span class="line"><span class="comment">// +----------+-----------------+</span></span><br><span class="line"><span class="comment">// |      date|USA_sum(Quantity)|</span></span><br><span class="line"><span class="comment">// +----------+-----------------+</span></span><br><span class="line"><span class="comment">// |2011-12-06|             null|</span></span><br><span class="line"><span class="comment">// |2011-12-09|             null|</span></span><br><span class="line"><span class="comment">// |2011-12-08|             -196|</span></span><br><span class="line"><span class="comment">// |2011-12-07|             null|</span></span><br><span class="line"><span class="comment">// +----------+-----------------+</span></span><br></pre></td></tr></table></figure>
</details>

<h3 id="7-5-ì‚¬ìš©ì-ì •ì˜-ì§‘ê³„-í•¨ìˆ˜"><a href="#7-5-ì‚¬ìš©ì-ì •ì˜-ì§‘ê³„-í•¨ìˆ˜" class="headerlink" title="7.5 ì‚¬ìš©ì ì •ì˜ ì§‘ê³„ í•¨ìˆ˜"></a>7.5 ì‚¬ìš©ì ì •ì˜ ì§‘ê³„ í•¨ìˆ˜</h3><ul>
<li>ì‚¬ìš©ì ì •ì˜ ì§‘ê³„ í•¨ìˆ˜ (<strong>UDAF</strong>, user-defined aggregation function)<ul>
<li>ì§ì ‘ ì œì‘í•œ í•¨ìˆ˜ë‚˜ ë¹„ì¦ˆë‹ˆìŠ¤ ê·œì¹™ì— ê¸°ë°˜í•œ ìì²´ ì§‘ê³„ í•¨ìˆ˜ ì •ì˜ ë°©ë²•</li>
<li>UDAF ì‚¬ìš© =&gt; ì…ë ¥ ë°ì´í„° ê·¸ë£¹ì— ì§ì ‘ ê°œë°œí•œ ì—°ì‚° ìˆ˜í–‰ ê°€ëŠ¥</li>
<li>ìŠ¤íŒŒí¬ëŠ” ì…ë ¥ ë°ì´í„°ì˜ ëª¨ë“  ê·¸ë£¹ ì¤‘ê°„ ê²°ê³¼ë¥¼ ë‹¨ì¼ AggregationBufferì— ì €ì¥/ê´€ë¦¬</li>
</ul>
</li>
<li>UDAFëŠ” í˜„ì¬ ìŠ¤ì¹¼ë¼, ìë°”ë¡œë§Œ ì‚¬ìš© ê°€ëŠ¥<ul>
<li>Spark 2.3 ì—ì„œëŠ” UDF/UDAF =&gt; í•¨ìˆ˜ ë“±ë¡ ê°€ëŠ¥ ([6.12] ì°¸ê³ )</li>
</ul>
</li>
<li>ìƒì„± ë°©ë²•<ul>
<li>ê¸°ë³¸ í´ë˜ìŠ¤ UserDefinedAggregateFunction ìƒì† + ë©”ì„œë“œ ì •ì˜</li>
</ul>
</li>
</ul>
<blockquote>
<p>UDAF ìƒì„± ì‹œ ì •ì˜í•´ì•¼í•  ë©”ì„œë“œ</p>
<ul>
<li>inputScheme : <code>UDAF ì…ë ¥ íŒŒë¼ë¯¸í„°ì˜ ìŠ¤í‚¤ë§ˆ</code>ë¥¼ StructType ë¡œ ì •ì˜</li>
<li>bufferSchema : <code>UDAF ì¤‘ê°„ ê²°ê³¼ì˜ ìŠ¤í‚¤ë§ˆ</code>ë¥¼ StructType ë¡œ ì •ì˜</li>
<li>dataType : <code>ë°˜í™˜ë  ê°’ì˜ DataType</code> ì •ì˜</li>
<li>deterministic : <code>UDAFê°€ ë™ì¼í•œ ì…ë ¥ê°’ì— ëŒ€í•´ í•­ìƒ ë™ì¼í•œ ê²°ê³¼ë¥¼ ë°˜í™˜í•˜ëŠ”ì§€</code> Boolean ê°’ìœ¼ë¡œ ì •ì˜</li>
<li>initialize : <code>ì§‘ê³„ìš© ë²„í¼ ê°’ ì´ˆê¸°í™” ë¡œì§</code> ì •ì˜</li>
<li>update : ì…ë ¥ë°›ì€ ë¡œìš° ê¸°ë°˜ìœ¼ë¡œ <code>ë‚´ë¶€ ë²„í¼ ì—…ë°ì´íŠ¸ ë¡œì§</code> ì •ì˜</li>
<li>merge : ë‘ ê°œì˜ <code>ì§‘ê³„ìš© ë²„í¼ ë³‘í•© ë¡œì§</code> ì •ì˜</li>
<li>evaluate : <code>ì§‘ê³„ ìµœì¢… ê²°ê³¼ ìƒì„± ë¡œì§</code> ì •ì˜</li>
</ul>
</blockquote>
<details><summary class="point-color-can-hover">[7.5] ì˜ˆì œ í¼ì¹˜ê¸°</summary>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UDAF ì˜ˆì œ - &#x27;BoolAnd&#x27; Class : ì…ë ¥ëœ ëª¨ë“  ë¡œìš°ì˜ ì»¬ëŸ¼ì´ trueì¸ì§€ íŒë‹¨</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BoolAnd</span> <span class="keyword">extends</span> <span class="title">org</span>.<span class="title">apache</span>.<span class="title">spark</span>.<span class="title">sql</span>.<span class="title">expressions</span>.<span class="title">UserDefinedAggregateFunction</span> </span>&#123;</span><br><span class="line">  <span class="keyword">import</span> org.apache.spark.sql.types.&#123;<span class="type">StructType</span>, <span class="type">StructField</span>, <span class="type">BooleanType</span>, <span class="type">DataType</span>&#125;</span><br><span class="line">  <span class="keyword">import</span> org.apache.spark.sql.expressions.<span class="type">MutableAggregationBuffer</span></span><br><span class="line">  <span class="keyword">import</span> org.apache.spark.sql.<span class="type">Row</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">inputSchema</span></span>: org.apache.spark.sql.types.<span class="type">StructType</span> =</span><br><span class="line">    <span class="type">StructType</span>(<span class="type">StructField</span>(<span class="string">&quot;value&quot;</span>, <span class="type">BooleanType</span>) :: <span class="type">Nil</span>)</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">bufferSchema</span></span>: <span class="type">StructType</span> = <span class="type">StructType</span>(</span><br><span class="line">    <span class="type">StructField</span>(<span class="string">&quot;result&quot;</span>, <span class="type">BooleanType</span>) :: <span class="type">Nil</span></span><br><span class="line">  )</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">dataType</span></span>: <span class="type">DataType</span> = <span class="type">BooleanType</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">deterministic</span></span>: <span class="type">Boolean</span> = <span class="literal">true</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span></span>(buffer: <span class="type">MutableAggregationBuffer</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">    buffer(<span class="number">0</span>) = <span class="literal">true</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">update</span></span>(buffer: <span class="type">MutableAggregationBuffer</span>, input: <span class="type">Row</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">    buffer(<span class="number">0</span>) = buffer.getAs[<span class="type">Boolean</span>](<span class="number">0</span>) &amp;&amp; input.getAs[<span class="type">Boolean</span>](<span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">merge</span></span>(buffer1: <span class="type">MutableAggregationBuffer</span>, buffer2: <span class="type">Row</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">    buffer1(<span class="number">0</span>) = buffer1.getAs[<span class="type">Boolean</span>](<span class="number">0</span>) &amp;&amp; buffer2.getAs[<span class="type">Boolean</span>](<span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">evaluate</span></span>(buffer: <span class="type">Row</span>): <span class="type">Any</span> = &#123;</span><br><span class="line">    buffer(<span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// í•¨ìˆ˜ë¡œ ë“±ë¡ ë° ì‚¬ìš©</span></span><br><span class="line"><span class="keyword">val</span> ba = <span class="keyword">new</span> <span class="type">BoolAnd</span></span><br><span class="line">spark.udf.register(<span class="string">&quot;booland&quot;</span>, ba)</span><br><span class="line"><span class="keyword">import</span> org.apache.spark.sql.functions._</span><br><span class="line">(spark.range(<span class="number">1</span>)</span><br><span class="line">  .selectExpr(<span class="string">&quot;explode(array(TRUE, TRUE, TRUE)) as t&quot;</span>)</span><br><span class="line">  .selectExpr(<span class="string">&quot;explode(array(TRUE, FALSE, TRUE)) as f&quot;</span>, <span class="string">&quot;t&quot;</span>)</span><br><span class="line">  .select(ba(col(<span class="string">&quot;t&quot;</span>)), expr(<span class="string">&quot;booland(f)&quot;</span>))</span><br><span class="line">  .show())</span><br><span class="line"><span class="comment">// +----------+----------+</span></span><br><span class="line"><span class="comment">// |booland(t)|booland(f)|</span></span><br><span class="line"><span class="comment">// +----------+----------+</span></span><br><span class="line"><span class="comment">// |      true|     false|</span></span><br><span class="line"><span class="comment">// +----------+----------+</span></span><br></pre></td></tr></table></figure>
</details>


<h3 id="7-6-ì •ë¦¬"><a href="#7-6-ì •ë¦¬" class="headerlink" title="7.6 ì •ë¦¬"></a>7.6 ì •ë¦¬</h3><ul>
<li>ìŠ¤íŒŒí¬ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ì—¬ëŸ¬ ìœ í˜•ì˜ ì§‘ê³„ ì—°ì‚°</li>
<li>ê·¸ë£¹í™”, ìœˆë„ìš° í•¨ìˆ˜, ë¡¤ì—…, íë¸Œ</li>
</ul>
<h3 id="ğŸ“’-ë‹¨ì–´ì¥"><a href="#ğŸ“’-ë‹¨ì–´ì¥" class="headerlink" title="ğŸ“’ ë‹¨ì–´ì¥"></a>ğŸ“’ ë‹¨ì–´ì¥</h3><ul>
<li>ë¹„ëŒ€ì¹­ë„(skewness) : ì‹¤ìˆ«ê°’ í™•ë¥ ë³€ìˆ˜ì˜ í™•ë¥ ë¶„í¬ ë¹„ëŒ€ì¹­ì„±ì„ ë‚˜íƒ€ë‚´ëŠ” ì§€í‘œ (=ì™œë„)</li>
<li>ì²¨ë„(kurtosis) : í™•ë¥ ë¶„í¬ì˜ ë¾°ì¡±í•œ ì •ë„ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì²™ë„</li>
</ul>
</div><p class="post-tags"><i class="fa fa-tags" aria-hidden="true"></i><a href="/tags/study/">#study</a><a href="/tags/book/">#book</a><a href="/tags/spark/">#spark</a><a href="/tags/apache/">#apache</a></p></article></div><footer><div class="paginator"><a class="next" href="/2021/02/02/Spark-The-Definitive-Guide-6%EC%9E%A5/">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'minsw-github-io';
var disqus_identifier = '2021/02/03/Spark-The-Definitive-Guide-7ì¥/';
var disqus_title = '&amp;#039;Spark The Definitive Guide&amp;#039; 7ì¥ - ì§‘ê³„í•´ë¼ ì• ì†¡ì´';
var disqus_url = 'https://minsw.github.io/2021/02/03/Spark-The-Definitive-Guide-7ì¥/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async></script><div class="copyright"><p>Â© 2018 - 2021 <a href="https://minsw.github.io">Lukka Min</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-143001954-1",'auto');ga('send','pageview');</script><link rel="stylesheet" href="//cdn.datatables.net/1.10.7/css/jquery.dataTables.min.css" media="screen" type="text/css"><script src="//cdn.datatables.net/1.10.7/js/jquery.dataTables.min.js"></script><script>$(function(){$('.datatable').dataTable( {"order": [[ 0, "desc" ]],"iDisplayLength": -1,"lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]]} );});</script></body></html>